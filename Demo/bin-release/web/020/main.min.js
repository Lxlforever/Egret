var Main=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createChildren=function(){t.prototype.createChildren.call(this),this.stage.registerImplementation("eui.IAssetAdapter",new AssetAdapter),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},s.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var e=new eui.Theme("resource/default.thm.json",this.stage);e.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this)},s.onThemeLoadComplete=function(){this.initScene(),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},s.onResourceLoadComplete=function(t){"preload"==t.groupName?(App.ControllerManager.register(ControllerConst.Loading,new LoadingController),App.SceneManager.runScene(SceneConst.Loading),RES.loadGroup("loading")):"loading"==t.groupName&&(RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.start())},s.start=function(){App.Init(),App.ControllerManager.register(ControllerConst.Game,new GameController),App.SceneManager.runScene(SceneConst.Game)},s.initScene=function(){App.SceneManager.register(SceneConst.Loading,new LoadingScene),App.SceneManager.register(SceneConst.Game,new GameScene)},s.onResourceProgress=function(t){"loading"==t.groupName&&App.ControllerManager.applyFunc(ControllerConst.Loading,LoadingConst.SetProgress,t.itemsLoaded,t.itemsTotal)},s.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},s.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e}(eui.UILayer);egret.registerClass(Main,"Main");var App=function(){function t(){}var e=__define,i=t;i.prototype;return e(t,"Http",function(){return Http.getInstance()}),e(t,"Socket",function(){return Socket.getInstance()}),e(t,"ControllerManager",function(){return ControllerManager.getInstance()}),e(t,"ViewManager",function(){return ViewManager.getInstance()}),e(t,"SceneManager",function(){return SceneManager.getInstance()}),e(t,"DebugUtils",function(){return DebugUtils.getInstance()}),e(t,"MessageCenter",function(){return MessageCenter.getInstance(0)}),e(t,"TimerManager",function(){return TimerManager.getInstance()}),e(t,"DateUtils",function(){return DateUtils.getInstance()}),e(t,"MathUtils",function(){return MathUtils.getInstance()}),e(t,"RandomUtils",function(){return RandomUtils.getInstance()}),e(t,"DisplayUtils",function(){return DisplayUtils.getInstance()}),e(t,"BitmapNumber",function(){return BitmapNumber.getInstance()}),e(t,"GuideUtils",function(){return GuideUtils.getInstance()}),e(t,"StageUtils",function(){return StageUtils.getInstance()}),e(t,"EffectUtils",function(){return EffectUtils.getInstance()}),e(t,"StringUtils",function(){return StringUtils.getInstance()}),e(t,"CommonUtils",function(){return CommonUtils.getInstance()}),e(t,"SoundManager",function(){return SoundManager.getInstance()}),e(t,"DeviceUtils",function(){return DeviceUtils.getInstance()}),e(t,"EgretExpandUtils",function(){return EgretExpandUtils.getInstance()}),e(t,"KeyboardUtils",function(){return KeyboardUtils.getInstance()}),e(t,"RockerUtils",function(){return RockerUtils.getInstance()}),e(t,"ShockUtils",function(){return ShockUtils.getInstance()}),e(t,"ResourceUtils",function(){return ResourceUtils.getInstance()}),e(t,"RenderTextureManager",function(){return RenderTextureManager.getInstance()}),e(t,"TextFlowMaker",function(){return TextFlowMaker.getInstance()}),e(t,"NotificationCenter",function(){return null==t._notificationCenter&&(t._notificationCenter=new MessageCenter(1)),t._notificationCenter}),e(t,"DelayOptManager",function(){return DelayOptManager.getInstance()}),e(t,"ArrayUtils",function(){return ArrayUtils.getInstance()}),e(t,"EasyLoading",function(){return EasyLoading.getInstance()}),e(t,"ResVersionManager",function(){return ResVersionManager.getInstance()}),e(t,"DragonBonesFactory",function(){return DragonBonesFactory.getInstance()}),e(t,"StarlingSwfFactory",function(){return StarlingSwfFactory.getInstance()}),t.Init=function(){t.GlobalData=RES.getRes("global_json"),t.DebugUtils.isOpen(t.GlobalData.IsDebug),t.DebugUtils.setThreshold(5),t.EgretExpandUtils.init()},t.ProxyUserFlag="",t.GlobalData=null,t.ProtoFile=null,t.ProtoConfig=null,t}();egret.registerClass(App,"App");var AssetAdapter=function(){function t(){}var e=(__define,t),i=e.prototype;return i.getAsset=function(t,e,i){function s(s){e.call(i,s,t)}if(RES.hasRes(t)){var n=RES.getRes(t);n?s(n):RES.getResAsync(t,s,this)}else RES.getResByUrl(t,s,this,RES.ResourceItem.TYPE_IMAGE)},t}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var MergeJsonAnalyzer=function(t){function e(){t.apply(this,arguments),this.mergeJsons=["MergeConfig_json"]}__extends(e,t);var i=(__define,e),s=i.prototype;return s.analyzeData=function(t,e){var i=t.name;if(!this.fileDic[i]&&e)try{var s=JSON.parse(e);if(-1!=this.mergeJsons.indexOf(i))for(var n in s)this.fileDic[n]=s[n];else this.fileDic[i]=s}catch(r){egret.$warn(1017,t.url,e)}},e}(RES.JsonAnalyzer);egret.registerClass(MergeJsonAnalyzer,"MergeJsonAnalyzer");var ThemeAdapter=function(){function t(){}var e=(__define,t),i=e.prototype;return i.getTheme=function(t,e,i,s){function n(t){e.call(s,t)}function r(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),i.call(s))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_TEXT)},t}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);var BaseClass=function(){function t(){}var e=(__define,t);e.prototype;return t.getInstance=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var i=this;if(!i._instance){var s=t.length;0==s?i._instance=new i:1==s?i._instance=new i(t[0]):2==s?i._instance=new i(t[0],t[1]):3==s?i._instance=new i(t[0],t[1],t[2]):4==s?i._instance=new i(t[0],t[1],t[2],t[3]):5==s&&(i._instance=new i(t[0],t[1],t[2],t[3],t[4]))}return i._instance},t}();egret.registerClass(BaseClass,"BaseClass");var Keyboard=function(){function t(){}var e=(__define,t);e.prototype;return t.LEFT=37,t.RIGHT=39,t.UP=38,t.DOWN=40,t.W=87,t.A=65,t.S=83,t.D=68,t.J=74,t.K=75,t.L=76,t.U=85,t.I=73,t.O=79,t.P=80,t.SPACE=32,t}();egret.registerClass(Keyboard,"Keyboard");var BitmapNumber=function(t){function e(){t.call(this),this._imgPool=[],this._containerPool=[]}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createNumPic=function(t,e){var i,s=this.getContainer(),n=t.toString(),r=0;for(r;r<n.length;r++)i=this.getSingleNumPic(n.charAt(r),e),s.addChild(i);return this.repositionNumPic(s),s},s.desstroyNumPic=function(t){this.clearContainer(t),t.parent&&t.parent.removeChild(t),this._containerPool.push(t)},s.changeNum=function(t,e,i){var s=e.toString();if(t.numChildren>s.length)for(;t.numChildren>s.length;)this.recycleBM(t.getChildAt(t.numChildren-1));var n,r=0;for(r;r<s.length;r++)r>=t.numChildren&&t.addChild(this.getBitmap()),n=s.charAt(r),n="."==n?"dot":n,t.getChildAt(r).texture=this.getTexture(n,i);this.repositionNumPic(t)},s.repositionNumPic=function(t){var e,i=0,s=0;for(i;i<t.numChildren;i++)e=t.getChildAt(i),e.x=s,s=e.x+e.width},s.clearContainer=function(t){for(;t.numChildren;)this.recycleBM(t.removeChildAt(0))},s.recycleBM=function(t){t&&t.parent&&(t.parent.removeChild(t),t.texture=null,this._imgPool.push(t))},s.getContainer=function(){return this._containerPool.length?this._containerPool.shift():new egret.DisplayObjectContainer},s.getSingleNumPic=function(t,e){"."==t&&(t="dot");var i=this.getBitmap();return i.texture=this.getTexture(t,e),i},s.getTexture=function(t,e){return RES.getRes(e+t)},s.getBitmap=function(){return this._imgPool.length?this._imgPool.shift():new egret.Bitmap},e}(BaseClass);egret.registerClass(BitmapNumber,"BitmapNumber");var HotspotBitmap=function(t){function e(){t.call(this),this._hotspot=[],this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouch,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addHotspotArea=function(t,e,i,s){this._hotspot.push({rect:t,callBack:e,thisObj:i,para:s})},s.onTouch=function(t){for(var e,i=t.localX,s=t.localY,n=0;n<this._hotspot.length;n++)e=this._hotspot[n],e.rect.contains(i,s)&&(e.para?e.callBack.call(e.thisObj,e.para):e.callBack.call(e.thisObj))},e}(egret.Bitmap);egret.registerClass(HotspotBitmap,"HotspotBitmap");var DragonBonesArmature=function(t){function e(e,i){t.call(this),this._armature=e,this._clock=i,this.addChild(this._armature.display),this._completeCalls=[],this._frameCalls=[],this._isPlay=!1,this._playName=""}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addListeners=function(){this._armature.addEventListener(dragonBones.AnimationEvent.COMPLETE,this.completeHandler,this),this._armature.enableCache?this._armature.addEventListener(dragonBones.FrameEvent.ANIMATION_FRAME_EVENT,this.frameHandler,this):this._armature.addEventListener(dragonBones.FrameEvent.BONE_FRAME_EVENT,this.frameHandler,this)},s.removeListeners=function(){this._armature.removeEventListener(dragonBones.AnimationEvent.COMPLETE,this.completeHandler,this),this._armature.enableCache?this._armature.removeEventListener(dragonBones.FrameEvent.ANIMATION_FRAME_EVENT,this.frameHandler,this):this._armature.removeEventListener(dragonBones.FrameEvent.BONE_FRAME_EVENT,this.frameHandler,this)},s.completeHandler=function(t){var e=t.animationName;t.armature instanceof dragonBones.Armature&&(e=t.animationState.animationData.name);for(var i=0,s=this._completeCalls.length;s>i;i++){var n=this._completeCalls[i];n[0].apply(n[1],[t,e])}e==this._playName&&(this._playName="")},s.frameHandler=function(t){for(var e=0,i=this._frameCalls.length;i>e;e++){var s=this._frameCalls[e];s[0].apply(s[1],[t])}},s.play=function(t,e){return void 0===e&&(e=void 0),this._playName==t?this._currAnimationState:(this._playName=t,this.start(),void 0==e?this._currAnimationState=this.getAnimation().gotoAndPlay(t):this._currAnimationState=this.getAnimation().gotoAndPlay(t,void 0,void 0,e),this._currAnimationState&&(this._currAnimationState.autoTween=!1),this._currAnimationState)},s.start=function(){this._isPlay||(this._clock.add(this._armature),this._isPlay=!0,this.addListeners())},s.stop=function(){this._isPlay&&(this._clock.remove(this._armature),this._isPlay=!1,this._playName="",this.removeListeners())},s.destroy=function(){this.stop(),this.parent&&this.parent.removeChild(this),this.removeChildren(),this._armature=null,this._clock=null,this._completeCalls=null,this._frameCalls=null},s.addCompleteCallFunc=function(t,e){for(var i=0;i<this._completeCalls.length;i++){var s=this._completeCalls[i];if(s[0]==t&&s[1]==e)return}this._completeCalls.unshift([t,e])},s.removeCompleteCallFunc=function(t,e){for(var i=0;i<this._completeCalls.length;i++){var s=this._completeCalls[i];s[0]==t&&s[1]==e&&(this._completeCalls.splice(i,1),i--)}},s.addFrameCallFunc=function(t,e){for(var i=0;i<this._frameCalls.length;i++){var s=this._frameCalls[i];if(s[0]==t&&s[1]==e)return}this._frameCalls.push([t,e])},s.removeFrameCallFunc=function(t,e){for(var i=0;i<this._frameCalls.length;i++){var s=this._frameCalls[i];s[0]==t&&s[1]==e&&(this._frameCalls.splice(i,1),i--)}},s.$onRemoveFromStage=function(){t.prototype.$onRemoveFromStage.call(this),this.stop()},s.getArmature=function(){return this._armature},s.getCurrAnimationState=function(){return this._currAnimationState},s.getClock=function(){return this._clock},s.getAnimation=function(){return this._armature.animation},s.getBone=function(t){return this._armature.getBone(t)},s.getPlayName=function(){return this._playName},s.getBoneDisplay=function(t){return t.slot.getDisplay()},s.changeBone=function(t,e){var i=this.getBone(t);i&&(i instanceof dragonBones.Bone?i.slot.display=e:i.slot.setDisplay(e))},e}(egret.DisplayObjectContainer);egret.registerClass(DragonBonesArmature,"DragonBonesArmature");var DragonBonesArmatureContainer=function(t){function e(){t.call(this),this.armatures=new Array,this.actions={},this.cacheBones={}}__extends(e,t);var i=__define,s=e,n=s.prototype;return n.register=function(t,e){this.armatures.push(t);for(var i=0,s=e.length;s>i;i++)this.actions[e[i]]=this.armatures.length-1},i(n,"armature",function(){return this.armatures[this.currArmatureIndex]}),n.getCacheBone=function(t){if(!this.cacheBones[t]){this.cacheBones[t]=[];for(var e=0,i=this.armatures.length;i>e;e++){var s=this.armatures[e];this.cacheBones[t].push(s.getBone(t))}}return this.cacheBones[t][this.currArmatureIndex]},n.play=function(t,e){if(void 0===e&&(e=void 0),null==this.actions[t])return void Log.trace("DragonBonesArmatureContainer不存在动作：",t);var i=this.actions[t];i!=this.currArmatureIndex&&this.remove();var s=this.armatures[i];return s?(this.addChild(s),this.currArmatureIndex=i,s.play(t,e)):null},n.stop=function(){var t=this.armatures[this.currArmatureIndex];t&&t.stop()},n.start=function(){var t=this.armatures[this.currArmatureIndex];t&&t.start()},n.remove=function(){var t=this.armatures[this.currArmatureIndex];t&&(t.stop(),App.DisplayUtils.removeFromParent(t),this.currArmatureIndex=null)},n.addCompleteCallFunc=function(t,e){for(var i=0,s=this.armatures.length;s>i;i++){var n=this.armatures[i];n.addCompleteCallFunc(t,e)}},n.removeCompleteCallFunc=function(t,e){for(var i=0,s=this.armatures.length;s>i;i++){var n=this.armatures[i];n.removeCompleteCallFunc(t,e)}},n.addFrameCallFunc=function(t,e){for(var i=0,s=this.armatures.length;s>i;i++){var n=this.armatures[i];n.addFrameCallFunc(t,e)}},n.removeFrameCallFunc=function(t,e){for(var i=0,s=this.armatures.length;s>i;i++){var n=this.armatures[i];n.removeFrameCallFunc(t,e)}},n.clear=function(){for(;this.armatures.length;){var t=this.armatures.pop();App.DisplayUtils.removeFromParent(t),t.destroy()}this.cacheBones={},this.actions={}},n.destroy=function(){this.clear(),this.armatures=null,this.cacheBones=null,this.actions=null},e}(egret.DisplayObjectContainer);egret.registerClass(DragonBonesArmatureContainer,"DragonBonesArmatureContainer");var DragonBonesFactory=function(t){function e(){t.call(this),this.averageUtils=new AverageUtils,this.factory=new dragonBones.EgretFactory,this.clocks=new Array,this.clocksLen=0,this.files=[],this.start()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.initArmatureFile=function(t,e,i){-1==this.files.indexOf(t.name)&&(this.addSkeletonData(t),this.addTextureAtlas(e,i),this.files.push(t.name))},s.initArmatureMoreFile=function(t){this.factory.addSkeletonData(dragonBones.DataParser.parseDragonBonesData(t));for(var e=t.textureList,i=t.sheetList,s=new EgretTextureAtlasMore(RES.getRes(e[0]),RES.getRes(i[0]),t.name),n=e.length,r=1;n>r;r++)s.register(RES.getRes(e[r]),RES.getRes(i[r]));this.factory.addTextureAtlas(s)},s.removeArmatureFile=function(t){var e=this.files.indexOf(t);-1!=e&&(this.removeSkeletonData(t),this.removeTextureAtlas(t),this.files.splice(e,1))},s.clear=function(){for(;this.files.length;)this.removeArmatureFile(this.files[0])},s.addSkeletonData=function(t){this.factory.addSkeletonData(dragonBones.DataParser.parseDragonBonesData(t))},s.addTextureAtlas=function(t,e){this.factory.addTextureAtlas(new dragonBones.EgretTextureAtlas(t,e))},s.removeSkeletonData=function(t){this.factory.removeSkeletonData(t)},s.removeTextureAtlas=function(t){this.factory.removeTextureAtlas(t)},s.makeArmature=function(t,e,i){void 0===i&&(i=1);var s=this.factory.buildArmature(t,e);if(null==s)return Log.trace("不存在Armature： "+t),null;var n=this.createWorldClock(i),r=new DragonBonesArmature(s,n);return r},s.makeFastArmature=function(t,e,i){void 0===i&&(i=1);var s=this.factory.buildFastArmature(t,e);if(null==s)return Log.trace("不存在Armature： "+t),null;s.enableAnimationCache(30);var n=this.createWorldClock(i),r=new DragonBonesArmature(s,n);return r},s.createWorldClock=function(t){for(var e=0;e<this.clocksLen;e++)if(this.clocks[e].timeScale==t)return this.clocks[e];var i=new dragonBones.WorldClock;return i.timeScale=t,this.clocks.push(i),this.clocksLen=this.clocks.length,i},s.onEnterFrame=function(t){this.averageUtils.push(t);for(var e=.001*this.averageUtils.getValue(),i=0;i<this.clocksLen;i++){var s=this.clocks[i];s.advanceTime(e)}},s.stop=function(){this.isPlay&&(App.TimerManager.remove(this.onEnterFrame,this),this.isPlay=!1)},s.start=function(){this.isPlay||(this.isPlay=!0,App.TimerManager.doFrame(1,0,this.onEnterFrame,this))},e}(BaseClass);egret.registerClass(DragonBonesFactory,"DragonBonesFactory");var EgretTextureAtlasMore=function(t){function e(e,i,s,n){void 0===n&&(n=1),t.call(this,e,i,n),this._datas=[],this._textureIndex={},this.name=s,this.register(e,i)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.register=function(t,e){var i=this.parseSingleData(e);this.analysisSheet(i,this._datas.length),this._datas.push([new egret.SpriteSheet(t),i])},s.analysisSheet=function(t,e){for(var i=Object.keys(t),s=0,n=i.length;n>s;s++){var r=i[s];r&&""!=r&&this.addTextureDic(e,r)}},s.addTextureDic=function(t,e){this._textureIndex[e]=t},s.getTexture=function(t){var e=null,i=this._datas[this._textureIndex[t]];if(null==i)return null;var s=i[0],n=i[1][t];return n&&(e=s.getTexture(t),e||(e=s.createTexture(t,n.region.x,n.region.y,n.region.width,n.region.height))),e},s.dispose=function(){t.prototype.dispose.call(this),this._datas.length=0,this._datas=null,this._textureIndex=null},s.getRegion=function(t){for(var e=0,i=this._datas.length;i>e;e++){var s=this._datas[e],n=(s[0],s[1][t]);if(n)return n.region}return null},s.getFrame=function(t){for(var e=0,i=this._datas.length;i>e;e++){var s=this._datas[e],n=(s[0],s[1][t]);if(n)return n.frame}return null},s.parseSingleData=function(t){return dragonBones.DataParser.parseTextureAtlasData(t,this.scale)},e}(dragonBones.EgretTextureAtlas);egret.registerClass(EgretTextureAtlasMore,"EgretTextureAtlasMore");var GuideMaskBackgroud=function(t){function e(){t.call(this),this._stageWidth=0,this._stageHeight=0,this._bgs=new Array,this.touchEnabled=!0}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(t,e){this._stageWidth=t,this._stageHeight=e},s.draw=function(t){this.cacheAsBitmap=!1,this._deductRec=t,this.removeAllChild();var e=Math.max(t.x,0),i=Math.max(t.y,0),s=Math.min(t.x+t.width,this._stageWidth),n=Math.min(t.y+t.height,this._stageHeight);this.addBg(0,0,this._stageWidth,i),this.addBg(0,i,e,t.height),this.addBg(s,i,this._stageWidth-s,t.height),this.addBg(0,n,this._stageWidth,this._stageHeight-n),this.width=this._stageWidth,this.height=this._stageHeight,this.cacheAsBitmap=!0},s.destroy=function(){this.removeChildren(),this._bgs=[]},s.removeAllChild=function(){for(;this.numChildren;){var t=this.removeChildAt(0);this._bgs.push(t)}},s.addBg=function(t,e,i,s){var n;this._bgs.length?(n=this._bgs.pop(),n.graphics.clear()):n=new egret.Shape,n.graphics.beginFill(0,.5),n.graphics.drawRect(t,e,i,s),n.graphics.endFill(),this.addChild(n)},s.hitTest=function(t,e,i){return this._deductRec&&this._deductRec.contains(t,e)?null:this},e}(egret.Sprite);egret.registerClass(GuideMaskBackgroud,"GuideMaskBackgroud");var GuideUtils=function(t){function e(){t.apply(this,arguments),this.configData={1:{1:{txt:"点击这里，去设置宠物出战",txtdir:1,handDir:1},2:{txt:"点击选择一个宠物出战",txtdir:3,handDir:1},3:{txt:"点击宠物出战",txtdir:3,handDir:1}},2:{1:{txt:"更多宠物，可以抽取获得哦！",txtdir:1,handDir:2},2:{txt:"点击抽取宠物",txtdir:1,handDir:1}},3:{1:{txt:"点击选择另一个宠物",txtdir:1,handDir:1},2:{txt:"点击宠物出战",txtdir:3,handDir:1}},4:{1:{txt:"点击查看宠物属性",txtdir:4,handDir:1},2:{txt:"点击宠物升级",txtdir:1,handDir:2},3:{txt:"点击选择升级材料",txtdir:3,handDir:1},4:{txt:"选择一个宠物或卡牌作为材料",txtdir:3,handDir:1},5:{txt:"选择材料后点击确定回到升级界面",txtdir:1,handDir:2},6:{txt:"点击完成升级",txtdir:1,handDir:2}},5:{1:{txt:"现在立刻享受\n炫酷的飞行吧",txtdir:1,handDir:2},2:{txt:"每天前3次购买免费",txtdir:1,handDir:1},3:{txt:"开始战斗吧",txtdir:1,handDir:2}},6:{1:{txt:"点击这里查看战机",txtdir:1,handDir:1},2:{txt:"点击升级战机，\n可以提高战力",txtdir:1,handDir:2}}},this.currPart=0,this.currStep=0}__extends(e,t);var i=(__define,e),s=i.prototype;return s.next=function(){null!=this.view&&null!=this.view.parent&&(this.currStep++,this.configData[this.currPart][this.currStep]||(this.currPart++,this.currStep=1),this.configData[this.currPart]||(this.currPart=0,this.currStep=0),this.hide())},s.show=function(t,e,i){this.currPart==e&&this.currStep==i&&(null==this.view&&(this.view=new GuideView),this.view.setData(t,this.configData[this.currPart][this.currStep]),egret.MainContext.instance.stage.addChild(this.view))},s.hide=function(){App.DisplayUtils.removeFromParent(this.view)},s.isShow=function(){return null!=this.view&&null!=this.view.parent},e}(BaseClass);egret.registerClass(GuideUtils,"GuideUtils");var GuideView=function(t){function e(){t.call(this),this._objRec=new egret.Rectangle,this._objGlobalPoint=new egret.Point,this._bg=new GuideMaskBackgroud,this.addChild(this._bg),this._maskPic=StarlingSwfUtils.createS9Image("s9_guide_mask"),this.addChild(this._maskPic),this._textBgPic=StarlingSwfUtils.createS9Image("s9_guide_txt"),AnchorUtil.setAnchorY(this._textBgPic,1),this.addChild(this._textBgPic),this._handPic=StarlingSwfUtils.createImage("img_hand"),AnchorUtil.setAnchorX(this._handPic,.5),this.addChild(this._handPic),this._txt=new egret.TextField,this._txt.size=26,this._txt.textColor=5723991,this._txt.lineSpacing=4,AnchorUtil.setAnchorY(this._txt,.5),this.addChild(this._txt),egret.MainContext.instance.stage.addEventListener(egret.Event.RESIZE,this.onResize,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onResize=function(){this.stage&&egret.setTimeout(this.refurbish,this,500)},s.refurbish=function(){this.setData(this._obj,this._data)},s.setData=function(t,e){if(null!=t){this._obj=t,this._data=e,this._obj.localToGlobal(0,0,this._objGlobalPoint),this._obj.getBounds(this._objRec),this._objGlobalPoint.x=Math.ceil(this._objGlobalPoint.x),this._objGlobalPoint.y=Math.ceil(this._objGlobalPoint.y);var i=15,s=15;this._objRec.x=this._objGlobalPoint.x-i,this._objRec.y=this._objGlobalPoint.y-s,this._objRec.width+=2*i,this._objRec.height+=2*s,this._bg.init(egret.MainContext.instance.stage.stageWidth,egret.MainContext.instance.stage.stageHeight),this._bg.draw(this._objRec),this._maskPic.cacheAsBitmap=!1,this._maskPic.x=this._objRec.x,this._maskPic.y=this._objRec.y,this._maskPic.width=this._objRec.width,this._maskPic.height=this._objRec.height,this._maskPic.cacheAsBitmap=!0,1==this._data.handDir?(this._handPic.scaleY=1,this._handPic.y=this._objRec.y+this._objRec.height-20):2==this._data.handDir&&(this._handPic.scaleY=-1,this._handPic.y=this._objRec.y+20),this._handPic.x=this._objRec.x+.5*this._objRec.width,this._txt.width=0/0,this._txt.height=0/0,this._txt.text=this._data.txt,this._txt.width>320&&(this._txt.text="",this._txt.width=320,this._txt.text=this._data.txt);var n=15;this._textBgPic.cacheAsBitmap=!1,this._textBgPic.width=this._txt.width+2*n+35,this._textBgPic.height=114,1==this._data.txtdir?(this._textBgPic.scaleX=-1,this._textBgPic.scaleY=1,this._textBgPic.x=this._objRec.x):2==this._data.txtdir?(this._textBgPic.scaleX=-1,this._textBgPic.scaleY=-1,this._textBgPic.x=this._objRec.x):3==this._data.txtdir?(this._textBgPic.scaleX=1,this._textBgPic.scaleY=1,this._textBgPic.x=this._objRec.x+this._objRec.width):4==this._data.txtdir&&(this._textBgPic.scaleX=1,this._textBgPic.scaleY=-1,this._textBgPic.x=this._objRec.x+this._objRec.width),this.checkTextBgX(),this._textBgPic.y=this._objRec.y+.5*this._objRec.height,this._txt.x=this._textBgPic.x-(-1==this._textBgPic.scaleX?this._textBgPic.width:-35)+n,this._txt.y=this._textBgPic.y-this._textBgPic.scaleY*this._textBgPic.height*.5,this._textBgPic.cacheAsBitmap=!0}},s.checkTextBgX=function(){if(1==this._textBgPic.scaleX){var t=egret.MainContext.instance.stage.stageWidth;this._textBgPic.x+this._textBgPic.width>t&&(this._textBgPic.x=t-this._textBgPic.width)}else-1==this._textBgPic.scaleX&&this._textBgPic.x-this._textBgPic.width<0&&(this._textBgPic.x=this._textBgPic.width)},e}(egret.Sprite);egret.registerClass(GuideView,"GuideView");var EasyLoading=function(t){function e(){t.call(this),this.content=null,this.speed=.6,this.init()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){this.averageUtils=new AverageUtils,this.content=new egret.Sprite,this.content.graphics.beginFill(0,.2),this.content.graphics.drawRect(0,0,App.StageUtils.getWidth(),App.StageUtils.getHeight()),this.content.graphics.endFill(),this.content.touchEnabled=!0,this.uiImageContainer=new egret.DisplayObjectContainer,this.uiImageContainer.x=.5*this.content.width,this.uiImageContainer.y=.5*this.content.height,this.content.addChild(this.uiImageContainer),RES.getResByUrl("resource/assets/load_Reel.png",function(t){var e=new egret.Bitmap;e.texture=t,e.x=.5*-e.width,e.y=.5*-e.height,this.uiImageContainer.addChild(e)},this,RES.ResourceItem.TYPE_IMAGE)},s.showLoading=function(){App.StageUtils.getStage().addChild(this.content),App.TimerManager.doFrame(1,0,this.enterFrame,this)},s.hideLoading=function(){this.content&&this.content.parent&&(App.StageUtils.getStage().removeChild(this.content),this.uiImageContainer.rotation=0),App.TimerManager.remove(this.enterFrame,this)},s.enterFrame=function(t){this.averageUtils.push(this.speed*t),this.uiImageContainer.rotation+=this.averageUtils.getValue()},e}(BaseClass);egret.registerClass(EasyLoading,"EasyLoading");var ControllerManager=function(t){function e(){t.call(this),this._modules={}}__extends(e,t);var i=(__define,e),s=i.prototype;return s.clear=function(){this._modules={}},s.register=function(t,e){this.isExists(t)||(this._modules[t]=e)},s.unregister=function(t){this.isExists(t)&&(this._modules[t]=null,delete this._modules[t])},s.isExists=function(t){return null!=this._modules[t]},s.applyFunc=function(t,e){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];var n=this._modules[t];if(n){for(var r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];return n.applyFunc.apply(n,r)}return Log.trace("模块"+t+"不存在"),null},s.getControllerModel=function(t){var e=this._modules[t];return e?e.getModel():null},e}(BaseClass);egret.registerClass(ControllerManager,"ControllerManager");var ViewManager=function(t){function e(){t.call(this),this._views={},this._opens=[]}__extends(e,t);var i=(__define,e),s=i.prototype;return s.clear=function(){this.closeAll(),this._views={}},s.register=function(t,e){null!=e&&(this._views[t]||(this._views[t]=e))},s.unregister=function(t){this._views[t]&&(this._views[t]=null,delete this._views[t])},s.destroy=function(t,e){void 0===e&&(e=null);var i=this.getView(t);i&&(this.unregister(t),i.destroy(),i=null),this.register(t,e)},s.open=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var s=this.getView(t);return null==s?void Log.trace("UI_"+t+"不存在"):s.isShow()?(s.open.apply(s,e),s):(s.isInit()?(s.addToParent(),s.open.apply(s,e)):(App.EasyLoading.showLoading(),s.loadResource(function(){s.addToParent(),s.setVisible(!1)}.bind(this),function(){s.initUI(),s.initData(),s.open.apply(s,e),s.setVisible(!0),App.EasyLoading.hideLoading()}.bind(this))),this._opens.push(t),s)},s.close=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(this.isShow(t)){var s=this.getView(t);if(null!=s){var n=this._opens.indexOf(t);t>=0&&this._opens.splice(n,1),s.removeFromParent(),s.close.apply(s,e)}}},s.closeView=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];for(var s=Object.keys(this._views),n=0,r=s.length;r>n;n++){var a=parseInt(s[n]);if(this._views[a]==t)return void this.close(a,e)}},s.getView=function(t){return this._views[t]},s.closeAll=function(){for(;this._opens.length;)this.close(this._opens[0])},s.currOpenNum=function(){return this._opens.length},s.isShow=function(t){return-1!=this._opens.indexOf(t)},e}(BaseClass);egret.registerClass(ViewManager,"ViewManager");var BaseController=function(){function t(){this._messages={}}var e=(__define,t),i=e.prototype;return i.registerFunc=function(t,e,i){this._messages[t]=[e,i]},i.applyFunc=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var s=this._messages[t];return s?s[0].apply(s[1],e):(Log.trace("消息"+t+"不存在侦听"),null)},i.applyControllerFunc=function(t,e){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];return App.ControllerManager.applyFunc.apply(App.ControllerManager,arguments)},i.setModel=function(t){this._model=t},i.getModel=function(){return this._model},i.getControllerModel=function(t){return App.ControllerManager.getControllerModel(t)},t}();egret.registerClass(BaseController,"BaseController");var BaseModel=function(){function t(t){this._controller=t,this._controller.setModel(this)}var e=(__define,t);e.prototype;return t}();egret.registerClass(BaseModel,"BaseModel");var BaseProxy=function(){function t(t){this._controller=t}var e=(__define,t),i=e.prototype;return i.applyFunc=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return this._controller.applyFunc.apply(this._controller,arguments)},i.applyControllerFunc=function(t,e){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];return this._controller.applyControllerFunc.apply(this._controller,arguments)},i.receiveServerMsg=function(t,e,i){App.MessageCenter.addListener(t,e,i)},i.receiveServerMsgOnce=function(t,e,i){var s=function(n){this.removeServerMsg(t,s,this),e.apply(i,n)};this.receiveServerMsg(t,s,this)},i.receiveServerHttpUpdateMsg=function(t,e,i){this.receiveServerMsg(t+"_HttpUpdate",e,i)},i.receiveServerHttpUpdateMsgOnce=function(t,e,i){this.receiveServerMsgOnce(t+"_HttpUpdate",e,i)},i.removeServerMsg=function(t,e,i){App.MessageCenter.removeListener(t,e,i)},i.removeServerHttpUpdateMsg=function(t,e,i){this.removeServerMsg(t+"_HttpUpdate",e,i)},i.sendSocketMsg=function(t){App.Socket.send(t)},i.sendHttpMsg=function(t,e){void 0===e&&(e=null),App.Http.send(t,this.getURLVariables(t,e))},i.getURLVariables=function(t,e){var i=t.split("."),s={};s.mod=i[0],s["do"]=i[1],null!=e&&(s.p=e);var n=JSON.stringify(s),r=new egret.URLVariables("data="+n+"&h="+App.ProxyUserFlag);return r},t}();egret.registerClass(BaseProxy,"BaseProxy");var BaseEuiView=function(t){function e(e,i){t.call(this),this._resources=null,this._controller=e,this._myParent=i,this._isInit=!1,this.percentHeight=100,this.percentWidth=100}__extends(e,t);var i=__define,s=e,n=s.prototype;return i(n,"myParent",function(){return this._myParent}),n.setResources=function(t){this._resources=t},n.isInit=function(){return this._isInit},n.applyFunc=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return this._controller.applyFunc.apply(this._controller,arguments)},n.applyControllerFunc=function(t,e){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];return this._controller.applyControllerFunc.apply(this._controller,arguments)},n.isShow=function(){return null!=this.stage&&this.visible},n.addToParent=function(){this._myParent.addChild(this)},n.removeFromParent=function(){App.DisplayUtils.removeFromParent(this)},n.initUI=function(){this._isInit=!0},n.initData=function(){},n.destroy=function(){this._controller=null,this._myParent=null,this._resources=null},n.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e]},n.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e]},n.loadResource=function(t,e){this._resources&&this._resources.length>0?(App.ResourceUtils.loadResource(this._resources,[],t,null,this),this.addEventListener(eui.UIEvent.CREATION_COMPLETE,e,this)):(t(),e())
},n.setVisible=function(t){this.visible=t},e}(eui.Component);egret.registerClass(BaseEuiView,"BaseEuiView",["IBaseView"]);var BaseSpriteView=function(t){function e(e,i){t.call(this),this._resources=null,this._controller=e,this._myParent=i,this._isInit=!1,App.StageUtils.getStage().addEventListener(egret.Event.RESIZE,this.onResize,this)}__extends(e,t);var i=__define,s=e,n=s.prototype;return n.setResources=function(t){this._resources=t},i(n,"myParent",function(){return this._myParent}),n.isInit=function(){return this._isInit},n.applyFunc=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return this._controller.applyFunc.apply(this._controller,arguments)},n.applyControllerFunc=function(t,e){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];return this._controller.applyControllerFunc.apply(this._controller,arguments)},n.isShow=function(){return null!=this.stage&&this.visible},n.addToParent=function(){this._myParent.addChild(this)},n.removeFromParent=function(){App.DisplayUtils.removeFromParent(this)},n.initUI=function(){this._isInit=!0},n.initData=function(){},n.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e]},n.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e]},n.destroy=function(){this._controller=null,this._myParent=null,this._resources=null},n.onResize=function(){},n.loadResource=function(t,e){this._resources&&this._resources.length>0?App.ResourceUtils.loadResource(this._resources,[],function(){t(),e()},null,this):(t(),e())},n.setVisible=function(t){this.visible=t},e}(egret.DisplayObjectContainer);egret.registerClass(BaseSpriteView,"BaseSpriteView",["IBaseView"]);var DynamicChange=function(){function t(){this._dataCache=[],this._pUpdate=new ProxyUpdate(this._dataCache)}var e=__define,i=t,s=i.prototype;return e(s,"pUpdate",function(){return this._pUpdate}),s.getCacheData=function(t){return this._dataCache[t]?this._dataCache[t]:null},s.clearCache=function(){for(var t=Object.keys(this._dataCache),e=0,i=t.length;i>e;e++){var s=t[e];this._dataCache[s]=null,delete this._dataCache[s]}},s.getCacheKeyInfos=function(){for(var t=[],e=Object.keys(this._dataCache),i=0,s=e.length;s>i;i++){var n=e[i],r=this._dataCache[n];t.push(r)}return t},s.isCache=function(t){return this._dataCache[t]},t}();egret.registerClass(DynamicChange,"DynamicChange");var ProxyUpdate=function(){function t(t){this._cache=t}var e=(__define,t),i=e.prototype;return i.isArray=function(t){return t instanceof Array},i.isObject=function(t){return t.indexOf("object")>-1},i.isNormal=function(t){var e=t.indexOf("@")>-1,i=t.indexOf(".")>-1,s=t.indexOf("_")>-1;return!e&&!i&&!s},i.isAddToArray=function(t){return"@a"==t},i.isRemoveToArray=function(t){var e=t.split("_");return e.length<=3&&"@d"==e[0]},i.isFilter=function(t){var e=t.split("_");return"@f"==e[0]},i.isNumeric=function(t){return parseFloat(t).toString()==t.toString()},i._updateObject=function(t,e,i){var s=t.split(".");"@a"==s[0]||"@s"==s[0]?i[s[1]]=e:"@d"==s[0]&&delete i[s[1]]},i._getFilterObject=function(t,e){if(e){var i=t.split("_");if(3==i.length&&"@f"==i[0]&&this.isArray(e))for(var s=i[1],n=i[2],r=0;r<e.length;r++){var a=e[r];if(3==i.length&&this.isObject(a.toString())){var o=a[s];if(o&&("@"==n[0]&&(n=n.replace("@","")),n==o))return a}}}return null},i._addObjectToArray=function(t,e){if(this.isArray(e))for(var i=0;i<e.length;i++)t.push(e[i]);else t.push(e)},i._removeObjectFromArray=function(t,e,i){var s=e.split("_");if(s.length<=3&&"@d"==s[0]&&this.isArray(t))for(var n=t.length,r=n-1;r>=0;r--){var a=t[r];if(3==s.length){if(a.hasOwnProperty(s[1])){var o=s[2];"@"==o[0]&&(o=o.replace("@","")),o==a[s[1]]&&t.splice(r,1)}}else 2==s.length&&a.hasOwnProperty(s[1])?i==a[s[1]]&&t.splice(r,1):1==s.length&&i==a&&t.splice(r,1)}},i.update=function(t,e){if(this._cache[t]=e,e.hasOwnProperty("c"))for(var i=e.c,s=Object.keys(i),n=0,r=s.length;r>n;n++){var a=s[n];this._cache[a]&&(this._update(this._cache[a],i[a]),App.MessageCenter.dispatch(a+"_HttpUpdate"))}},i._update=function(t,e){if(t&&e&&this.isObject(e.toString()))for(var i=Object.keys(e),s=0,n=i.length;n>s;s++){var r=i[s],a=e[r];if(this.isNormal(r)&&this.isObject(a.toString()))t.hasOwnProperty(r)&&this._update(t[r],a);else if(this.isNormal(r)&&this.isNumeric(a)){var o=t[r];t[r]=o+a}else if(this.isNormal(r))t[r]=a;else if(this.isAddToArray(r))this._addObjectToArray(t,a);else if(this.isRemoveToArray(r))this._removeObjectFromArray(t,r,a);else if(this.isFilter(r)){var h=this._getFilterObject(r,t);h&&this._update(h,a)}else this._updateObject(r,a,t)}},t}();egret.registerClass(ProxyUpdate,"ProxyUpdate");var Http=function(t){function e(){t.call(this),this._data=new DynamicChange,this._cache=[],this._request=new egret.URLRequest,this._request.method=egret.URLRequestMethod.POST,this._urlLoader=new egret.URLLoader,this._urlLoader.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onError,this)}__extends(e,t);var i=__define,s=e,n=s.prototype;return n.initServer=function(t){this._serverUrl=t},i(n,"Data",function(){return this._data}),n.onError=function(t){this.nextPost()},n.send=function(t,e){this._cache.push([t,e]),this.post()},n.post=function(){if(!this._isRequesting&&0!=this._cache.length){var t=this._cache.shift(),e=t[0],i=t[1];this._type=e,this._request.url=this._serverUrl,this._request.data=i,this._urlLoader.addEventListener(egret.Event.COMPLETE,this.onLoaderComplete,this),this._urlLoader.load(this._request),this._isRequesting=!0}},n.onLoaderComplete=function(t){this._urlLoader.removeEventListener(egret.Event.COMPLETE,this.onLoaderComplete,this);var e=JSON.parse(this._urlLoader.data);e.hasOwnProperty("s")&&0!=e.s?Log.trace("Http错误:"+e.s):(this._data.pUpdate.update(this._type,e),App.MessageCenter.dispatch(this._type,e)),this.nextPost()},n.nextPost=function(){this._isRequesting=!1,this.post()},e}(BaseClass);egret.registerClass(Http,"Http");var ByteArrayMsg=function(){function t(){this._msgBuffer=new egret.ByteArray}var e=(__define,t),i=e.prototype;return i.receive=function(t){t.readBytes(this._msgBuffer);var e=this.decode(this._msgBuffer);e&&App.MessageCenter.dispatch(e.key,e.body),0==this._msgBuffer.bytesAvailable&&this._msgBuffer.clear()},i.send=function(t,e){var i=this.encode(e);i&&(i.position=0,t.writeBytes(i,0,i.bytesAvailable))},i.decode=function(t){return Log.trace("decode需要子类重写，根据项目的协议结构解析"),null},i.encode=function(t){return Log.trace("encode需要子类重写，根据项目的协议结构解析"),null},t}();egret.registerClass(ByteArrayMsg,"ByteArrayMsg",["BaseMsg"]);var ByteArrayMsgByProtobuf=function(t){function e(){t.call(this),this.msgClass=null,this.protoConfig=null,this.protoConfigSymmetry=null,this.msgClass={},this.protoConfig=App.ProtoConfig,this.protoConfigSymmetry={};for(var e=Object.keys(this.protoConfig),i=0,s=e.length;s>i;i++){var n=e[i],r=this.protoConfig[n];this.protoConfigSymmetry[r]=n}}__extends(e,t);var i=(__define,e),s=i.prototype;return s.getMsgClass=function(t){var e=this.msgClass[t];return null==e&&(e=App.ProtoFile.build(t),this.msgClass[t]=e),e},s.getMsgID=function(t){return this.protoConfigSymmetry[t]},s.getMsgKey=function(t){return this.protoConfig[t]},s.decode=function(t){var e=t.readShort(),i=t.readShort();if(t.bytesAvailable>=i){var s=new egret.ByteArray;t.readBytes(s,0,i);var n={};return n.key=this.getMsgKey(e),App.DebugUtils.start("Protobuf Decode"),n.body=this.getMsgClass(n.key).decode(s.buffer),App.DebugUtils.stop("Protobuf Decode"),Log.trace("收到数据：","["+e+" "+n.key+"]",n.body),n}return null},s.encode=function(t){var e=this.getMsgID(t.key),i=new(this.getMsgClass(t.key))(t.body);App.DebugUtils.start("Protobuf Encode");var s=new egret.ByteArray(i.toArrayBuffer());App.DebugUtils.stop("Protobuf Encode"),Log.trace("发送数据：","["+e+" "+t.key+"]",t.body);var n=new egret.ByteArray;return n.writeShort(e),n.writeBytes(s),n},e}(ByteArrayMsg);egret.registerClass(ByteArrayMsgByProtobuf,"ByteArrayMsgByProtobuf");var Socket=function(t){function e(){t.call(this),this._needReconnect=!1,this._maxReconnectCount=10,this._reconnectCount=0}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addEvents=function(){this._socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this._socket.addEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this._socket.addEventListener(egret.Event.CLOSE,this.onSocketClose,this),this._socket.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this)},s.removeEvents=function(){this._socket.removeEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this._socket.removeEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this._socket.removeEventListener(egret.Event.CLOSE,this.onSocketClose,this),this._socket.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this)},s.onSocketOpen=function(){this._reconnectCount=0,this._connectFlag?App.MessageCenter.dispatch(SocketConst.SOCKET_RECONNECT):App.MessageCenter.dispatch(SocketConst.SOCKET_CONNECT),this._connectFlag=!0,this._isConnecting=!0},s.onSocketClose=function(){this._needReconnect?(this.reconnect(),App.MessageCenter.dispatch(SocketConst.SOCKET_START_RECONNECT)):App.MessageCenter.dispatch(SocketConst.SOCKET_CLOSE),this._isConnecting=!1},s.onSocketError=function(){this._needReconnect?this.reconnect():App.MessageCenter.dispatch(SocketConst.SOCKET_NOCONNECT),this._isConnecting=!1},s.onReceiveMessage=function(t){this._msg.receive(this._socket)},s.initServer=function(t,e,i){this._host=t,this._port=e,this._msg=i},s.connect=function(){return App.DeviceUtils.IsHtml5&&!window.WebSocket?void Log.trace("不支持WebSocket"):(this._socket=new egret.WebSocket,this._msg instanceof ByteArrayMsg&&(this._socket.type=egret.WebSocket.TYPE_BINARY),Log.trace("WebSocket: "+this._host+":"+this._port),this._socket.connect(this._host,this._port),void this.addEvents())},s.reconnect=function(){this.close(),this._reconnectCount++,this._reconnectCount<this._maxReconnectCount?this.connect():(this._reconnectCount=0,this._connectFlag?App.MessageCenter.dispatch(SocketConst.SOCKET_CLOSE):App.MessageCenter.dispatch(SocketConst.SOCKET_NOCONNECT))},s.send=function(t){this._msg.send(this._socket,t)},s.close=function(){this.removeEvents(),this._socket.close(),this._socket=null,this._isConnecting=!1,this._connectFlag=!1},s.isConnecting=function(){return this._isConnecting},s.debugInfo=function(t){App.MessageCenter.dispatch(SocketConst.SOCKET_DEBUG_INFO,t)},e}(BaseClass);egret.registerClass(Socket,"Socket");var SocketConst=function(){function t(){}var e=(__define,t);e.prototype;return t.SOCKET_CONNECT="SOCKET_CONNECT",t.SOCKET_RECONNECT="SOCKET_RECONNECT",t.SOCKET_START_RECONNECT="SOCKET_START_RECONNECT",t.SOCKET_CLOSE="SOCKET_CLOSE",t.SOCKET_DATA="SOCKET_DATA",t.SOCKET_NOCONNECT="SOCKET_NOCONNECT",t.SOCKET_DEBUG_INFO="SOCKET_DEBUG_INFO",t}();egret.registerClass(SocketConst,"SocketConst");var UTFMsg=function(){function t(){}var e=(__define,t),i=e.prototype;return i.receive=function(t){var e=t.readUTF(),i=this.decode(e);i&&App.MessageCenter.dispatch(i.key,i.body)},i.send=function(t,e){var i=this.encode(e);i&&(t.type=egret.WebSocket.TYPE_STRING,t.writeUTF(i))},i.decode=function(t){return Log.trace("decode需要子类重写，根据项目的协议结构解析"),null},i.encode=function(t){return Log.trace("encode需要子类重写，根据项目的协议结构解析"),null},t}();egret.registerClass(UTFMsg,"UTFMsg",["BaseMsg"]);var UTFMsgByJson=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.decode=function(t){return JSON.parse(t)},s.encode=function(t){return JSON.stringify(t)},e}(UTFMsg);egret.registerClass(UTFMsgByJson,"UTFMsgByJson");var BaseEuiLayer=function(t){function e(){t.call(this),this.percentWidth=100,this.percentHeight=100,this.touchEnabled=!1}__extends(e,t);var i=(__define,e);i.prototype;return e}(eui.Group);egret.registerClass(BaseEuiLayer,"BaseEuiLayer");var BaseScene=function(){function t(){this._layers=new Array}var e=(__define,t),i=e.prototype;return i.onEnter=function(){},i.onExit=function(){App.ViewManager.closeAll(),this.removeAllLayer()},i.addLayer=function(t){t instanceof BaseSpriteLayer?(App.StageUtils.getStage().addChild(t),this._layers.push(t)):t instanceof BaseEuiLayer&&(App.StageUtils.getUIStage().addChild(t),this._layers.push(t))},i.addLayerAt=function(t,e){t instanceof BaseSpriteLayer?(App.StageUtils.getStage().addChildAt(t,e),this._layers.push(t)):t instanceof BaseEuiLayer&&(App.StageUtils.getUIStage().addChildAt(t,e),this._layers.push(t))},i.removeLayer=function(t){t instanceof BaseSpriteLayer?(App.StageUtils.getStage().removeChild(t),this._layers.splice(this._layers.indexOf(t),1)):t instanceof BaseEuiLayer&&(App.StageUtils.getUIStage().removeChild(t),this._layers.splice(this._layers.indexOf(t),1))},i.layerRemoveAllChild=function(t){t instanceof BaseSpriteLayer?t.removeChildren():t instanceof BaseEuiLayer&&t.removeChildren()},i.removeAllLayer=function(){for(;this._layers.length;){var t=this._layers[0];this.layerRemoveAllChild(t),this.removeLayer(t)}},t}();egret.registerClass(BaseScene,"BaseScene");var BaseSpriteLayer=function(t){function e(){t.call(this),this.touchEnabled=!1}__extends(e,t);var i=(__define,e);i.prototype;return e}(egret.DisplayObjectContainer);egret.registerClass(BaseSpriteLayer,"BaseSpriteLayer");var SceneManager=function(t){function e(){t.call(this),this._scenes={}}__extends(e,t);var i=(__define,e),s=i.prototype;return s.clear=function(){var t=this._scenes[this._currScene];t&&(t.onExit(),this._currScene=void 0),this._scenes={}},s.register=function(t,e){this._scenes[t]=e},s.runScene=function(t){var e=this._scenes[t];if(null==e)return void Log.trace("场景"+t+"不存在");var i=this._scenes[this._currScene];i&&i.onExit(),e.onEnter(),this._currScene=t},s.getCurrScene=function(){return this._currScene},e}(BaseClass);egret.registerClass(SceneManager,"SceneManager");var BaseSound=function(){function t(){this._cache={},this._loadingCache=new Array,App.TimerManager.doTimer(6e4,0,this.dealSoundTimer,this)}var e=(__define,t),i=e.prototype;return i.dealSoundTimer=function(){for(var t=egret.getTimer(),e=Object.keys(this._cache),i=0,s=e.length;s>i;i++){var n=e[i];this.checkCanClear(n)&&t-this._cache[n]>=SoundManager.CLEAR_TIME&&(delete this._cache[n],RES.destroyRes(n))}},i.getSound=function(t){var e=RES.getRes(t);if(e)this._cache[t]&&(this._cache[t]=egret.getTimer());else{if(-1!=this._loadingCache.indexOf(t))return null;this._loadingCache.push(t),RES.getResAsync(t,this.onResourceLoadComplete,this)}return e},i.onResourceLoadComplete=function(t,e){var i=this._loadingCache.indexOf(e);-1!=i&&(this._loadingCache.splice(i,1),this._cache[e]=egret.getTimer(),this.loadedPlay(e))},i.loadedPlay=function(t){},i.checkCanClear=function(t){return!0},t}();egret.registerClass(BaseSound,"BaseSound");var SoundBg=function(t){function e(){t.call(this),this._currBg=""}__extends(e,t);var i=(__define,e),s=i.prototype;return s.stop=function(){this._currSoundChannel&&this._currSoundChannel.stop(),this._currSoundChannel=null,this._currSound=null,this._currBg=""},s.play=function(t){if(this._currBg!=t){this.stop(),this._currBg=t;var e=this.getSound(t);e&&this.playSound(e)}},s.playSound=function(t){this._currSound=t,this._currSoundChannel=this._currSound.play(0,1),this._currSoundChannel.volume=this._volume},s.setVolume=function(t){this._volume=t,this._currSoundChannel&&(this._currSoundChannel.volume=this._volume)},s.loadedPlay=function(t){this._currBg==t&&this.playSound(RES.getRes(t))},s.checkCanClear=function(t){return this._currBg!=t},e}(BaseSound);egret.registerClass(SoundBg,"SoundBg");var SoundEffects=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.play=function(t){var e=this.getSound(t);e&&this.playSound(e)},s.playSound=function(t){var e=t.play(0,1);e.volume=this._volume},s.setVolume=function(t){this._volume=t},s.loadedPlay=function(t){this.playSound(RES.getRes(t))},e}(BaseSound);egret.registerClass(SoundEffects,"SoundEffects");var SoundManager=function(t){function e(){t.call(this),this.bgOn=!0,this.effectOn=!0,this.bgVolume=.5,this.effectVolume=.5,this.bg=new SoundBg,this.bg.setVolume(this.bgVolume),this.effect=new SoundEffects,this.effect.setVolume(this.effectVolume)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.playEffect=function(t){this.effectOn&&this.effect.play(t)},s.playBg=function(t){this.currBg=t,this.bgOn&&this.bg.play(t)},s.stopBg=function(){this.bg.stop()},s.setEffectOn=function(t){this.effectOn=t},s.setBgOn=function(t){this.bgOn=t,this.bgOn?this.currBg&&this.playBg(this.currBg):this.stopBg()},s.setBgVolume=function(t){t=Math.min(t,1),t=Math.max(t,0),this.bgVolume=t,this.bg.setVolume(this.bgVolume)},s.getBgVolume=function(){return this.bgVolume},s.setEffectVolume=function(t){t=Math.min(t,1),t=Math.max(t,0),this.effectVolume=t,this.effect.setVolume(this.effectVolume)},s.getEffectVolume=function(){return this.effectVolume},e.CLEAR_TIME=18e4,e}(BaseClass);egret.registerClass(SoundManager,"SoundManager");var starlingswf;!function(t){var e=function(){function e(i,s,n){void 0===n&&(n=24),this._swfData=i,this._assetManager=s,this._createDisplayFuns=new Object,this._createDisplayFuns[e.dataKey_Sprite]=this.createSprite,this._createDisplayFuns[e.dataKey_MovieClip]=this.createMovie,this._createDisplayFuns[e.dataKey_Image]=this.createImage,this._createDisplayFuns[e.dataKey_Scale9]=this.createS9Image,this._createDisplayFuns[e.dataKey_ShapeImg]=this.createShapeImage,this._createDisplayFuns[e.dataKey_TextField]=this.createTextField,this.swfUpdateManager=t.SwfUpdateManager.createSwfUpdateManager(n)}var i=(__define,e),s=i.prototype;return s.createSprite=function(i,s,n){void 0===s&&(s=null),void 0===n&&(n=null),null==n&&(n=this._swfData[e.dataKey_Sprite][i]);for(var r,a,o,h=new t.SwfSprite,l=n.length,c=0;l>c;c++)r=n[c],o=this._createDisplayFuns[r[1]],null!=o&&(a=o.apply(this,[r[0],r]),a.name=r[9],a.x=r[2],a.y=r[3],r[0]==e.dataKey_TextField,r[1]!=e.dataKey_Scale9&&r[1]!=e.dataKey_ShapeImg&&(a.scaleX=r[4],a.scaleY=r[5]),a.skewX=r[6],a.skewY=r[7],a.alpha=r[8],h.addChild(a));return h},s.createMovie=function(i,s,n){void 0===s&&(s=null),void 0===n&&(n=null);var r,a,o,h,l,c=this._swfData[e.dataKey_MovieClip][i],u=c.objCount,g={};for(l in u){a=u[l][0],o=u[l][1],r=null==g[l]?[]:g[l];for(var d=0;o>d;d++)h=this._createDisplayFuns[a],null!=h&&r.push(h.apply(this,[l,null]));g[l]=r}var f;return f=null==n?new t.SwfMovieClip(c.frames,c.labels,g,this):new n(c.frames,c.labels,g,this),f.loop=c.loop,f},s.createImage=function(t,i){void 0===i&&(i=null);var s=this._swfData[e.dataKey_Image][t],n=this._assetManager.createBitmap(t);return n.anchorOffsetX=s[0],n.anchorOffsetY=s[1],n},s.getTexture=function(t){return this._assetManager.getTexture(t)},s.createS9Image=function(t,i){void 0===i&&(i=null);var s=this._swfData[e.dataKey_Scale9][t],n=this._assetManager.createBitmap(t);return n.scale9Grid=new egret.Rectangle(s[0],s[1],s[2],s[3]),null!=i&&(n.width=i[10],n.height=i[11]),n},s.createShapeImage=function(t,e){void 0===e&&(e=null);var i=this._assetManager.createBitmap(t);return i.fillMode=egret.BitmapFillMode.REPEAT,null!=e&&(i.width=e[10],i.height=e[11]),i},s.createTextField=function(t,e){void 0===e&&(e=null);var i=new egret.TextField;return null!=e&&(i.width=e[10],i.height=e[11],i.textColor=e[13],i.size=e[14],i.textAlign=e[15],i.text=e[18]),i},s.hasSprite=function(t){return null!=this._swfData[e.dataKey_Sprite][t]},s.hasMovieClip=function(t){return null!=this._swfData[e.dataKey_MovieClip][t]},s.hasImage=function(t){return null!=this._swfData[e.dataKey_Image][t]},s.hasS9Image=function(t){return null!=this._swfData[e.dataKey_Scale9][t]},s.hasShapeImage=function(t){return null!=this._swfData[e.dataKey_ShapeImg][t]},e.dataKey_Sprite="spr",e.dataKey_Image="img",e.dataKey_MovieClip="mc",e.dataKey_TextField="text",e.dataKey_Button="btn",e.dataKey_Scale9="s9",e.dataKey_ShapeImg="shapeImg",e.dataKey_Component="comp",e.dataKey_Particle="particle",e}();t.Swf=e,egret.registerClass(e,"starlingswf.Swf")}(starlingswf||(starlingswf={}));var starlingswf;!function(t){var e=function(){function t(){this._sheets={},this._textures={}}var e=(__define,t),i=e.prototype;return i.addSpriteSheet=function(t,e){this._sheets[t]=e},i.addTexture=function(t,e){this._textures[t]=e},i.createBitmap=function(t){var e=this.getTexture(t);if(null==e)return null;var i=new egret.Bitmap;return i.texture=e,i},i.getTexture=function(t){var e,i,s;for(s in this._sheets)if(i=this._sheets[s],e=i.getTexture(t),null!=e)break;return null==e&&(e=this._textures[t]),e},t}();t.SwfAssetManager=e,egret.registerClass(e,"starlingswf.SwfAssetManager")}(starlingswf||(starlingswf={}));var starlingswf;!function(t){var e=function(){function t(){}var e=(__define,t),i=e.prototype;return t.createSwfUpdateManager=function(e){var i=new t;return i._animations=[],i._addQueue=[],i._removeQueue=[],i._currentTime=0,i.setFps(e),App.TimerManager.doFrame(1,0,i.update,i),i},i.clear=function(){this._addQueue.splice(0),this._removeQueue.splice(0),this._animations.splice(0)},i.stop=function(){this.clear(),App.TimerManager.remove(this.update,this)},i.play=function(){App.TimerManager.doFrame(1,0,this.update,this)},i.setFps=function(t){this._fps=t,this._fpsTime=1e3/t},i.addSwfAnimation=function(t){this._addQueue.push(t)},i.removeSwfAnimation=function(t){this._removeQueue.push(t);var e=this._addQueue.indexOf(t);-1!=e&&this._addQueue.splice(e,1)},i.updateAdd=function(){for(var t,e,i=this._addQueue.length,s=0;i>s;s++)e=this._addQueue.pop(),t=this._animations.indexOf(e),-1==t&&this._animations.push(e)},i.updateRemove=function(){for(var t,e,i=this._removeQueue.length,s=0;i>s;s++)e=this._removeQueue.pop(),t=this._animations.indexOf(e),-1!=t&&this._animations.splice(t,1)},i.update=function(t){if(this._currentTime+=t,!(this._currentTime<this._fpsTime)){this._currentTime-=this._fpsTime,this._update();for(var e=0;this._currentTime>this._fpsTime;)this._currentTime-=this._fpsTime,e++,4>e&&this._update()}},i._update=function(){this.updateRemove(),this.updateAdd();for(var t=this._animations.length,e=0;t>e;e++)this._animations[e].update()},t}();t.SwfUpdateManager=e,egret.registerClass(e,"starlingswf.SwfUpdateManager")}(starlingswf||(starlingswf={}));var starlingswf;!function(t){var e=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.getTextField=function(t){return this.getChildByName(t)},s.getMovie=function(t){return this.getChildByName(t)},s.getSprite=function(t){return this.getChildByName(t)},s.getImage=function(t){return this.getChildByName(t)},e}(egret.DisplayObjectContainer);t.SwfSprite=e,egret.registerClass(e,"starlingswf.SwfSprite")}(starlingswf||(starlingswf={}));var starlingswf;!function(t){var e=function(e){function i(t,i,s,n){e.call(this),this._isPlay=!1,this.loop=!0,this._completeFunction=null,this._hasCompleteListener=!1,this._frames=t,this._labels=i,this._displayObjects=s,this._startFrame=0,this._endFrame=this._frames.length-1,this._ownerSwf=n,this.setCurrentFrame(0),this.play()}__extends(i,e);var s=(__define,i),n=s.prototype;return n.update=function(){if(this._isPlay)if(this._currentFrame>this._endFrame){if(this._hasCompleteListener&&this.dispatchEventWith(egret.Event.COMPLETE),this._currentFrame=this._startFrame,!this.loop)return void(this._ownerSwf&&this.stop(!1));if(this._startFrame==this._endFrame)return void(this._ownerSwf&&this.stop(!1));this.setCurrentFrame(this._startFrame)}else this.setCurrentFrame(this._currentFrame),this._currentFrame+=1},n.setCurrentFrame=function(e){this.$children.length=0,this._currentFrame=e,this.__frameInfos=this._frames[this._currentFrame];for(var i,s,n,r,a=this.__frameInfos.length,o=0;a>o;o++)i=this.__frameInfos[o],r=i[10],s=this._displayObjects[i[0]][r],s.skewX=i[6],s.skewY=i[7],s.alpha=i[8],s.name=i[9],s.x=i[2],s.y=i[3],i[1]==t.Swf.dataKey_Scale9?(s.width=i[11],s.height=i[12]):(s.scaleX=i[4],s.scaleY=i[5]),this.$children.push(s),s.$parent=this,i[1]==t.Swf.dataKey_TextField&&(n=s,n.width=i[11],n.height=i[12],n.textColor=i[14],n.size=i[15],n.textAlign=i[16],i[19]&&"\r"!=i[19]&&""!=i[19]&&(n.text=i[19]))},n.getCurrentFrame=function(){return this._currentFrame},n.play=function(){this._isPlay=!0,this._ownerSwf.swfUpdateManager.addSwfAnimation(this);var e,i,s;for(e in this._displayObjects)if(0==e.indexOf(t.Swf.dataKey_MovieClip)){i=this._displayObjects[e],s=i.length;for(var n=0;s>n;n++)i[n].play()}},n.stop=function(e){if(void 0===e&&(e=!0),this._isPlay=!1,this._ownerSwf.swfUpdateManager.removeSwfAnimation(this),e){var i,s,n;for(i in this._displayObjects)if(0==i.indexOf(t.Swf.dataKey_MovieClip)){s=this._displayObjects[i],n=s.length;for(var r=0;n>r;r++)s[r].stop(e)}}},n.gotoAndStop=function(t,e){void 0===e&&(e=!0),this.goTo(t),this.stop(e)},n.gotoAndPlay=function(t){this.goTo(t),this.play()},n.goTo=function(t){if("string"==typeof t){var e=this.getLabelData(t);this._currentLabel=e[0],this._currentFrame=this._startFrame=e[1],this._endFrame=e[2]}else"number"==typeof t&&(this._currentFrame=this._startFrame=t,this._endFrame=this._frames.length-1);this.setCurrentFrame(this._currentFrame)},n.getLabelData=function(t){for(var e,i=this._labels.length,s=0;i>s;s++)if(e=this._labels[s],e[0]==t)return e;return null},n.isPlay=function(){return this._isPlay},n.totalFrames=function(){return this._frames.length},n.currentLabel=function(){return this._currentLabel},n.labels=function(){for(var t=this._labels.length,e=[],i=0;t>i;i++)e.push(this._labels[i][0]);return e},n.hasLabel=function(t){var e=this.labels();return!(-1==e.indexOf(t))},n.addEventListener=function(t,i,s,n,r){void 0===n&&(n=!1),void 0===r&&(r=0),e.prototype.addEventListener.call(this,t,i,s,n,r),this._hasCompleteListener=this.hasEventListener(egret.Event.COMPLETE)},n.removeEventListener=function(t,i,s,n){void 0===n&&(n=!1),e.prototype.removeEventListener.call(this,t,i,s,n),this._hasCompleteListener=this.hasEventListener(egret.Event.COMPLETE)},n.getLabelStartFrame=function(t){return this.getLabelData(t)[1]},n.getLabelEndFrame=function(t){return this.getLabelData(t)[2]},i}(t.SwfSprite);t.SwfMovieClip=e,egret.registerClass(e,"starlingswf.SwfMovieClip",["starlingswf.ISwfAnimation"])}(starlingswf||(starlingswf={}));var StarlingSwfFactory=function(t){function e(){t.call(this),this.swfAssetsManager=new starlingswf.SwfAssetManager,this.swfAssetsNames=new Array,this.swfAssets=new Array,this.swfData={}}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addSwf=function(t,e,i){if(-1==this.swfAssetsNames.indexOf(t)){if(null==e||null==i)return void console.log("SWF加载失败:"+t);this.swfAssetsManager.addSpriteSheet(t,i);var s=new starlingswf.Swf(e,this.swfAssetsManager,24);s.name=t,StarlingSwfUtils.addSwf(s),this.swfAssetsNames.push(t),this.swfAssets.push(s)}},s.stopSwfs=function(t){for(var e=0,i=t.length;i>e;e++){var s=StarlingSwfUtils.getSwf(t[e]);s&&s.swfUpdateManager.stop()}},s.playSwfs=function(t){for(var e=0,i=t.length;i>e;e++){var s=StarlingSwfUtils.getSwf(t[e]);s&&s.swfUpdateManager.play()}},s.clearSwfs=function(){for(;this.swfAssets.length;)StarlingSwfUtils.removeSwf(this.swfAssets.pop());for(;this.swfAssetsNames.length;)this.swfAssetsNames.pop();this.swfAssetsManager=new starlingswf.SwfAssetManager},s.clear=function(){this.clearSwfs()},s.makeMc=function(t){var e=StarlingSwfUtils.createMovie("mc_"+t,null,StarlingSwfMovieClip);return null==e&&console.log("SWF创建失败: "+t),e},s.makeImage=function(t){return StarlingSwfUtils.createImage("img_"+t)},s.getTexture=function(t){return StarlingSwfUtils.getTexture("img_"+t)},e}(BaseClass);egret.registerClass(StarlingSwfFactory,"StarlingSwfFactory");var StarlingSwfMovieClip=function(t){function e(e,i,s,n){t.call(this,e,i,s,n),this.frameActions={},this.preFrame=-1,this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onRemove=function(){this.stop()},s.setFrameAction=function(t,e,i,s){void 0===s&&(s=null),this.frameActions[t]=[e,i,s]},s.setCompleteAction=function(t,e){this.complateFunc=t,this.complateObj=e,this.addEventListener(egret.Event.COMPLETE,this.onPlayend,this)},s.onPlayend=function(){this.complateFunc&&this.complateFunc.call(this.complateObj)},s.goToPlay=function(t){this.preFrame=-1,this.currFrameName=t,this.gotoAndPlay(t)},s.setCurrentFrame=function(e){t.prototype.setCurrentFrame.call(this,e);var i=this.getCurrentFrame();if(this.preFrame!=i&&(this.preFrame=i,this.frameActions&&this.frameActions[i])){var s=this.frameActions[i];s[2]?s[0].call(s[1],s[2]):s[0].call(s[1])}},s.dispose=function(){this.stop(),this.removeEventListener(egret.Event.COMPLETE,this.onPlayend,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),App.DisplayUtils.removeFromParent(this),this.complateFunc=null,this.complateObj=null,this.frameActions=null},e}(starlingswf.SwfMovieClip);egret.registerClass(StarlingSwfMovieClip,"StarlingSwfMovieClip");var StarlingSwfUtils=function(){function t(){}var e=(__define,t);e.prototype;return t.addSwf=function(e){t.swfList.push(e)},t.removeSwf=function(e){var i=t.swfList.indexOf(e);-1!=i&&t.swfList.splice(i,1)},t.createSprite=function(e,i,s){void 0===i&&(i=null),void 0===s&&(s=null);for(var n=t.swfList.length,r=0;n>r;r++){var a=t.swfList[r];if(a.hasSprite(e))return a.createSprite(e,i,s)}return null},t.createImage=function(e,i){void 0===i&&(i=null);for(var s=t.swfList.length,n=0;s>n;n++){var r=t.swfList[n];if(r.hasImage(e))return r.createImage(e,i)}return null},t.getTexture=function(e){for(var i=t.swfList.length,s=0;i>s;s++){var n=t.swfList[s];if(n.hasImage(e))return n.getTexture(e)}return null},t.createMovie=function(e,i,s){void 0===i&&(i=null),void 0===s&&(s=null);for(var n=t.swfList.length,r=0;n>r;r++){var a=t.swfList[r];if(a.hasMovieClip(e))return a.createMovie(e,i,s)}return null},t.createS9Image=function(e,i){void 0===i&&(i=null);for(var s=t.swfList.length,n=0;s>n;n++){var r=t.swfList[n];if(r.hasS9Image(e))return r.createS9Image(e,i)}return null},t.createShapeImage=function(e,i){void 0===i&&(i=null);for(var s=t.swfList.length,n=0;s>n;n++){var r=t.swfList[n];if(r.hasShapeImage(e))return r.createShapeImage(e,i)}return null},t.getSwf=function(e){for(var i=t.swfList.length,s=0;i>s;s++){var n=t.swfList[s];if(n.name==e)return n}return null},t.fixButton=function(e,i,s){t.firstAddBtn&&(t.firstAddBtn=!1,egret.MainContext.instance.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),egret.MainContext.instance.stage.addEventListener(egret.Event.LEAVE_STAGE,this.onTouchEnd,this));var n=new StarlingSwfButtonData;n.btn=e,n.onClick=i,n.thisObj=s,t.btnList.push(n),e.touchEnabled=!0,e.gotoAndStop(0),e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBtnTouchBegin,e)},t.onBtnTouchBegin=function(e){for(var i=e.currentTarget,s=t.btnList.length,n=0;s>n;n++){var r=t.btnList[n];if(r.btn==i){r.touchStageX=e.stageX,r.touchStageY=e.stageY,i.gotoAndStop(1);break}}},t.onTouchEnd=function(e){for(var i=t.btnList.length,s=0;i>s;s++){var n=t.btnList[s];-1!=n.touchStageX&&(e.stageX&&Math.abs(n.touchStageX-e.stageX)<10&&Math.abs(n.touchStageY-e.stageY)<10&&n.onClick&&n.onClick.call(n.thisObj,e),n.touchStageX=-1,n.touchStageY=-1,n.btn.gotoAndStop(0))}},t.swfList=[],t.btnList=[],t.firstAddBtn=!0,t}();egret.registerClass(StarlingSwfUtils,"StarlingSwfUtils");var StarlingSwfButtonData=function(){function t(){this.touchStageX=-1,this.touchStageY=-1}var e=(__define,t);e.prototype;return t}();egret.registerClass(StarlingSwfButtonData,"StarlingSwfButtonData");var AllAsyncExecutor=function(){function t(){this._functions=new Array,this._complateNum=0}var e=(__define,t),i=e.prototype;return i.setCallBack=function(t,e){this._callBack=t,this._callBackTarget=e},i.regist=function(t,e){this._functions.push([t,e])},i.start=function(){App.ArrayUtils.forEach(this._functions,function(t){t[0].call(t[1])},this)},i.complate=function(){this._functions&&(this._complateNum++,this._complateNum==this._functions.length&&(this._callBack&&this._callBack.call(this._callBackTarget),this._callBack=null,this._callBackTarget=null,this._functions=null))},t}();egret.registerClass(AllAsyncExecutor,"AllAsyncExecutor");
var AnchorUtil=function(){function t(){}var e=(__define,t);e.prototype;return t.init=function(){t._propertyChange=Object.create(null),t._anchorChange=Object.create(null),t.injectAnchor()},t.setAnchorX=function(t,e){t.anchorX=e},t.setAnchorY=function(t,e){t.anchorY=e},t.setAnchor=function(t,e){t.anchorX=t.anchorY=e},t.getAnchor=function(t){return t.anchorX!=t.anchorY&&console.log("target's anchorX != anchorY"),t.anchorX||0},t.getAnchorY=function(t){return t.anchorY||0},t.getAnchorX=function(t){return t.anchorX||0},t.injectAnchor=function(){Object.defineProperty(egret.DisplayObject.prototype,"width",{get:function(){return this.$getWidth()},set:function(e){var i=this;this.$setWidth(e),t._propertyChange[this.hashCode]=!0,egret.callLater(function(){t.changeAnchor(i)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"height",{get:function(){return this.$getHeight()},set:function(e){var i=this;this.$setHeight(e),t._propertyChange[this.hashCode]=!0,egret.callLater(function(){t.changeAnchor(i)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"anchorX",{get:function(){return this._anchorX},set:function(e){var i=this;this._anchorX=e,t._propertyChange[this.hashCode]=!0,t._anchorChange[this.hashCode]=!0,egret.callLater(function(){t.changeAnchor(i)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"anchorY",{get:function(){return this._anchorY},set:function(e){var i=this;this._anchorY=e,t._propertyChange[this.hashCode]=!0,t._anchorChange[this.hashCode]=!0,egret.callLater(function(){t.changeAnchor(i)},this)},enumerable:!0,configurable:!0})},t.changeAnchor=function(e){t._propertyChange[e.hashCode]&&t._anchorChange[e.hashCode]&&(e.anchorOffsetX=e._anchorX*e.width,e.anchorOffsetY=e._anchorY*e.height,delete t._propertyChange[e.hashCode])},t}();egret.registerClass(AnchorUtil,"AnchorUtil");var ArrayUtils=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.forEach=function(t,e,i){for(var s=0,n=t.length;n>s;s++)e.apply(i,[t[s]])},e}(BaseClass);egret.registerClass(ArrayUtils,"ArrayUtils");var AverageUtils=function(){function t(t){void 0===t&&(t=10),this.nums=[],this.numsLen=0,this.numSum=0,this.maxNum=t}var e=(__define,t),i=e.prototype;return i.push=function(t){this.numsLen>this.maxNum&&(this.numsLen--,this.numSum-=this.nums.shift()),this.nums.push(t),this.numSum+=t,this.numsLen++},i.getValue=function(){return this.numSum/this.numsLen},i.clear=function(){this.nums.splice(0),this.numsLen=0,this.numSum=0},t}();egret.registerClass(AverageUtils,"AverageUtils");var CommonUtils=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e);i.prototype;return e.addLableStrokeColor=function(t,e,i){t.strokeColor=e,t.stroke=i},e.copyDataHandler=function(t){var e;if(t instanceof Array)e=[];else{if(!(t instanceof Object))return t;e={}}for(var i=Object.keys(t),s=0,n=i.length;n>s;s++){var r=i[s];e[r]=this.copyDataHandler(t[r])}return e},e.lock=function(){App.StageUtils.getStage().touchEnabled=App.StageUtils.getStage().touchChildren=!1},e.unlock=function(){App.StageUtils.getStage().touchEnabled=App.StageUtils.getStage().touchChildren=!0},e.int64ToNumber=function(t){return parseInt(t.toString())},e.labelIsOverLenght=function(t,e){var i=null;i=1e5>e?e:1e6>e?Math.floor(e/1e3/10).toString()+"万":Math.floor(e/1e4).toString()+"万",t.text=i},e}(BaseClass);egret.registerClass(CommonUtils,"CommonUtils");var DateUtils=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.getFormatBySecond=function(t,e){void 0===e&&(e=1);var i="";switch(e){case 1:i=this.getFormatBySecond1(t);break;case 2:i=this.getFormatBySecond2(t);break;case 3:i=this.getFormatBySecond3(t);break;case 4:i=this.getFormatBySecond4(t);break;case 5:i=this.getFormatBySecond5(t)}return i},s.getFormatBySecond1=function(t){void 0===t&&(t=0);var e,i=Math.floor(t/3600);e=0==i?"00":10>i?"0"+i:""+i;var s,n,r=Math.floor((t-3600*i)/60),a=Math.floor((t-3600*i)%60);return s=0==r?"00":10>r?"0"+r:""+r,n=0==a?"00":10>a?"0"+a:""+a,e+":"+s+":"+n},s.getFormatBySecond3=function(t){void 0===t&&(t=0);var e,i,s=Math.floor(t/3600),n=Math.floor((t-3600*s)/60),r=Math.floor((t-3600*s)%60);return e=0==n?"00":10>n?"0"+n:""+n,i=0==r?"00":10>r?"0"+r:""+r,e+":"+i},s.getFormatBySecond2=function(t){var e=new Date(t),i=e.getFullYear(),s=e.getMonth()+1,n=e.getDate(),r=e.getHours(),a=e.getMinutes(),o=e.getSeconds();return i+"-"+s+"-"+n+" "+r+":"+a+":"+o},s.getFormatBySecond4=function(t){var e=Math.floor(t/3600);return e>0?e>24?Math.floor(e/24)+"天前":e+"小时前":Math.floor(t/60)+"分钟前"},s.getFormatBySecond5=function(t){var e=86400,i=3600,s=60,n=Math.floor(t/e),r=Math.floor(t%e/i),a=Math.floor((t-r*i)/s),o=Math.floor((t-r*i)%s),h="",l="",c="",u="";return t>0?0==n?(h="",0==r?(l="",0==a?(c="",u=0==o?"":10>o?"0"+o+"秒":""+o+"秒"):(c=""+a+"分",u=0==o?"":10>o?"0"+o+"秒":""+o+"秒",c+u)):(l=r+"小时",0==a?(c="",u=0==o?"":10>o?"0"+o+"秒":""+o+"秒"):(c=10>a?"0"+a+"分":""+a+"分",l+c))):(h=n+"天",l=0==r?"":10>r?"0"+r+"小时":""+r+"小时",h+l):""},e}(BaseClass);egret.registerClass(DateUtils,"DateUtils");var DebugUtils=function(t){function e(){t.call(this),this._threshold=3,this._startTimes={}}__extends(e,t);var i=__define,s=e,n=s.prototype;return n.isOpen=function(t){this._isOpen=t},i(n,"isDebug",function(){return this._isOpen}),n.start=function(t){this._isOpen&&(this._startTimes[t]=egret.getTimer())},n.stop=function(t){if(!this._isOpen)return 0;if(!this._startTimes[t])return 0;var e=egret.getTimer()-this._startTimes[t];return e>this._threshold&&Log.trace(t+": "+e),e},n.setThreshold=function(t){this._threshold=t},e}(BaseClass);egret.registerClass(DebugUtils,"DebugUtils");var DelayOptManager=function(t){function e(){t.call(this),this.TIME_THRESHOLD=2,this._delayOpts=[],App.TimerManager.doFrame(1,0,this.runCachedFun,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addDelayOptFunction=function(t,e,i,s,n){this._delayOpts.push({fun:e,funPara:i,thisObj:t,callBack:s,para:n})},s.clear=function(){this._delayOpts.length=0},s.stop=function(){App.TimerManager.remove(this.runCachedFun,this)},s.runCachedFun=function(t){if(0!=this._delayOpts.length)for(var e,i=egret.getTimer();this._delayOpts.length&&(e=this._delayOpts.shift(),e.funPara?e.fun.call(e.thisObj,e.funPara):e.fun.call(e.thisObj),e.callBack&&(void 0!=e.para?e.callBack.call(e.thisObj,e.para):e.callBack()),!(egret.getTimer()-i>this.TIME_THRESHOLD)););},e}(BaseClass);egret.registerClass(DelayOptManager,"DelayOptManager");var DeviceUtils=function(t){function e(){t.call(this)}__extends(e,t);var i=__define,s=e,n=s.prototype;return i(n,"IsHtml5",function(){return egret.Capabilities.runtimeType==egret.RuntimeType.WEB}),i(n,"IsNative",function(){return egret.Capabilities.runtimeType==egret.RuntimeType.NATIVE}),i(n,"IsMobile",function(){return egret.Capabilities.isMobile}),i(n,"IsPC",function(){return!egret.Capabilities.isMobile}),i(n,"IsQQBrowser",function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("MQQBrowser")}),i(n,"IsIEBrowser",function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("MSIE")}),i(n,"IsFirefoxBrowser",function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Firefox")}),i(n,"IsChromeBrowser",function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Chrome")}),i(n,"IsSafariBrowser",function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Safari")}),i(n,"IsOperaBrowser",function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Opera")}),e}(BaseClass);egret.registerClass(DeviceUtils,"DeviceUtils");var DisplayUtils=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createBitmap=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},s.createEuiImage=function(t){var e=new eui.Image,i=RES.getRes(t);return e.source=i,e},s.removeFromParent=function(t){null!=t.parent&&t.parent.removeChild(t)},e}(BaseClass);egret.registerClass(DisplayUtils,"DisplayUtils");var EffectUtils=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.macIconShake=function(t,e){for(var i=[[20,300],[15,300],[10,300],[5,300]],s="egret.Tween.get("+t+")",n=0,r=i.length;r>n;n++)s+=".to({'y':"+e+"-"+i[n][0]+"}, "+i[n][1]+")",s+=".to({'y':"+e+"}, "+i[n][1]+")";return s+=";"},s.startFlicker=function(t,e){t.alpha=1,egret.Tween.get(t).to({alpha:0},e).to({alpha:1},e).call(this.startFlicker,this,[t])},s.stopFlicker=function(t){egret.Tween.removeTweens(t)},e}(BaseClass);egret.registerClass(EffectUtils,"EffectUtils");var EgretExpandUtils=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){AnchorUtil.init()},e}(BaseClass);egret.registerClass(EgretExpandUtils,"EgretExpandUtils");var FrameDelay=function(){function t(){}var e=(__define,t),i=e.prototype;return i.delayCall=function(t,e,i){this.func=e,this.thisObj=i,App.TimerManager.doFrame(t,1,this.listener_enterFrame,this)},i.listener_enterFrame=function(){this.func.call(this.thisObj)},t}();egret.registerClass(FrameDelay,"FrameDelay");var FrameExecutor=function(){function t(t){this.delayFrame=t,this.frameDelay=new FrameDelay,this.functions=new Array}var e=(__define,t),i=e.prototype;return i.regist=function(t,e){this.functions.push([t,e])},i.execute=function(){if(this.functions.length){var t=this.functions.shift();t[0].call(t[1]),this.frameDelay.delayCall(this.delayFrame,this.execute,this)}},t}();egret.registerClass(FrameExecutor,"FrameExecutor");var KeyboardUtils=function(t){function e(){if(t.call(this),this.key_ups=new Array,this.key_downs=new Array,App.DeviceUtils.IsHtml5){var e=this;document.addEventListener("keyup",function(t){for(var i=0,s=e.key_ups.length;s>i;i++){var n=e.key_ups[i][0],r=e.key_ups[i][1];r?n.call(r,t.keyCode):n(t.keyCode)}}),document.addEventListener("keydown",function(t){for(var i=0,s=e.key_downs.length;s>i;i++){var n=e.key_downs[i][0],r=e.key_downs[i][1];r?n.call(r,t.keyCode):n(t.keyCode)}})}}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addKeyUp=function(t,e){this.key_ups.push([t,e])},s.addKeyDown=function(t,e){this.key_downs.push([t,e])},s.removeKeyUp=function(t,e){for(var i=0;i<this.key_ups.length;i++)this.key_ups[i][0]==t&&this.key_ups[i][1]==e&&(this.key_ups.splice(i,1),i--)},s.removeKeyDown=function(t,e){for(var i=0;i<this.key_downs.length;i++)this.key_downs[i][0]==t&&this.key_downs[i][1]==e&&(this.key_downs.splice(i,1),i--)},e}(BaseClass);egret.registerClass(KeyboardUtils,"KeyboardUtils");var LocationProperty=function(){function t(){}var e=(__define,t);e.prototype;return t.getPara=function(t,e){if(egret.MainContext.runtimeType==egret.MainContext.RUNTIME_NATIVE)return null;var i=e||location.href;if(-1!=i.indexOf("?")){var s="&"+i.split("?")[1],n=new RegExp("&"+t+"=.*?(?:&|$)"),r=n.exec(s);if(r){var a=r[0];return a.split("&")[1].split("=")[1]}}return null},t.setProperty=function(t,e,i){var s=i||location.href,n="&"+s.split("?")[1];if(-1==s.indexOf("?"))return s+="?"+t+"="+e;var n=s.split("?")[1];if(""==n)return s+=t+"="+e;var r=new RegExp("(?:^|&)"+t+"=.*?(?:&|$)"),a=r.exec(n);if(a&&""!=a[0]){var o=a[0],h=new RegExp("=.*$"),l=o.replace(h,"="+e);return s.replace(o,l)}return s+="&"+t+"="+e},t.hasProperty=function(t,e){var i=e||location.href,s="&"+i.split("?")[1];return-1!=s.indexOf("&"+t+"=")},t}();egret.registerClass(LocationProperty,"LocationProperty");var Log=function(){function t(){}var e=(__define,t);e.prototype;return t.trace=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];App.DebugUtils.isDebug&&(t[0]="[DebugLog]"+t[0],console.log.apply(console,t))},t}();egret.registerClass(Log,"Log");var MathUtils=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.getAngle=function(t){return 180*t/Math.PI},s.getRadian=function(t){return Math.PI=t/180*Math.PI},s.getRadian2=function(t,e,i,s){var n=i-t,r=s-e;return Math.atan2(r,n)},s.getDistance=function(t,e,i,s){var n=i-t,r=s-e,a=n*n+r*r;return Math.sqrt(a)},e}(BaseClass);egret.registerClass(MathUtils,"MathUtils");var MessageCenter=function(t){function e(e){t.call(this),this.type=e,this.dict={},this.eVec=new Array,this.lastRunTime=0,0==this.type&&App.TimerManager.doFrame(1,0,this.run,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.clear=function(){this.dict={},this.eVec.splice(0)},s.addListener=function(t,e,i){var s=this.dict[t];null==s&&(s=new Array,this.dict[t]=s);var n=0,r=s.length;for(n;r>n;n++)if(s[n][0]==e&&s[n][1]==i)return;s.push([e,i])},s.removeListener=function(t,e,i){var s=this.dict[t];if(null!=s){var n=0,r=s.length;for(n;r>n;n++)if(s[n][0]==e&&s[n][1]==i){s.splice(n,1);break}0==s.length&&(this.dict[t]=null,delete this.dict[t])}},s.removeAll=function(t){for(var e=Object.keys(this.dict),i=0,s=e.length;s>i;i++){for(var n=e[i],r=this.dict[n],a=0;a<r.length;a++)r[a][1]==t&&(r.splice(a,1),a--);0==r.length&&(this.dict[n]=null,delete this.dict[n])}},s.dispatch=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(null!=this.dict[t]){var s=ObjectPool.pop("MessageVo");s.type=t,s.param=e,0==this.type?this.eVec.push(s):1==this.type?this.dealMsg(s):Log.trace("MessageCenter未实现的类型")}},s.run=function(){var t=egret.getTimer(),e=t-this.lastRunTime>100;if(this.lastRunTime=t,e)for(;this.eVec.length>0;)this.dealMsg(this.eVec.shift());else for(;this.eVec.length>0&&(this.dealMsg(this.eVec.shift()),!(egret.getTimer()-t>5)););},s.dealMsg=function(t){for(var e=this.dict[t.type],i=0,s=e.length,n=null;s>i;)n=e[i],n[0].apply(n[1],t.param),e.length!=s&&(s=e.length,i--),i++;t.dispose(),ObjectPool.push(t)},e}(BaseClass);egret.registerClass(MessageCenter,"MessageCenter");var MessageVo=function(){function t(){}var e=(__define,t),i=e.prototype;return i.dispose=function(){this.type=null,this.param=null},t}();egret.registerClass(MessageVo,"MessageVo");var ObjectPool=function(){function t(){this._objs=new Array}var e=(__define,t),i=e.prototype;return i.pushObj=function(t){this._objs.push(t)},i.popObj=function(){return this._objs.length>0?this._objs.pop():null},i.clear=function(){for(;this._objs.length>0;)this._objs.pop()},t.pop=function(e){for(var i=[],s=1;s<arguments.length;s++)i[s-1]=arguments[s];t._content[e]||(t._content[e]=[]);var n=t._content[e];if(n.length)return n.pop();var r,a=egret.getDefinitionByName(e),o=i.length;return 0==o?r=new a:1==o?r=new a(i[0]):2==o?r=new a(i[0],i[1]):3==o?r=new a(i[0],i[1],i[2]):4==o?r=new a(i[0],i[1],i[2],i[3]):5==o&&(r=new a(i[0],i[1],i[2],i[3],i[4])),r.ObjectPoolKey=e,r},t.popWithExtraKey=function(e,i){t._content[e]||(t._content[e]=[]);var s,n=t._content[e];if(n.length)for(var r=0;r<n.length;r++)if(n[r].extraKey==i){s=n[r],n.splice(r,1);break}if(!s){var a=egret.getDefinitionByName(e);s=new a(i),s.extraKey=i,s.ObjectPoolKey=e}return s},t.push=function(e){if(null==e)return!1;var i=e.ObjectPoolKey;return t._content[i]?(t._content[i].push(e),!0):!1},t.clear=function(){t._content={}},t.clearClass=function(e,i){void 0===i&&(i=null);for(var s=t._content[e];s&&s.length;){var n=s.pop();i&&n[i](),n=null}t._content[e]=null,delete t._content[e]},t.dealFunc=function(e,i){var s=t._content[e];if(null!=s){var n=0,r=s.length;for(n;r>n;n++)s[n][i]()}},t._content={},t}();egret.registerClass(ObjectPool,"ObjectPool");var Percent=function(){function t(t,e){this.currentValue=t,this.totalValue=e}var e=(__define,t),i=e.prototype;return i.computePercent=function(){return this.currentValue/this.totalValue*100},i.computeRate=function(){return this.currentValue/this.totalValue},i.reverse=function(){return this.currentValue=this.totalValue-this.currentValue,this},i.copy=function(){return new t(this.currentValue,this.totalValue)},i.computePercentReverse=function(){return(this.totalValue-this.currentValue)/this.totalValue*100},i.computeRateReverse=function(){return(this.totalValue-this.currentValue)/this.totalValue},t}();egret.registerClass(Percent,"Percent");var QueueExecutor=function(){function t(){this._functions=new Array}var e=(__define,t),i=e.prototype;return i.setCallBack=function(t,e){this._callBack=t,this._callBackTarget=e},i.regist=function(t,e){this._functions.push([t,e])},i.start=function(){this.next()},i.next=function(){if(this._functions)if(0==this._functions.length)this._callBack&&this._callBack.call(this._callBackTarget),this._callBack=null,this._callBackTarget=null,this._functions=null;else{var t=this._functions.shift();t[0].call(t[1])}},t}();egret.registerClass(QueueExecutor,"QueueExecutor");var RandomUtils=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.limit=function(t,e){t=Math.min(t,e),e=Math.max(t,e);var i=e-t;return t+Math.random()*i},s.limitInteger=function(t,e){return Math.round(this.limit(t,e))},s.randomArray=function(t){var e=Math.floor(Math.random()*t.length);return t[e]},e}(BaseClass);egret.registerClass(RandomUtils,"RandomUtils");var RenderTextureManager=function(t){function e(){t.call(this),this._pool=[],this._useNum=0,this.isLowerQQBrowser()?this._maxNum=18:this._maxNum=-1}__extends(e,t);var i=(__define,e),s=i.prototype;return s.isLowerQQBrowser=function(){if(App.DeviceUtils.IsQQBrowser){for(var t=["2013022","Lenovo A630t","SM-G3818","vivo X3t","GT-I9100"],e=!1,i=0,s=t.length;s>i;i++)if(-1!=navigator.userAgent.indexOf(t[i])){e=!0;break}return e}return!1},s.pop=function(){var t=this._pool.pop();return t||(-1==this._maxNum||this._useNum<this._maxNum)&&(t=new egret.RenderTexture,this._useNum++),t},s.push=function(t){for(var e=!1,i=0,s=this._pool.length;s>i;i++)if(this._pool[i]==t){e=!0;break}e||this._pool.push(t)},e}(BaseClass);egret.registerClass(RenderTextureManager,"RenderTextureManager");var ResVersionManager=function(t){function e(){t.call(this),this.res_loadByVersion()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.res_loadByVersion=function(){RES.web.Html5VersionController.prototype.getVirtualUrl=function(t){var i="",s=e.resVersionData,n=t.substring(9);return s&&s[n]&&(i=s[n]),0==i.length&&(i=Math.random()+""),t+=-1==t.indexOf("?")?"?v="+i:"&v="+i}},s.loadConfig=function(t,e,i){this.complateFunc=e,this.complateFuncTarget=i,RES.getResByUrl(t,this.loadResVersionComplate,this)},s.loadResVersionComplate=function(t){e.resVersionData=t,this.complateFunc.call(this.complateFuncTarget)},e}(BaseClass);egret.registerClass(ResVersionManager,"ResVersionManager");var ResourceUtils=function(t){function e(){t.call(this),this._groupIndex=0,this._configs=new Array,this._groups={},RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceLoadProgress,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addConfig=function(t,e){this._configs.push([t,e])},s.loadConfig=function(t,e){this._onConfigComplete=t,this._onConfigCompleteTarget=e,this.loadNextConfig()},s.loadNextConfig=function(){if(0==this._configs.length)return this._onConfigComplete.call(this._onConfigCompleteTarget),this._onConfigComplete=null,void(this._onConfigCompleteTarget=null);var t=this._configs.shift();RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigCompleteHandle,this),RES.loadConfig(t[0],t[1])},s.onConfigCompleteHandle=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigCompleteHandle,this),this.loadNextConfig()},s.loadGroup=function(t,e,i,s){this._groups[t]=[e,i,s],RES.loadGroup(t)},s.loadGroups=function(t,e,i,s,n){RES.createGroup(t,e,!0),this.loadGroup(t,i,s,n)},s.pilfererLoadGroup=function(t,e){void 0===e&&(e=null);var i="pilferer_"+t;e||(e=[t]),RES.createGroup(i,e,!0),RES.loadGroup(i,-1)},s.onResourceLoadComplete=function(t){var e=t.groupName;if(this._groups[e]){var i=this._groups[e][0],s=this._groups[e][2];null!=i&&i.call(s),this._groups[e]=null,delete this._groups[e]}},s.onResourceLoadProgress=function(t){var e=t.groupName;if(this._groups[e]){var i=this._groups[e][1],s=this._groups[e][2];null!=i&&i.call(s,t.itemsLoaded,t.itemsTotal)}},s.onResourceLoadError=function(t){Log.trace(t.groupName+"资源组有资源加载失败"),this.onResourceLoadComplete(t)},s.loadResource=function(t,e,i,s,n){void 0===t&&(t=[]),void 0===e&&(e=[]),void 0===i&&(i=null),void 0===s&&(s=null),void 0===n&&(n=null);var r=t.concat(e),a="loadGroup"+this._groupIndex++;RES.createGroup(a,r,!0),this._groups[a]=[i,s,n],RES.loadGroup(a)},e}(BaseClass);egret.registerClass(ResourceUtils,"ResourceUtils");var RockerUtils=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(t,e,i,s){this.keys=[0,0],this.mouseX=-1,this.mouseY=-1,this.moveFlag=e,this.moveFlagX=e.x,this.moveFlagY=e.y,this.moveFlagGoX=this.moveFlagX,this.moveFlagGoY=this.moveFlagY,this.moveFlagWidthHelf=.5*t.width,this.moveFlagRec=new egret.Rectangle(this.moveFlagX-.5*t.width,this.moveFlagY-.5*t.height,t.width,t.height),this.moveFlagCheckRec=new egret.Rectangle(0,0,.5*App.StageUtils.getWidth(),App.StageUtils.getHeight()),this.dealKeyFunc=i,this.dealKeyTarget=s,this.moveFlag.touchEnabled=!0,this.moveFlag.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.startMove,this),this.moveFlag.addEventListener(egret.TouchEvent.TOUCH_END,this.stopMove,this),this.moveFlag.addEventListener(egret.TouchEvent.TOUCH_TAP,this.stopEvent,this),App.StageUtils.getStage().addEventListener(egret.TouchEvent.TOUCH_END,this.leaveStateEvent,this),App.StageUtils.getStage().addEventListener(egret.TouchEvent.TOUCH_MOVE,this.heroMoveEvent,this),App.KeyboardUtils.addKeyDown(this.onKeyDown,this),App.KeyboardUtils.addKeyUp(this.onKeyUp,this)},s.onKeyDown=function(t){switch(t){case Keyboard.A:this.keys[0]=-1,this.startCheckKey();break;case Keyboard.D:this.keys[0]=1,this.startCheckKey();break;case Keyboard.W:this.keys[1]=-1,this.startCheckKey();break;case Keyboard.S:this.keys[1]=1,this.startCheckKey()}},s.onKeyUp=function(t){switch(t){case Keyboard.A:-1==this.keys[0]&&(this.keys[0]=0);break;case Keyboard.D:1==this.keys[0]&&(this.keys[0]=0);break;case Keyboard.W:-1==this.keys[1]&&(this.keys[1]=0);break;case Keyboard.S:1==this.keys[1]&&(this.keys[1]=0)}},s.stopEvent=function(t){t.stopPropagation()},s.leaveStateEvent=function(t){t.stageX==this.mouseX&&t.stageY==this.mouseY&&this.stopMove()},s.startMove=function(t){this.isMoveing=!0,this.moveFlagGoX=this.moveFlagX,this.moveFlagGoY=this.moveFlagY,this.mouseX=t.stageX,this.mouseY=t.stageY},s.stopMove=function(){this.isMoveing=!1,this.keys[0]=0,this.keys[1]=0,this.moveFlagGoX=this.moveFlagX,this.moveFlagGoY=this.moveFlagY,this.mouseX=-1,this.mouseY=-1},s.resetRockerPos=function(){this.moveFlag.x=this.moveFlagX,this.moveFlag.y=this.moveFlagY},s.heroMoveEvent=function(t){this.runMove(t.stageX,t.stageY)},s.runMove=function(t,e){if(this.isMoveing&&(this.moveFlagCheckRec.contains(t,e)||!(Math.abs(this.mouseX-t)>50||Math.abs(this.mouseY-e)>50))){if(this.mouseX=t,this.mouseY=e,this.moveFlagRec.contains(this.mouseX,this.mouseY))this.moveFlagGoX=this.mouseX,this.moveFlagGoY=this.mouseY;else{var i=App.MathUtils.getRadian2(this.moveFlagX,this.moveFlagY,this.mouseX,this.mouseY);this.moveFlagGoX=this.moveFlagX+Math.cos(i)*this.moveFlagWidthHelf,this.moveFlagGoY=this.moveFlagY+Math.sin(i)*this.moveFlagWidthHelf}this.moveFlagGoX>this.moveFlagX&&Math.abs(this.moveFlagGoX-this.moveFlagX)>10?this.keys[0]=1:this.moveFlagGoX<this.moveFlagX&&Math.abs(this.moveFlagGoX-this.moveFlagX)>10?this.keys[0]=-1:this.keys[0]=0,this.moveFlagGoY>this.moveFlagY&&Math.abs(this.moveFlagGoY-this.moveFlagY)>10?this.keys[1]=1:this.moveFlagGoY<this.moveFlagY&&Math.abs(this.moveFlagGoY-this.moveFlagY)>10?this.keys[1]=-1:this.keys[1]=0,this.startCheckKey()}},s.startCheckKey=function(){this.checkKeying||(this.checkKeying=!0,App.TimerManager.doFrame(1,0,this.delKeys,this))},s.stopCheckKey=function(){this.keys[0]=0,this.keys[1]=0,this.checkKeying&&(App.TimerManager.remove(this.delKeys,this),this.checkKeying=!1)},s.delKeys=function(){-1==this.mouseX||this.moveFlagCheckRec.contains(this.mouseX,this.mouseY)||this.stopMove(),this.moveFlag.x!=this.moveFlagGoX&&(this.moveFlag.x=this.moveFlagGoX),this.moveFlag.y!=this.moveFlagGoY&&(this.moveFlag.y=this.moveFlagGoY),this.keys[0]||this.keys[1]||this.stopCheckKey(),this.dealKeyFunc.call(this.dealKeyTarget,this.keys[0],this.keys[1])||this.resetRockerPos()},s.stop=function(){this.stopCheckKey(),this.stopMove()},e}(BaseClass);egret.registerClass(RockerUtils,"RockerUtils");var ShockUtils=function(t){function e(){t.call(this),this.MAP=0,this.SPRITE=1,this.mapPoss=[new egret.Point(0,3),new egret.Point(0,0),new egret.Point(0,-2)],this.spritePoss=[new egret.Point(5,0),new egret.Point(-5,0),new egret.Point(5,0)],this._shockLength=0,this._shockCount=0,this._rx=0,this._ry=0,this._type=0,this._repeatCount=0}__extends(e,t);var i=__define,s=e,n=s.prototype;return n.destroy=function(){this.stop()},n.shock=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=null),void 0===i&&(i=3),this._target||(this._type=t,this._target=e,this._type==this.MAP?(this._shockPoss=this.mapPoss.concat(),this._shockLength=this._shockPoss.length):this._type==this.SPRITE&&(this._shockPoss=this.spritePoss.concat(),this._shockLength=this._shockPoss.length),this.start(i))},n.start=function(t){void 0===t&&(t=1),this.repeatCount=t,this._shockCount=0,this._target&&(this._type!=this.MAP&&(this._rx=this._target.x),this._ry=this._target.y,App.TimerManager.doFrame(1,0,this.onShockEnter,this))},n.stop=function(){this._target&&(this._type!=this.MAP&&(this._target.x=this._rx),this._target.y=this._ry,App.TimerManager.remove(this.onShockEnter,this)),this._target=null},n.onShockEnter=function(t){var e=this._shockLength*this._repeatCount;if(this._shockCount>=e)return void this.stop();var i=this._shockCount%this._shockLength,s=this._shockPoss[i];this._target&&(this._type!=this.MAP&&(this._target.x=this._rx+s.x),this._target.y=this._ry+s.y),this._shockCount++},i(n,"repeatCount",function(){return this._repeatCount},function(t){this._repeatCount=t}),e}(BaseClass);egret.registerClass(ShockUtils,"ShockUtils");var SortUtils=function(){function t(){}var e=(__define,t);e.prototype;return t.sortNum=function(t,e){return t-e},t.random=function(t,e){return Math.random()-.5},t}();egret.registerClass(SortUtils,"SortUtils");var StageUtils=function(t){function e(){t.call(this),null==e._uiStage&&(e._uiStage=new eui.UILayer,e._uiStage.percentHeight=100,e._uiStage.percentWidth=100,e._uiStage.touchEnabled=!1,this.getStage().addChild(e._uiStage))}__extends(e,t);var i=(__define,e),s=i.prototype;return s.getHeight=function(){return this.getStage().stageHeight},s.getWidth=function(){return this.getStage().stageWidth},s.setTouchChildren=function(t){this.getStage().touchChildren=t},s.setMaxTouches=function(t){this.getStage().maxTouches=t},s.setFrameRate=function(t){this.getStage().frameRate=t},s.setScaleMode=function(t){this.getStage().scaleMode=t},s.getStage=function(){return egret.MainContext.instance.stage},s.getUIStage=function(){return e._uiStage},e}(BaseClass);egret.registerClass(StageUtils,"StageUtils");var StringBuffer=function(){function t(){this._strings=new Array}var e=(__define,t),i=e.prototype;return i.append=function(t){this._strings.push(t)},i.toString=function(){return this._strings.join("")},i.clear=function(){this._strings.length=0},t}();egret.registerClass(StringBuffer,"StringBuffer");var StringUtils=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.trimSpace=function(t){return t.replace(/^\s*(.*?)[\s\n]*$/g,"$1")},s.getStringLength=function(t){for(var e=t.split(""),i=0,s=0;s<e.length;s++){var n=e[s];i+=this.isChinese(n)?2:1}return i},s.isChinese=function(t){var e=/^.*[\u4E00-\u9FA5]+.*$/;return e.test(t)},e}(BaseClass);egret.registerClass(StringUtils,"StringUtils");var TextFlowMaker=function(t){function e(){t.call(this),this.STYLE_COLOR="C",this.STYLE_SIZE="S",this.PROP_TEXT="T"}__extends(e,t);var i=(__define,e),s=i.prototype;return s.generateTextFlow=function(t){for(var e=t.split("|"),i=[],s=0,n=e.length;n>s;s++)i.push(this.getSingleTextFlow(e[s]));return i},s.getSingleTextFlow=function(t){for(var e,i=t.split("&"),s={style:{}},n=0,r=i.length;r>n;n++)e=i[n].split(":"),e[0]==this.PROP_TEXT?s.text=e[1]:e[0]==this.STYLE_SIZE?s.style.size=parseInt(e[1]):e[0]==this.STYLE_COLOR?s.style.textColor=parseInt(e[1]):s.text=e[0];return s},e}(BaseClass);egret.registerClass(TextFlowMaker,"TextFlowMaker");var TimerManager=function(t){function e(){t.call(this),this._handlers=new Array,this._delHandlers=new Array,this._currTime=egret.getTimer(),this._currFrame=0,this._count=0,this._timeScale=1,egret.Ticker.getInstance().register(this.onEnterFrame,this)}__extends(e,t);var i=__define,s=e,n=s.prototype;return n.setTimeScale=function(t){this._timeScale=t},n.onEnterFrame=function(){this._currFrame++,this._currTime=egret.getTimer(),App.DebugUtils.start("TimerManager:");for(var t=0;t<this._count;t++){var e=this._handlers[t],i=e.userFrame?this._currFrame:this._currTime;i>=e.exeTime&&(App.DebugUtils.start(e.method.toString()),e.method.call(e.methodObj,(this._currTime-e.dealTime)*this._timeScale),App.DebugUtils.stop(e.method.toString()),e.dealTime=this._currTime,e.exeTime+=e.delay,e.repeat||(e.repeatCount>1?e.repeatCount--:(e.complateMethod&&e.complateMethod.apply(e.complateMethodObj),this._delHandlers.push(e))))}for(;this._delHandlers.length;){var e=this._delHandlers.pop();this.remove(e.method,e.methodObj)}App.DebugUtils.stop("TimerManager:")},n.create=function(t,e,i,s,n,r,a){if(!(0>e||0>i||null==s)){this.remove(s,n);var o=ObjectPool.pop("TimerHandler");o.userFrame=t,o.repeat=0==i,o.repeatCount=i,o.delay=e,o.method=s,o.methodObj=n,o.complateMethod=r,o.complateMethodObj=a,o.exeTime=e+(t?this._currFrame:this._currTime),o.dealTime=this._currTime,this._handlers.push(o),this._count++}},n.doTimer=function(t,e,i,s,n,r){void 0===n&&(n=null),void 0===r&&(r=null),this.create(!1,t,e,i,s,n,r)},n.doFrame=function(t,e,i,s,n,r){void 0===n&&(n=null),void 0===r&&(r=null),this.create(!0,t,e,i,s,n,r)},i(n,"count",function(){return this._count}),n.remove=function(t,e){for(var i=0;i<this._count;i++){var s=this._handlers[i];if(s.method==t&&s.methodObj==e){this._handlers.splice(i,1),ObjectPool.push(s),this._count--;break}}},n.removeAll=function(t){for(var e=0;e<this._count;e++){var i=this._handlers[e];i.methodObj==t&&(this._handlers.splice(e,1),ObjectPool.push(i),this._count--,e--)}},n.isExists=function(t,e){for(var i=0;i<this._count;i++){var s=this._handlers[i];if(s.method==t&&s.methodObj==e)return!0}return!1},e}(BaseClass);egret.registerClass(TimerManager,"TimerManager");var TimerHandler=function(){function t(){this.delay=0,this.repeatCount=0,this.exeTime=0,this.dealTime=0}var e=(__define,t),i=e.prototype;return i.clear=function(){this.method=null,this.methodObj=null,this.complateMethod=null,this.complateMethodObj=null},t}();egret.registerClass(TimerHandler,"TimerHandler");var md5=function(){function t(){this.hexcase=0,this.b64pad=""}var e=(__define,t),i=e.prototype;return i.hex_md5=function(t){return this.rstr2hex(this.rstr_md5(this.str2rstr_utf8(t)))},i.b64_md5=function(t){return this.rstr2b64(this.rstr_md5(this.str2rstr_utf8(t)))},i.any_md5=function(t,e){return this.rstr2any(this.rstr_md5(this.str2rstr_utf8(t)),e)},i.hex_hmac_md5=function(t,e){return this.rstr2hex(this.rstr_hmac_md5(this.str2rstr_utf8(t),this.str2rstr_utf8(e)))},i.b64_hmac_md5=function(t,e){return this.rstr2b64(this.rstr_hmac_md5(this.str2rstr_utf8(t),this.str2rstr_utf8(e)))},i.any_hmac_md5=function(t,e,i){return this.rstr2any(this.rstr_hmac_md5(this.str2rstr_utf8(t),this.str2rstr_utf8(e)),i)},i.md5_vm_test=function(){return"900150983cd24fb0d6963f7d28e17f72"==this.hex_md5("abc").toLowerCase()},i.rstr_md5=function(t){return this.binl2rstr(this.binl_md5(this.rstr2binl(t),8*t.length))},i.rstr_hmac_md5=function(t,e){var i=this.rstr2binl(t);i.length>16&&(i=this.binl_md5(i,8*t.length));for(var s=Array(16),n=Array(16),r=0;16>r;r++)s[r]=909522486^i[r],n[r]=1549556828^i[r];
var a=this.binl_md5(s.concat(this.rstr2binl(e)),512+8*e.length);return this.binl2rstr(this.binl_md5(n.concat(a),640))},i.rstr2hex=function(t){try{this.hexcase}catch(e){this.hexcase=0}for(var i,s=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",n="",r=0;r<t.length;r++)i=t.charCodeAt(r),n+=s.charAt(i>>>4&15)+s.charAt(15&i);return n},i.rstr2b64=function(t){try{this.b64pad}catch(e){this.b64pad=""}for(var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s="",n=t.length,r=0;n>r;r+=3)for(var a=t.charCodeAt(r)<<16|(n>r+1?t.charCodeAt(r+1)<<8:0)|(n>r+2?t.charCodeAt(r+2):0),o=0;4>o;o++)s+=8*r+6*o>8*t.length?this.b64pad:i.charAt(a>>>6*(3-o)&63);return s},i.rstr2any=function(t,e){var i,s,n,r,a,o=e.length,h=Array(Math.ceil(t.length/2));for(i=0;i<h.length;i++)h[i]=t.charCodeAt(2*i)<<8|t.charCodeAt(2*i+1);var l=Math.ceil(8*t.length/(Math.log(e.length)/Math.log(2))),c=Array(l);for(s=0;l>s;s++){for(a=Array(),r=0,i=0;i<h.length;i++)r=(r<<16)+h[i],n=Math.floor(r/o),r-=n*o,(a.length>0||n>0)&&(a[a.length]=n);c[s]=r,h=a}var u="";for(i=c.length-1;i>=0;i--)u+=e.charAt(c[i]);return u},i.str2rstr_utf8=function(t){for(var e,i,s="",n=-1;++n<t.length;)e=t.charCodeAt(n),i=n+1<t.length?t.charCodeAt(n+1):0,e>=55296&&56319>=e&&i>=56320&&57343>=i&&(e=65536+((1023&e)<<10)+(1023&i),n++),127>=e?s+=String.fromCharCode(e):2047>=e?s+=String.fromCharCode(192|e>>>6&31,128|63&e):65535>=e?s+=String.fromCharCode(224|e>>>12&15,128|e>>>6&63,128|63&e):2097151>=e&&(s+=String.fromCharCode(240|e>>>18&7,128|e>>>12&63,128|e>>>6&63,128|63&e));return s},i.str2rstr_utf16le=function(t){for(var e="",i=0;i<t.length;i++)e+=String.fromCharCode(255&t.charCodeAt(i),t.charCodeAt(i)>>>8&255);return e},i.str2rstr_utf16be=function(t){for(var e="",i=0;i<t.length;i++)e+=String.fromCharCode(t.charCodeAt(i)>>>8&255,255&t.charCodeAt(i));return e},i.rstr2binl=function(t){for(var e=Array(t.length>>2),i=0;i<e.length;i++)e[i]=0;for(var i=0;i<8*t.length;i+=8)e[i>>5]|=(255&t.charCodeAt(i/8))<<i%32;return e},i.binl2rstr=function(t){for(var e="",i=0;i<32*t.length;i+=8)e+=String.fromCharCode(t[i>>5]>>>i%32&255);return e},i.binl_md5=function(t,e){t[e>>5]|=128<<e%32,t[(e+64>>>9<<4)+14]=e;for(var i=1732584193,s=-271733879,n=-1732584194,r=271733878,a=0;a<t.length;a+=16){var o=i,h=s,l=n,c=r;i=this.md5_ff(i,s,n,r,t[a+0],7,-680876936),r=this.md5_ff(r,i,s,n,t[a+1],12,-389564586),n=this.md5_ff(n,r,i,s,t[a+2],17,606105819),s=this.md5_ff(s,n,r,i,t[a+3],22,-1044525330),i=this.md5_ff(i,s,n,r,t[a+4],7,-176418897),r=this.md5_ff(r,i,s,n,t[a+5],12,1200080426),n=this.md5_ff(n,r,i,s,t[a+6],17,-1473231341),s=this.md5_ff(s,n,r,i,t[a+7],22,-45705983),i=this.md5_ff(i,s,n,r,t[a+8],7,1770035416),r=this.md5_ff(r,i,s,n,t[a+9],12,-1958414417),n=this.md5_ff(n,r,i,s,t[a+10],17,-42063),s=this.md5_ff(s,n,r,i,t[a+11],22,-1990404162),i=this.md5_ff(i,s,n,r,t[a+12],7,1804603682),r=this.md5_ff(r,i,s,n,t[a+13],12,-40341101),n=this.md5_ff(n,r,i,s,t[a+14],17,-1502002290),s=this.md5_ff(s,n,r,i,t[a+15],22,1236535329),i=this.md5_gg(i,s,n,r,t[a+1],5,-165796510),r=this.md5_gg(r,i,s,n,t[a+6],9,-1069501632),n=this.md5_gg(n,r,i,s,t[a+11],14,643717713),s=this.md5_gg(s,n,r,i,t[a+0],20,-373897302),i=this.md5_gg(i,s,n,r,t[a+5],5,-701558691),r=this.md5_gg(r,i,s,n,t[a+10],9,38016083),n=this.md5_gg(n,r,i,s,t[a+15],14,-660478335),s=this.md5_gg(s,n,r,i,t[a+4],20,-405537848),i=this.md5_gg(i,s,n,r,t[a+9],5,568446438),r=this.md5_gg(r,i,s,n,t[a+14],9,-1019803690),n=this.md5_gg(n,r,i,s,t[a+3],14,-187363961),s=this.md5_gg(s,n,r,i,t[a+8],20,1163531501),i=this.md5_gg(i,s,n,r,t[a+13],5,-1444681467),r=this.md5_gg(r,i,s,n,t[a+2],9,-51403784),n=this.md5_gg(n,r,i,s,t[a+7],14,1735328473),s=this.md5_gg(s,n,r,i,t[a+12],20,-1926607734),i=this.md5_hh(i,s,n,r,t[a+5],4,-378558),r=this.md5_hh(r,i,s,n,t[a+8],11,-2022574463),n=this.md5_hh(n,r,i,s,t[a+11],16,1839030562),s=this.md5_hh(s,n,r,i,t[a+14],23,-35309556),i=this.md5_hh(i,s,n,r,t[a+1],4,-1530992060),r=this.md5_hh(r,i,s,n,t[a+4],11,1272893353),n=this.md5_hh(n,r,i,s,t[a+7],16,-155497632),s=this.md5_hh(s,n,r,i,t[a+10],23,-1094730640),i=this.md5_hh(i,s,n,r,t[a+13],4,681279174),r=this.md5_hh(r,i,s,n,t[a+0],11,-358537222),n=this.md5_hh(n,r,i,s,t[a+3],16,-722521979),s=this.md5_hh(s,n,r,i,t[a+6],23,76029189),i=this.md5_hh(i,s,n,r,t[a+9],4,-640364487),r=this.md5_hh(r,i,s,n,t[a+12],11,-421815835),n=this.md5_hh(n,r,i,s,t[a+15],16,530742520),s=this.md5_hh(s,n,r,i,t[a+2],23,-995338651),i=this.md5_ii(i,s,n,r,t[a+0],6,-198630844),r=this.md5_ii(r,i,s,n,t[a+7],10,1126891415),n=this.md5_ii(n,r,i,s,t[a+14],15,-1416354905),s=this.md5_ii(s,n,r,i,t[a+5],21,-57434055),i=this.md5_ii(i,s,n,r,t[a+12],6,1700485571),r=this.md5_ii(r,i,s,n,t[a+3],10,-1894986606),n=this.md5_ii(n,r,i,s,t[a+10],15,-1051523),s=this.md5_ii(s,n,r,i,t[a+1],21,-2054922799),i=this.md5_ii(i,s,n,r,t[a+8],6,1873313359),r=this.md5_ii(r,i,s,n,t[a+15],10,-30611744),n=this.md5_ii(n,r,i,s,t[a+6],15,-1560198380),s=this.md5_ii(s,n,r,i,t[a+13],21,1309151649),i=this.md5_ii(i,s,n,r,t[a+4],6,-145523070),r=this.md5_ii(r,i,s,n,t[a+11],10,-1120210379),n=this.md5_ii(n,r,i,s,t[a+2],15,718787259),s=this.md5_ii(s,n,r,i,t[a+9],21,-343485551),i=this.safe_add(i,o),s=this.safe_add(s,h),n=this.safe_add(n,l),r=this.safe_add(r,c)}return[i,s,n,r]},i.md5_cmn=function(t,e,i,s,n,r){return this.safe_add(this.bit_rol(this.safe_add(this.safe_add(e,t),this.safe_add(s,r)),n),i)},i.md5_ff=function(t,e,i,s,n,r,a){return this.md5_cmn(e&i|~e&s,t,e,n,r,a)},i.md5_gg=function(t,e,i,s,n,r,a){return this.md5_cmn(e&s|i&~s,t,e,n,r,a)},i.md5_hh=function(t,e,i,s,n,r,a){return this.md5_cmn(e^i^s,t,e,n,r,a)},i.md5_ii=function(t,e,i,s,n,r,a){return this.md5_cmn(i^(e|~s),t,e,n,r,a)},i.safe_add=function(t,e){var i=(65535&t)+(65535&e),s=(t>>16)+(e>>16)+(i>>16);return s<<16|65535&i},i.bit_rol=function(t,e){return t<<e|t>>>32-e},t}();egret.registerClass(md5,"md5");var ControllerConst;!function(t){t[t.Loading=1]="Loading",t[t.Game=2]="Game"}(ControllerConst||(ControllerConst={}));var SceneConst;!function(t){t[t.Loading=1]="Loading",t[t.Game=2]="Game"}(SceneConst||(SceneConst={}));var ViewConst;!function(t){t[t.Loading=1]="Loading",t[t.Game=2]="Game",t[t.GameUI=3]="GameUI"}(ViewConst||(ViewConst={}));var GameConst;!function(t){t[t.Jump=1]="Jump",t[t.Shoot=2]="Shoot",t[t.Dodge=3]="Dodge",t[t.CeateBullet=4]="CeateBullet",t[t.RemoveBullet=5]="RemoveBullet",t[t.RemoveItem=6]="RemoveItem",t[t.RemoveStone=7]="RemoveStone",t[t.HeroDie=8]="HeroDie",t[t.AddScore=9]="AddScore"}(GameConst||(GameConst={}));var GameController=function(t){function e(){t.call(this),GameManager.Init(),this.gameView=new GameView(this,LayerManager.Game_Main),App.ViewManager.register(ViewConst.Game,this.gameView),this.gameUIView=new GameUIView(this,LayerManager.Game_UI),App.ViewManager.register(ViewConst.GameUI,this.gameUIView),this.registerFunc(GameConst.Jump,this.gameView.Jump,this.gameView),this.registerFunc(GameConst.Shoot,this.gameView.Shoot,this.gameView),this.registerFunc(GameConst.Dodge,this.gameView.Dodge,this.gameView),this.registerFunc(GameConst.CeateBullet,this.gameView.CreateBullet,this.gameView),this.registerFunc(GameConst.RemoveBullet,this.gameView.RemoveBullet,this.gameView),this.registerFunc(GameConst.RemoveItem,this.gameView.RemoveItem,this.gameView),this.registerFunc(GameConst.RemoveStone,this.gameView.RemoveStone,this.gameView),this.registerFunc(GameConst.HeroDie,this.gameView.SetHeroDie,this.gameView),this.registerFunc(GameConst.AddScore,this.gameUIView.AddScore,this.gameUIView)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.GetNearestInArea=function(t,e){var i=[],s=this.gameView.GetItems();i=(t.side=Side.Own)?this.gameView.GetEnemies():[this.gameView.GetHero()];for(var n,r=2e3,a=e[0],o=e[1],h=0;h<i.length;h++){var l=i[h];l.y>=a&&l.y<=o&&Math.abs(l.y-t.y)<r&&(r=Math.abs(l.y-t.y),n=l)}for(var h=0;h<s.length;h++){var c=s[h];c.y>=a&&c.y<=o&&Math.abs(c.y-t.y)<r&&(r=Math.abs(c.y-t.y),n=c)}return n},s.GetSafeArea=function(t){var e=[this.gameView.min_y,this.gameView.max_y],i=[];if(!t.HaveItem()){var s=[];s=t.side==Side.Own?this.gameView.GetEnemyBullets():this.gameView.GetOwnBullets();for(var n=0;n<s.length;n++)for(var r=s[n],a=r.GetDangerArea(t.x,.6),o=0;o<a.length;o++)e.push(a[o]);e.sort(SortUtils.sortNum)}for(var h=1.5*t.height,n=0;n<e.length;n++)if(n<e.length-1){var l=e[n],c=e[n+1];c-l>h&&i.push([l,c])}return i},s.checkDanger=function(t,e){var i=[];i=t.side==Side.Own?this.gameView.GetEnemyBullets():this.gameView.GetOwnBullets();var s=t.rect;s.x-=e;var n=t.rect;n.x+=e;for(var r,a=0;a<i.length;a++){var o=i[a];if(r=o.scaleX>0?s:n,r.intersectTo(o.rect))return!0}return!1},s.CheckHitHeroByRect=function(t){for(var e=[],i=[],s=this.gameView.GetEnemies(),n=0;n<s.length;n++)i.push(s[n]);i.push(this.gameView.GetHero());for(var r=0;r<i.length;r++){var a=i[r];null!=a&&this.hitTest(t,a.rect)&&e.push(a)}return e},s.CheckHitBullet=function(t){var e=[],i=[];i=t.side==Side.Own?this.gameView.GetEnemyBullets():this.gameView.GetOwnBullets();for(var s=0;s<i.length;s++){var n=i[s];this.hitTest(t.rect,n.rect)&&e.push(n)}return e},s.CheckHitHero=function(t){var e=[],i=[];i=t.side==Side.Own?this.gameView.GetEnemies():[this.gameView.GetHero()];for(var s=0;s<i.length;s++){var n=i[s];null!=n&&this.hitTest(t.rect,n.rect)&&e.push(n)}return e},s.CheckHitItem=function(t){for(var e=[],i=this.gameView.GetItems(),s=0;s<i.length;s++){var n=i[s];this.hitTest(t.rect,n.rect)&&e.push(n)}return e},s.CheckHitStone=function(t){for(var e=[],i=this.gameView.GetStones(),s=0;s<i.length;s++){var n=i[s];this.hitTest(t.rect,n.rect)&&e.push(n)}return e},s.CheckHeroOut=function(t){return t.y-t.anchorOffsetY<this.gameView.min_y?(t.y=this.gameView.min_y+t.anchorOffsetY,!0):t.y-t.anchorOffsetY+t.height>this.gameView.max_y?(t.y=this.gameView.max_y+t.anchorOffsetY-t.height,!0):!1},s.CheckOutScreen=function(t){var e=App.StageUtils.getWidth(),i=App.StageUtils.getHeight();return!this.hitTest(new Rect(t.x,t.y,t.width,t.height,t.rotation),new Rect(e/2,i/2,e+200,i+200,0))},s.hitTest=function(t,e){return t.intersectTo(e)},s.GetPerX=function(t){return(this.gameView.max_x-this.gameView.min_x)*t+this.gameView.min_x},e}(BaseController);egret.registerClass(GameController,"GameController");var GameManager=function(){function t(){}var e=__define,i=t;i.prototype;return t.Init=function(){var t=RES.getRes("game_json");this.ui_h=t.ui_h;var e=t.heroes,i=t.guns,s=t.bullets,n=t.items,r=t.stones;this.heroPosArr=t.posArr;for(var a=0;a<e.length;a++){var o=e[a];this.heroDic[o.id]=o}for(var a=0;a<i.length;a++){var h=i[a];this.gunDic[h.id]=h}for(var a=0;a<s.length;a++){var l=s[a];this.bulletDic[l.id]=l}for(var a=0;a<n.length;a++){var c=n[a];this.itemDic[c.id]=c}for(var a=0;a<r.length;a++){var u=r[a];this.stoneDic[u.id]=u}},t.GetHeroData=function(t){return this.heroDic[t]},t.GetGunData=function(t){return this.gunDic[t]},t.GetBulletData=function(t){return this.bulletDic[t]},t.GetItemData=function(t){return this.itemDic[t]},t.GetStoneData=function(t){return this.stoneDic[t]},e(t,"UI_H",function(){return this.ui_h}),t.GetHeroPos=function(t){return this.heroPosArr[t]},t.heroDic={},t.gunDic={},t.bulletDic={},t.itemDic={},t.stoneDic={},t.heroPosArr=[],t}();egret.registerClass(GameManager,"GameManager");var GameUIView=function(t){function e(e,i){t.call(this,e,i),this.width=App.StageUtils.getWidth(),this.y=App.StageUtils.getHeight()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.initUI=function(){t.prototype.initUI.call(this),this.bg=App.DisplayUtils.createBitmap("bottom_png"),AnchorUtil.setAnchorY(this.bg,1),this.bg.name="bg",this.addChild(this.bg),this.jumpBtn=this.createBtn("btn_jump_png",this.bg.width/8,-this.bg.height/2,0,this.bg.width/3,this.jumpBtnUp,this.jumpBtnDown,this),this.jumpBtn.name="jumpBtn",this.addChild(this.jumpBtn),this.dodgeBtn=this.createBtn("btn_dodge_png",6*this.bg.width/8,-this.bg.height/2,4*this.bg.width/6,5*this.bg.width/6,this.dodgeBtnUp,this.dodgeBtnDown,this),this.dodgeBtn.name="dodgeBtn",this.addChild(this.dodgeBtn),this.shootBtn=this.createBtn("btn_shoot_png",7*this.bg.width/8,-this.bg.height/2,5*this.bg.width/6,this.bg.width,this.shootBtnUp,this.shootBtnDown,this),this.shootBtn.name="shootBtn",this.addChild(this.shootBtn),this.score=new egret.TextField,this.score.width=200,this.score.x=this.bg.width/2-100,this.score.y=-100,this.score.textAlign="center",this.score.size=70,this.score.bold=!0,this.score.text="0",this.addChild(this.score),App.KeyboardUtils.addKeyUp(this.onKeyUp,this),App.KeyboardUtils.addKeyDown(this.onKeyDown,this)},s.initData=function(){t.prototype.initData.call(this)},s.AddScore=function(){this.score.text=(parseInt(this.score.text)+1).toString()},s.jumpBtnDown=function(){this.jumpBtn.scaleX=this.jumpBtn.scaleY=.9,App.ControllerManager.applyFunc(ControllerConst.Game,GameConst.Jump,!0)},s.jumpBtnUp=function(){this.jumpBtn.scaleX=this.jumpBtn.scaleY=1,App.ControllerManager.applyFunc(ControllerConst.Game,GameConst.Jump,!1)},s.dodgeBtnDown=function(){this.dodgeBtn.scaleX=this.dodgeBtn.scaleY=.9,App.ControllerManager.applyFunc(ControllerConst.Game,GameConst.Dodge)},s.dodgeBtnUp=function(){this.dodgeBtn.scaleX=this.dodgeBtn.scaleY=1},s.shootBtnDown=function(){this.shootBtn.scaleX=this.shootBtn.scaleY=.9,App.ControllerManager.applyFunc(ControllerConst.Game,GameConst.Shoot)},s.shootBtnUp=function(){this.shootBtn.scaleX=this.shootBtn.scaleY=1},s.onKeyDown=function(t){switch(t){case Keyboard.W:this.jumpBtnDown();break;case Keyboard.I:this.shootBtnDown();break;case Keyboard.U:this.dodgeBtnDown();break;case Keyboard.SPACE:App.TimerManager.setTimeScale(.1);break;case Keyboard.J:App.TimerManager.setTimeScale(1)}},s.onKeyUp=function(t){switch(t){case Keyboard.W:this.jumpBtnUp();break;case Keyboard.I:this.shootBtnUp();break;case Keyboard.U:this.dodgeBtnUp()}},s.createBtn=function(t,e,i,s,n,r,a,o){var h=App.DisplayUtils.createBitmap(t);h.touchEnabled=!0,AnchorUtil.setAnchor(h,.5);var l=new egret.Sprite;l.width=n-s,l.height=App.StageUtils.getHeight(),l.x=(s+n)/2,l.y=-l.height/2,l.touchEnabled=!0,AnchorUtil.setAnchor(l,.5);var c=new egret.Shape;return c.graphics.beginFill(16777215,0),c.graphics.drawRect(0,0,l.width,l.height),c.graphics.endFill(),l.addChild(c),this.addChild(l),h.touchEnabled=!1,l.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){a.call(o)},this),l.addEventListener(egret.TouchEvent.TOUCH_END,function(){r.call(o)},this),l.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){r.call(o)},this),h.x=e,h.y=i,h},e}(BaseSpriteView);egret.registerClass(GameUIView,"GameUIView");var GameView=function(t){function e(e,i){t.call(this,e,i),this.ownBullets=[],this.enemies=[],this.enemyBullets=[],this.items=[],this.stones=[],this.itemInterval=5,this.itemCd=0,this.stoneInterval=6,this.stoneCd=0,this.seInterval=15,this.seCd=0,this.controller=e}__extends(e,t);var i=__define,s=e,n=s.prototype;return n.initUI=function(){t.prototype.initUI.call(this),this.bgContainer=new egret.DisplayObjectContainer,this.addChild(this.bgContainer);var e=App.DisplayUtils.createBitmap("bg_png");this.bgContainer.addChild(e);var i=App.DisplayUtils.createBitmap("bg_png");i.x=e.width,this.bgContainer.addChild(i),this.width=App.StageUtils.getWidth(),this.height=App.StageUtils.getHeight(),this.roundText=new egret.TextField,this.roundText.width=400,this.roundText.anchorOffsetX=200,this.roundText.anchorOffsetY=40,this.roundText.x=this.width/2,this.roundText.y=this.height/2-100,this.roundText.textAlign="center",this.roundText.size=80,this.roundText.bold=!0,this.addChild(this.roundText),this.roundText.visible=!1,this.setState(0),this.round=1,this.wave=1,App.TimerManager.doFrame(1,0,this.update,this)},n.initData=function(){t.prototype.initData.call(this)},n.update=function(t){var e=this,i=t/1e3;switch(this.state){case 0:this.roundText.text="ROUND "+this.round,this.roundText.scaleX=this.roundText.scaleY=.1,this.roundText.visible=!0,this.roundText.alpha=1,egret.Tween.get(this.roundText).to({scaleX:1,scaleY:1},400,egret.Ease.elasticOut).wait(500).to({alpha:.1},300).call(function(){e.roundText.visible=!1}),this.createHero(),this.setState(1);break;case 1:this.createEnemy(AiType.Follow),this.seCd=App.RandomUtils.limit(this.seInterval/2,this.seInterval),this.setState(2);break;case 2:this.itemCd-=i,this.itemCd<=0&&(this.createItem(App.RandomUtils.limitInteger(2,8)),this.itemCd=this.itemInterval),this.stoneCd-=i,this.stoneCd<=0&&(this.createStone(App.RandomUtils.limitInteger(1,2)),this.stoneCd=this.stoneInterval),this.seCd-=i,this.seCd<=0&&(this.addSceneEffect(),this.seCd=this.seInterval);break;case 3:this.transTime-=i,this.transTime<=0&&this.next();break;case 4:var s=App.StageUtils.getWidth();null!=this.hero&&this.hero.GetState()==HeroState.Idle&&(this.hero.destory(),this.hero=null),this.bgDis>2*s/3&&(this.clearItems(),this.clearStones(),this.clearEffect()),this.bgDis>4*s?this.bgSpeed<=.6?(this.bgSpeed=.6,this.bgContainer.x>=-30&&this.setState(0)):this.bgSpeed-=i:this.bgSpeed<6&&(this.bgSpeed+=i),this.bgContainer.x=(this.bgContainer.x-this.bgSpeed*t)%s,this.bgDis+=this.bgSpeed*t;break;case 5:}},n.gameOver=function(){null==this.over&&(this.over=new egret.TextField,this.over.width=600,this.over.anchorOffsetX=300,this.over.anchorOffsetY=40,this.over.x=this.width/2,this.over.y=this.height/2-100,this.over.textAlign="center",this.over.size=80,this.over.bold=!0,this.over.text="GAME OVER!",this.addChild(this.over)),this.setState(5),this.over.scaleX=this.roundText.scaleY=.1,this.over.visible=!0,this.over.alpha=1,egret.Tween.get(this.over).to({scaleX:1,scaleY:1},400,egret.Ease.elasticOut)},n.trans=function(){this.setState(3),this.transTime=0},n.next=function(){if(this.wave<this.round)this.setState(2),this.createEnemy(AiType.Follow),this.wave+=1;else{var t=this.getPerPos(1.2,.5);this.hero.Move(t),this.setState(4),this.round+=1,this.wave=1,this.bgSpeed=0,this.bgDis=0}},n.setState=function(t){5!=this.state&&(this.state=t)},n.addSceneEffect=function(){var t=ObjectPool.pop("SceneEffect",this.controller),e=[0,180,25,155,-25,-155];t.init(Side.Middle,e[App.RandomUtils.limitInteger(0,e.length-1)]),t.x=this.getPerXPos(.5),t.y=this.getPerYPos(.5),this.bgContainer.addChild(t),this.sceneEffet=t},n.createHero=function(){this.hero=ObjectPool.pop("Hero",this.controller),this.hero.init(1,Side.Own);var t=this.getPerPos(-.1,.5);this.hero.x=t.x,this.hero.y=t.y,this.hero.SetPosArr(this.getHeroPos(0),this.getHeroPos(1)),this.addChild(this.hero),this.hero.Entrance()},n.createEnemy=function(t){var e=ObjectPool.pop("Hero",this.controller);e.init(1,Side.Enemy),e.SetAI(t);var i=this.getPerPos(1.1,.4);e.x=i.x,e.y=i.y,e.SetPosArr(this.getHeroPos(3),this.getHeroPos(2)),this.addChild(e),this.enemies.push(e),e.Entrance()},n.SetHeroDie=function(t){var e,i=this,s=this.getPerPos(0,1.2).y;e=t.side==Side.Own?t.x-200:t.x+200,egret.Tween.get(t).to({x:e,y:s,rotation:s-t.y},s-t.y).call(function(){i.RemoveHero(t)},this)},n.RemoveHero=function(t){if(t.destory(),t.side==Side.Own)this.gameOver();else if(t.side=Side.Enemy){var e=this.enemies.indexOf(t);this.enemies.splice(e,1),App.ControllerManager.applyFunc(ControllerConst.Game,GameConst.AddScore,this),0==this.enemies.length&&this.trans()}},n.CreateBullet=function(t,e,i,s,n,r){var a=ObjectPool.pop(e,this.controller);a.init(t,i,r),a.x=s,a.y=n,i.side==Side.Own?this.ownBullets.push(a):i.side==Side.Enemy&&this.enemyBullets.push(a),this.addChild(a)},n.RemoveBullet=function(t){if(t.side==Side.Own){var e=this.ownBullets.indexOf(t);this.ownBullets.splice(e,1)}else if(t.side=Side.Enemy){var e=this.enemyBullets.indexOf(t);this.enemyBullets.splice(e,1)}t.destory()},n.createItem=function(t){var e=ObjectPool.pop("Item",this.controller),i=App.RandomUtils.limitInteger(0,1);e.init(t,Side.Middle,i);var s=this.getPerPos(App.RandomUtils.limit(.4,.6),i);e.x=s.x,e.y=s.y,0==i?e.y-=50:e.y+=50,this.bgContainer.addChild(e),this.items.push(e)},n.RemoveItem=function(t){var e=this.items.indexOf(t);this.items.splice(e,1),t.destory()},n.createStone=function(t){var e=ObjectPool.pop("Stone",this.controller),i=App.RandomUtils.limitInteger(0,1);e.init(t,Side.Middle,i);var s=this.getPerPos(App.RandomUtils.limit(.4,.6),i);e.x=s.x,e.y=s.y,0==i?e.y-=100:e.y+=100,this.bgContainer.addChild(e),this.stones.push(e)},n.clearItems=function(){if(this.items.length>0){for(var t=0;t<this.items.length;t++)this.items[t].destory();this.items=[]}},n.clearStones=function(){if(this.stones.length>0){for(var t=0;t<this.stones.length;t++)this.stones[t].destory();this.stones=[]}},n.clearEffect=function(){null!=this.sceneEffet&&this.sceneEffet.destory()},n.RemoveStone=function(t){var e=this.stones.indexOf(t);this.stones.splice(e,1),t.destory()},n.Jump=function(t){null!=this.hero&&(this.hero.IsUp=t)},n.Shoot=function(){null!=this.hero&&this.hero.Shoot()},n.Dodge=function(){null!=this.hero&&this.hero.Dodge()},n.GetHero=function(){return this.hero},n.GetOwnBullets=function(){return this.ownBullets},n.GetEnemies=function(){return this.enemies},n.GetEnemyBullets=function(){return this.enemyBullets},n.GetItems=function(){return this.items},n.GetStones=function(){return this.stones},i(n,"min_x",function(){return 0}),i(n,"max_x",function(){return App.StageUtils.getWidth()}),i(n,"min_y",function(){return 0}),i(n,"max_y",function(){return App.StageUtils.getHeight()-GameManager.UI_H}),n.getHeroPos=function(t){return this.getPerXPos(GameManager.GetHeroPos(t))},n.getPerXPos=function(t){return(this.max_x-this.min_x)*t+this.min_x},n.getPerYPos=function(t){return(this.max_y-this.min_y)*t+this.min_y},n.getPerPos=function(t,e){return new egret.Point(this.getPerXPos(t),this.getPerYPos(e))},e}(BaseSpriteView);egret.registerClass(GameView,"GameView");var BulletData=function(){function t(){}var e=(__define,t);e.prototype;return t}();egret.registerClass(BulletData,"BulletData");var GunData=function(){function t(){}var e=(__define,t);e.prototype;return t}();egret.registerClass(GunData,"GunData");var GunType;!function(t){t[t.Normal=1]="Normal",t[t.Running=2]="Running",t[t.Shot=3]="Shot",t[t.Boomerang=4]="Boomerang",t[t.Laser=5]="Laser",t[t.Freez=6]="Freez",t[t.Grenade=7]="Grenade",t[t.Wave=8]="Wave"}(GunType||(GunType={}));var HeroData=function(){function t(){}var e=(__define,t);e.prototype;return t}();egret.registerClass(HeroData,"HeroData");var ItemData=function(){function t(){}var e=(__define,t);e.prototype;return t}();egret.registerClass(ItemData,"ItemData");var MoveData=function(){function t(t){this.direction=t}var e=(__define,t);e.prototype;return t}();egret.registerClass(MoveData,"MoveData");var Rect=function(){function t(t,e,i,s,n){this.x=t,this.y=e,this.width=i,this.height=s,this.rotation=n}var e=(__define,t),i=e.prototype;return i.getPoints=function(){var t=Math.sqrt(Math.pow(this.width/2,2)+Math.pow(this.height/2,2)),e=this.rotation/180*Math.PI-Math.atan(this.width/this.height),i=this.rotation/180*Math.PI+Math.atan(this.width/this.height),s=this.rotation/180*Math.PI-Math.atan(this.width/this.height)+Math.PI,n=this.rotation/180*Math.PI+Math.atan(this.width/this.height)+Math.PI,r=new egret.Point(this.x+t*Math.sin(e),this.y-t*Math.cos(e)),a=new egret.Point(this.x+t*Math.sin(i),this.y-t*Math.cos(i)),o=new egret.Point(this.x+t*Math.sin(s),this.y-t*Math.cos(s)),h=new egret.Point(this.x+t*Math.sin(n),this.y-t*Math.cos(n));return[r,a,o,h]},i.between=function(t,e,i){var s=t-e,n=t-i;return 1e-8>s&&n>-1e-8||1e-6>n&&s>-1e-8?!0:!1},i.detectIntersect=function(t,e,i,s){var n,r;if(Math.abs(t.x-e.x)<1e-6&&Math.abs(i.x-s.x)<1e-6)return!1;if(Math.abs(t.x-e.x)<1e-6){if(this.between(t.x,i.x,s.x)){var a=(s.y-i.y)/(s.x-i.x);return n=t.x,r=a*(n-i.x)+i.y,this.between(r,t.y,e.y)?!0:!1}return!1}if(Math.abs(i.x-s.x)<1e-6){if(this.between(i.x,t.x,e.x)){var a=(e.y-t.y)/(e.x-t.x);return n=i.x,r=a*(n-e.x)+e.y,this.between(r,i.y,s.y)?!0:!1}return!1}var o=(e.y-t.y)/(e.x-t.x),h=(s.y-i.y)/(s.x-i.x);return Math.abs(o-h)<1e-6?!1:(n=(i.y-t.y-(h*i.x-o*t.x))/(o-h),r=o*(n-t.x)+t.y,this.between(n,t.x,e.x)&&this.between(n,i.x,s.x)?!0:!1)},i.mult=function(t,e,i){var s=t.x,n=t.y,r=e.x,a=e.y,o=i.x,h=i.y;return(n-a)*o+(r-s)*h+s*a-r*n},i.Contain=function(t){var e=this.getPoints(),i=this.mult(e[0],e[1],t),s=this.mult(e[3],e[2],t),n=this.mult(e[1],e[2],t),r=this.mult(e[0],e[3],t);return 0>i*s&&0>n*r},i.intersectTo=function(t){for(var e=this.getPoints(),i=t.getPoints(),s=0;s<e.length;s++)if(t.Contain(e[s]))return!0;for(var s=0;s<i.length;s++)if(this.Contain(i[s]))return!0;for(var s=0;s<e.length;s++){var n,r=e[s];n=s<e.length-1?e[s+1]:e[0];for(var a=0;a<i.length;a++){var o,h=i[a];if(o=a<i.length-1?i[a+1]:i[0],this.detectIntersect(r,n,h,o))return!0}}return!1},t}();egret.registerClass(Rect,"Rect");var StoneData=function(){function t(){}var e=(__define,t);e.prototype;return t}();egret.registerClass(StoneData,"StoneData");var BaseGameObject=function(t){function e(e){t.call(this),this.showRect=!1,this.controller=e}__extends(e,t);var i=__define,s=e,n=s.prototype;return n.init=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];this._side=t,AnchorUtil.setAnchor(this,.5),App.TimerManager.doFrame(1,0,this.onFrame,this)},n.destory=function(){App.TimerManager.remove(this.onFrame,this),App.DisplayUtils.removeFromParent(this),null!=this.hitRect&&(App.DisplayUtils.removeFromParent(this.hitRect),this.hitRect=null),ObjectPool.push(this)},n.onFrame=function(t){if(this.update(t),this.showRect&&null!=this.parent)if(null==this.hitRect)this.hitRect=new egret.Shape,this.parent.addChild(this.hitRect);else{var e=this.rect.getPoints();this.hitRect.graphics.clear();for(var i=0;i<e.length;i++){var s,n=e[i];s=i<e.length-1?e[i+1]:e[0],this.hitRect.graphics.lineStyle(10,267386880,.5),this.hitRect.graphics.moveTo(n.x,n.y),this.hitRect.graphics.lineTo(s.x,s.y)}}},n.update=function(t){},i(n,"gameController",function(){return this.controller}),i(n,"side",function(){return this._side}),i(n,"rect",function(){return new Rect(this.x,this.y,this.width,this.height,this.rotation)}),e}(egret.DisplayObjectContainer);egret.registerClass(BaseGameObject,"BaseGameObject");var Side;!function(t){t[t.Own=0]="Own",t[t.Enemy=1]="Enemy",t[t.Middle=2]="Middle"}(Side||(Side={}));var Bullet=function(t){function e(e){t.call(this,e)}__extends(e,t);var i=__define,s=e,n=s.prototype;return n.init=function(e,i,s){t.prototype.init.call(this,i.side),this.id=e,this.creater=i,this.side==Side.Own?this.scaleX=1:this.side==Side.Enemy&&(this.scaleX=-1),this.moveData=s,this.rotation=s.direction*this.scaleX,this.bulletData=GameManager.GetBulletData(e),this.speed=this.bulletData.speed,this.ignoreHeroes=[],this.ignoreStones=[]},n.setImg=function(t){null==this.img&&(this.img=new egret.Bitmap,this.addChild(this.img)),this.img.texture=RES.getRes(t),this.img.x=this.bulletData.width/2,this.img.y=this.bulletData.height/2,this.img.anchorOffsetX=this.img.width/2,this.img.anchorOffsetY=this.img.height/2},n.update=function(e){t.prototype.update.call(this,e),null!=this.bulletData.trail&&this.drawTrail(this.bulletData.trail);var i=e/1e3;if(this.x+=this.speed*i*Math.cos(this.rotation/180*Math.PI)*this.scaleX,this.y+=this.speed*i*Math.sin(this.rotation/180*Math.PI)*this.scaleX,1==this.priority){var s=this.gameController.CheckHitBullet(this);if(s.length>0){this.remove();for(var n=0;n<s.length;n++){var r=s[n];1==r.priority&&r.remove()}}}var a=this.gameController.CheckHitHero(this),o=this.gameController.CheckHitItem(this),h=this.gameController.CheckOutScreen(this),l=this.gameController.CheckHitStone(this);a.length>0&&this.hitHero(a),o.length>0&&this.hitItems(o),h&&this.outScreen(),this.hitStones.length>0&&this.hitStones(l)},n.hitHero=function(t){for(var e=0;e<t.length;e++){var i=t[e];this.checkIgnoreHero(i)||(i.Hurt(this.damage),this.doEffect(i))}},n.hitItems=function(t){for(var e=0;e<t.length;e++){var i=t[e];i.ToHero(this.creater)}},n.hitStones=function(t){for(var e=0;e<t.length;e++){var i=t[e];if(!this.checkIgnoreStone(i)){1==this.priority&&this.remove();var s=App.MathUtils.getAngle(App.MathUtils.getRadian2(this.x,this.y,i.x,i.y));i.Hit(50*Math.sqrt(this.damage),s),this.ignoreStones.push(i)}}},n.outScreen=function(){this.remove()},n.remove=function(){App.ControllerManager.applyFunc(ControllerConst.Game,GameConst.RemoveBullet,this)},n.drawTrail=function(t){null==this.tail&&(this.tail=ObjectPool.pop("Tail"),this.tail.init(3.5*Math.sqrt(this.height),t),this.creater.parent.addChild(this.tail),this.parent.swapChildren(this.tail,this)),this.tail.addPoint(this.x,this.y)},n.clearTail=function(){this.tail.clear(),this.tail=null},n.destory=function(){t.prototype.destory.call(this),null!=this.tail&&this.clearTail()},n.checkIgnoreHero=function(t){return this.ignoreHeroes.indexOf(t)>=0},n.checkIgnoreStone=function(t){return this.ignoreStones.indexOf(t)>=0},i(n,"priority",function(){return this.bulletData.priority}),i(n,"damage",function(){return this.bulletData.damage}),n.doEffect=function(t){},n.GetDangerArea=function(t,e){var i=[],s=t-this.x-this.width/2*Math.abs(Math.cos(this.rotation)),n=s/this.speed;if(e>n){var r=this.y-this.height/2/Math.abs(Math.cos(this.rotation)),a=this.y+this.height/2/Math.abs(Math.cos(this.rotation));i=[r,a]}return i},e}(BaseGameObject);egret.registerClass(Bullet,"Bullet");var BoomerangBullet=function(t){function e(e){t.call(this,e)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(e,i,s){t.prototype.init.call(this,e,i,s),t.prototype.setImg.call(this,this.bulletData.img),this.width=this.bulletData.width,this.height=this.bulletData.height,this.targetX=this.gameController.GetPerX(.5+.45*this.scaleX),this.state=0},s.update=function(e){switch(t.prototype.update.call(this,e),this.img.rotation+=e,this.state){case 0:this.speed-=.9*e,(this.scaleX>0&&this.x>=this.targetX||this.scaleX<0&&this.x<=this.targetX)&&(this.state=1,this.ignoreHeroes=[],this.ignoreStones=[]);break;case 1:this.speed+=.9*e;var i=App.MathUtils.getRadian2(this.x,this.y,this.creater.x,this.creater.y);-1==this.scaleX&&(i=App.MathUtils.getRadian2(this.creater.x,this.creater.y,this.x,this.y));var s=App.MathUtils.getAngle(i);this.rotation=s;var n=new Rect(this.creater.x,this.creater.y,this.creater.width,this.creater.height,0);this.rect.intersectTo(n)&&(this.remove(),this.creater.GunReturn());break;case 2:this.speed+=e;var r=90,a=this.rotation;this.rotation<0&&(a+=360),-1==this.scaleX&&(r=-90,a>180&&(r=270)),a>r?this.rotation=Math.max(r,a-e/5):this.rotation=Math.min(r,a+e/5)}},s.hitHero=function(e){t.prototype.hitHero.call(this,e);for(var i=0;i<e.length;i++)this.ignoreHeroes.push(e[i])},s.hitItems=function(e){t.prototype.hitItems.call(this,e),this.state=2},s.outScreen=function(){t.prototype.outScreen.call(this)},e}(Bullet);egret.registerClass(BoomerangBullet,"BoomerangBullet");var NormalBullet=function(t){function e(e){t.call(this,e)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(e,i,s){t.prototype.init.call(this,e,i,s),t.prototype.setImg.call(this,this.bulletData.img),this.width=this.bulletData.width,this.height=this.bulletData.height},s.update=function(e){t.prototype.update.call(this,e)},s.hitHero=function(e){t.prototype.hitHero.call(this,e),this.remove()},s.hitItems=function(e){t.prototype.hitItems.call(this,e),this.remove()},s.outScreen=function(){t.prototype.outScreen.call(this)},e}(Bullet);egret.registerClass(NormalBullet,"NormalBullet");var FreezBullet=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.doEffect=function(t){t.Freez(.5)},e}(NormalBullet);egret.registerClass(FreezBullet,"FreezBullet");var GrenadeBullet=function(t){function e(e){t.call(this,e)}__extends(e,t);var i=__define,s=e,n=s.prototype;return n.init=function(e,i,s){t.prototype.init.call(this,e,i,s),t.prototype.setImg.call(this,this.bulletData.img),this.width=this.bulletData.width,this.height=this.bulletData.height;var n=this.bulletData.info;this.releaseTime=n.releaseTime,this.stayTime=n.stayTime,this.displayTime=n.displayTime,this.setBombImg(n.bombImg),this.bombImg.visible=!1,this.targetX=this.gameController.GetPerX(.5+.3*this.scaleX),this.targetY=null,this.state=1,this.img.visible=!0},n.setBombImg=function(t){null==this.bombImg&&(this.bombImg=new egret.Bitmap,this.addChild(this.bombImg)),this.bombImg.texture=RES.getRes(t),this.bombImg.x=this.bulletData.width/2,this.bombImg.y=this.bulletData.height/2,this.bombImg.anchorOffsetX=this.bombImg.width/2,this.bombImg.anchorOffsetY=this.bombImg.height/2
},n.update=function(e){null==this.targetY&&(this.targetY=this.y,this.flyTime=Math.abs(this.targetX-this.x)/this.speed,this.rotationChange=2*-this.rotation/this.flyTime),this.speed/=Math.cos(this.rotation/180*Math.PI),t.prototype.update.call(this,e);var i=e/1e3;switch(this.state){case 1:this.flyTime-=i,this.flyTime<=0?this.bomb():(this.rotation+=i*this.rotationChange,this.speed=this.bulletData.speed);break;case 2:this.bombImg.scaleX=this.bombImg.scaleY+=i*(.8/this.releaseTime),this.bombImg.scaleX>=1&&(this.state=3);break;case 3:this.stayTime-=i,this.stayTime<=0&&(this.state=4);break;case 4:this.bombImg.scaleX=this.bombImg.scaleY-=i*(.5/this.displayTime),this.bombImg.scaleX<=.5&&this.remove()}},n.bomb=function(){this.speed=0,this.state=2,this.img.visible=!1,this.bombImg.visible=!0,this.bombImg.scaleX=this.bombImg.scaleY=.2},n.hitHero=function(e){if(t.prototype.hitHero.call(this,e),1==this.state)this.bomb();else for(var i=0;i<e.length;i++)this.ignoreHeroes.push(e[i])},n.hitItems=function(e){t.prototype.hitItems.call(this,e),1==this.state&&this.bomb()},n.outScreen=function(){1!=this.state&&t.prototype.outScreen.call(this)},i(n,"damage",function(){return 1==this.state?0:this.bulletData.damage}),i(n,"rect",function(){var t,e;return 1==this.state?(t=this.width,e=this.height):(t=this.bombImg.width*this.bombImg.scaleX,e=this.bombImg.height*this.bombImg.scaleY),new Rect(this.x,this.y,t,e,this.rotation)}),e}(Bullet);egret.registerClass(GrenadeBullet,"GrenadeBullet");var Hero=function(t){function e(e){t.call(this,e),this.aiDodgeInterval=5,this.hpArr=[],this.posArr=[]}__extends(e,t);var i=__define,s=e,n=s.prototype;return n.init=function(e,i){t.prototype.init.call(this,i),this.id=e,this.side==Side.Own?this.scaleX=1:this.side==Side.Enemy&&(this.scaleX=-1),this.heroData=GameManager.GetHeroData(e),this.width=this.heroData.width,this.height=this.heroData.height,this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.setAnim(this.heroData.anim),this.setGun(this.heroData.gun),this.isUp=!1,this.speed=0,this.hp=0,this.addHp(this.heroData.hp),this.showFreez(!1),this.rotation=0},n.setAnim=function(t){null==this.anim&&(this.anim=new egret.MovieClip,this.anim.scaleX=this.anim.scaleY=.8,this.anim.anchorOffsetX=-this.width/2/.8,this.anim.anchorOffsetY=-this.height/.8,this.addChild(this.anim));var e=RES.getRes("hero_json"),i=RES.getRes("hero_png"),s=new egret.MovieClipDataFactory(e,i);this.anim.movieClipData=s.generateMovieClipData(t),this.anim.gotoAndPlay(1,-1)},n.setGun=function(t){null==this.gun&&(this.gun=new egret.Bitmap,this.gun.x=this.heroData.gunX,this.gun.y=this.heroData.gunY,this.addChild(this.gun)),this.gun.visible=!0,this.gunData=GameManager.GetGunData(t),this.gun.texture=RES.getRes(this.gunData.img),this.shootCd=this.shootInterval},n.addHp=function(t){for(var e=function(t){var e;i.hpArr.length>t?e=i.hpArr[t]:(e=new egret.Shape,e.graphics.beginFill(16711935),e.graphics.drawRect(0,0,20,15),e.graphics.endFill(),e.x=-40,e.y=25*t,i.addChild(e),i.hpArr.push(e)),e.visible=!0,e.scaleX=e.scaleY=.01,egret.setTimeout(function(){egret.Tween.get(e).to({scaleX:1,scaleY:1},300,egret.Ease.elasticOut)},i,200*t)},i=this,s=this.hp;s<this.hp+t;s++)e(s);this.hp+=t},n.subHp=function(t){for(var e=function(t){var e=i.hpArr[t];egret.setTimeout(function(){egret.Tween.get(e).to({scaleX:.01,scaleY:.01},300,egret.Ease.elasticOut).call(function(){e.visible=!1})},i,200*(i.hp-1-t))},i=this,s=this.hp-1;s>=Math.max(0,this.hp-t);s--)e(s);this.hp=Math.max(0,this.hp-t),this.hp<=0&&(this.state=HeroState.Die,App.ControllerManager.applyFunc(ControllerConst.Game,GameConst.HeroDie,this))},n.showFreez=function(t){null==this.freezImg&&(this.freezImg=App.DisplayUtils.createBitmap("freez_png"),this.addChild(this.freezImg),this.freezImg.anchorOffsetX=this.freezImg.width/2,this.freezImg.anchorOffsetY=this.freezImg.height/2),this.freezImg.x=this.width/2,this.freezImg.y=this.height/2,this.freezImg.visible=t},n.SetAI=function(t){this.aiType=t},n.SetPosArr=function(t,e){this.posArr=[t,e]},n.ChangeGun=function(t){this.setGun(t)},n.Entrance=function(){this.Move(new egret.Point(this.posArr[0],this.y)),this.curPosIndex=0},n.Move=function(t){this.state=HeroState.Move,this.targetPos=t},n.ToIdle=function(){this.state=HeroState.Idle},n.Hurt=function(t){0>=t||(App.ShockUtils.shock(App.ShockUtils.SPRITE,this,1),this.state=HeroState.Hurt,this.hurtTime=0,this.subHp(t))},n.Freez=function(t){this.state=HeroState.Freez,this.freezTime=t},n.Release=function(t){this.state=HeroState.Release,this.releaseTime=t},n.Dodge=function(){return this.state!=HeroState.Idle?!1:(this.state=HeroState.Dodge,0==this.curPosIndex?this.curPosIndex=1:this.curPosIndex=0,this.targetPos=new egret.Point(this.posArr[this.curPosIndex],this.y),!0)},n.Shoot=function(){var t=this;if(this.state==HeroState.Idle&&this.shootCd<=0){var e=this.gunData.bullet,i=function(i,s){var n=t.x+(t.gun.x+t.gunData.bulletX-t.anchorOffsetX)*t.scaleX,r=t.y-t.anchorOffsetY+t.gun.y+t.gunData.bulletY,a=new MoveData(s);App.ControllerManager.applyFunc(ControllerConst.Game,GameConst.CeateBullet,e,i,t,n,r,a)};switch(this.gunData.type){case GunType.Normal:i("NormalBullet",0),this.shootCd=this.shootInterval;break;case GunType.Running:var s=this.gunData.info,n=s.count,r=1e3*s.interval;App.TimerManager.doTimer(r,n,function(){return i("NormalBullet",0)},this),this.ResetGun();break;case GunType.Shot:for(var s=this.gunData.info,n=s.count,a=s.angle,o=-(n-1)/2*a,h=0;n>h;h++)i("NormalBullet",o+h*a);this.ResetGun();break;case GunType.Boomerang:this.gun.visible=!1,i("BoomerangBullet",0),this.shootCd=100;break;case GunType.Laser:i("LaserBullet",0),this.shootCd=100;break;case GunType.Freez:i("FreezBullet",0),this.ResetGun();break;case GunType.Grenade:var s=this.gunData.info,l=s.direction;i("GrenadeBullet",l),this.ResetGun();break;case GunType.Wave:i("WaveBullet",l),this.ResetGun()}}},n.GunReturn=function(){this.gun.visible=!0,this.shootCd=this.shootInterval},n.ResetGun=function(){this.ChangeGun(this.heroData.gun)},n.update=function(e){t.prototype.update.call(this,e);var i=e/1e3;switch(this.state){case HeroState.Move:var s=e/2,n=s*(this.targetPos.y-this.y)/(this.targetPos.x-this.x),r=e/2,a=45;return 1==this.scaleX?this.x<this.targetPos.x?(this.x=Math.min(this.targetPos.x,this.x+s),this.rotation<a&&(this.rotation=Math.min(a,this.rotation+r))):(this.rotation=Math.max(0,this.rotation-r),0==this.rotation&&(this.state=HeroState.Idle)):this.x>this.targetPos.x?(this.x=Math.max(this.targetPos.x,this.x-s),this.rotation>-a&&(this.rotation=Math.max(-a,this.rotation-r))):(this.rotation=Math.min(0,this.rotation+r),0==this.rotation&&(this.state=HeroState.Idle)),void(this.y<this.targetPos.y?this.y=Math.min(this.y+Math.abs(n),this.targetPos.y):this.y>this.targetPos.y&&(this.y=Math.max(this.y-Math.abs(n),this.targetPos.y)));case HeroState.Dodge:var s=1.5*e,r=1.5*e,a=45;return void(this.x>this.targetPos.x?(this.x=Math.max(this.targetPos.x,this.x-s),this.rotation>-a&&(this.rotation=Math.max(-a,this.rotation-r))):this.x<this.targetPos.x?(this.x=Math.min(this.targetPos.x,this.x+s),this.rotation<a&&(this.rotation=Math.min(a,this.rotation+r))):this.rotation>0?this.rotation=Math.max(0,this.rotation-r):this.rotation<0?this.rotation=Math.min(0,this.rotation+r):(this.state=HeroState.Idle,this.speed=0));case HeroState.Idle:if(this.side==Side.Enemy)switch(this.aiType){case AiType.Follow:this.followAi(i)}break;case HeroState.Hurt:this.hurtTime-=i,this.hurtTime<=0&&(this.state=HeroState.Idle);break;case HeroState.Freez:this.isUp=!1,this.freezTime-=i,this.showFreez(!0),this.speed=0,this.freezTime<=0&&(this.state=HeroState.Idle,this.showFreez(!1));break;case HeroState.Release:this.isUp=!1,this.releaseTime-=i,this.speed=0,this.releaseTime<=0&&(this.state=HeroState.Idle)}this.shootCd>0&&(this.shootCd-=i);var o=this.heroData.downAs;this.isUp&&(o=this.heroData.upAs);var h=this.speed;this.speed=Math.max(Math.min(this.speed+o*i,this.heroData.maxSpeed),this.heroData.minSpeed),this.y-=(h+this.speed)/2*i,this.gameController.CheckHeroOut(this)&&(this.speed=0)},i(n,"IsUp",void 0,function(t){this.isUp=t}),n.followAi=function(t){if(null==this.aiDodgeCd&&(this.aiDodgeCd=0),this.aiDodgeCd>0)this.aiDodgeCd-=t;else if(this.gameController.checkDanger(this,100)&&this.Dodge())return void(this.aiDodgeCd=this.aiDodgeInterval);var e,i,s=this.gameController.GetSafeArea(this);if(s.length>0)for(var n=2e3,r=0;r<s.length;r++){var a=s[r][0]+this.height/2,o=s[r][1]-this.height/2;if(this.y>=a&&this.y<=o){i=(o+a)/2;var h=this.gameController.GetNearestInArea(this,[a,o]);null!=h&&(e=h,i=h.y);break}this.y<=a?a-this.y<n&&(i=a,n=a-this.y):this.y-o<n&&(i=o,n=this.y-o)}null!=e&&Math.abs(i-this.y)<30&&this.Shoot(),this.y>i?this.isUp=!0:this.isUp=!1},n.GetState=function(){return this.state},i(n,"rect",function(){return this.state==HeroState.Move||this.state==HeroState.Die||this.state==HeroState.Dodge?new Rect(-1e4,-1e4,0,0,this.rotation):new Rect(this.x,this.y,this.width,this.height,this.rotation)}),i(n,"shootInterval",function(){return this.gunData.interval}),n.HaveItem=function(){return this.gunData.id!=this.heroData.gun},e}(BaseGameObject);egret.registerClass(Hero,"Hero");var HeroState;!function(t){t[t.Move=0]="Move",t[t.Idle=1]="Idle",t[t.Dodge=2]="Dodge",t[t.Hurt=3]="Hurt",t[t.Freez=4]="Freez",t[t.Release=5]="Release",t[t.Die=6]="Die"}(HeroState||(HeroState={}));var AiType;!function(t){t[t.Follow=0]="Follow"}(AiType||(AiType={}));var Item=function(t){function e(e){t.call(this,e)}__extends(e,t);var i=__define,s=e,n=s.prototype;return n.init=function(e,i,s){t.prototype.init.call(this,i),this.id=e,this.direction=s,this.width=60,this.height=60,this.itemData=GameManager.GetItemData(e),this.speed=this.itemData.speed,this.setImg(this.itemData.img),this.state=1},n.setImg=function(t){null==this.img&&(this.img=new egret.Bitmap,this.addChild(this.img)),this.img.texture=RES.getRes(t),this.img.x=30,this.img.y=30,this.img.anchorOffsetX=this.img.width/2,this.img.anchorOffsetY=this.img.height/2},n.update=function(e){t.prototype.update.call(this,e);var i=e/1e3;switch(this.state){case 1:0==this.direction?this.y+=this.speed*i:this.y-=this.speed*i;break;case 2:this.drawTrail(16777215),this.speed+=.9*e;var s=App.MathUtils.getRadian2(this.x,this.y,this.target.x,this.target.y);-1==this.scaleX&&(s=App.MathUtils.getRadian2(this.target.x,this.target.y,this.x,this.y));var n=App.MathUtils.getAngle(s);this.rotation=n,this.x+=this.speed*i*Math.cos(this.rotation/180*Math.PI)*this.scaleX,this.y+=this.speed*i*Math.sin(this.rotation/180*Math.PI)*this.scaleX,App.MathUtils.getDistance(this.x,this.y,this.target.x,this.target.y)<10&&(this.remove(),this.target.ChangeGun(this.itemData.awardGun))}this.gameController.CheckOutScreen(this)&&this.remove()},n.ToHero=function(t){this.state=2,this.speed=1e3,this.target=t,this.setImg(this.itemData.drop)},n.remove=function(){App.ControllerManager.applyFunc(ControllerConst.Game,GameConst.RemoveItem,this)},n.drawTrail=function(t){null==this.tail&&(this.tail=ObjectPool.pop("Tail"),this.tail.init(3.5*Math.sqrt(this.height),t),this.parent.addChild(this.tail)),this.tail.addPoint(this.x,this.y)},n.clearTail=function(){this.tail.clear(),this.tail=null},n.destory=function(){t.prototype.destory.call(this),null!=this.tail&&this.clearTail()},i(n,"rect",function(){var t,e;return 1!=this.state?new Rect(-1e4,-1e4,0,0,this.rotation):(t=this.width,e=this.height,new Rect(this.x,this.y,t,e,this.rotation))}),e}(BaseGameObject);egret.registerClass(Item,"Item");var LaserBullet=function(t){function e(e){t.call(this,e)}__extends(e,t);var i=__define,s=e,n=s.prototype;return n.init=function(e,i,s){t.prototype.init.call(this,e,i,s),AnchorUtil.setAnchor(this,0),this.state=0,this.speed=0;var n=this.bulletData.info;this.readyTime=n.readyTime,this.releaseTime=n.releaseTime,this.displayTime=n.displayTime,this.readyCd=this.readyTime,this.setReadyImg(n.ready),this.setImg(this.bulletData.img),this.readyImg.scaleX=this.readyImg.scaleY=.5,this.createrX=this.creater.x,this.createrY=this.creater.y,this.alpha=1},n.setReadyImg=function(t){null==this.readyImg&&(this.readyImg=new egret.Bitmap,this.addChild(this.readyImg),AnchorUtil.setAnchor(this.readyImg,.5)),this.readyImg.texture=RES.getRes(t),this.readyImg.x=this.readyImg.width/2},n.setImg=function(t){null==this.img&&(this.img=new egret.Bitmap,this.addChild(this.img),AnchorUtil.setAnchorY(this.img,.5)),this.img.texture=RES.getRes(t),this.img.scale9Grid=new egret.Rectangle(100,0,200,this.img.height),this.img.width=0},n.update=function(e){t.prototype.update.call(this,e),this.creater.GetState()==HeroState.Die&&this.remove(),this.x+=this.creater.x-this.createrX,this.y+=this.creater.y-this.createrY,this.createrX=this.creater.x,this.createrY=this.creater.y;var i=e/1e3;switch(this.state){case 0:this.readyCd-=i,this.readyCd>0?1==this.readyImg.scaleX?this.readyImg.scaleX=this.readyImg.scaleY=.5:this.readyImg.scaleX=this.readyImg.scaleY=1:(this.state=1,this.img.scaleY=this.readyImg.scaleX=this.readyImg.scaleY=.5,this.img.x=this.readyImg.x+this.readyImg.width*this.readyImg.scaleX*.23-5,this.creater.Release(this.releaseTime),this.creater.ResetGun());break;case 1:this.img.scaleY=this.readyImg.scaleX=this.readyImg.scaleY+=.5/this.releaseTime*i,this.img.x=this.readyImg.x+this.readyImg.width*this.readyImg.scaleX*.23-5,this.img.width+=this.bulletData.width/this.releaseTime*i,this.img.scaleY>=1&&(this.state=2);break;case 2:this.img.scaleY=this.readyImg.scaleX=this.readyImg.scaleY-=.9/this.displayTime*i,this.img.x=this.readyImg.x+this.readyImg.width*this.readyImg.scaleX*.23-5,this.img.scaleY<=.1&&this.remove()}},n.hitHero=function(e){t.prototype.hitHero.call(this,e);for(var i=0;i<e.length;i++)this.ignoreHeroes.push(e[i])},i(n,"rect",function(){if(0==this.state)return new Rect(-1e4,-1e4,0,0,this.rotation);var t,e=this.img.width,i=this.img.height*this.img.scaleY;return t=1==this.scaleX?new Rect(this.x+this.img.x+e/2,this.y,e,i,this.rotation):new Rect(this.x-this.img.x-e/2,this.y,e,i,this.rotation)}),n.GetDangerArea=function(t,e){var i=[];if(this.readyCd<e){var s=this.y-this.width/2,n=this.y+this.width/2;i=[s,n]}return i},e}(Bullet);egret.registerClass(LaserBullet,"LaserBullet");var SceneEffect=function(t){function e(e){t.call(this,e)}__extends(e,t);var i=__define,s=e,n=s.prototype;return n.init=function(e,i){t.prototype.init.call(this,e),this.rotation=i,AnchorUtil.setAnchor(this,0),this.ignoreHeroes=[],this.initRail(),this.initBullets()},n.initRail=function(){null==this.rail&&(this.rail=App.DisplayUtils.createBitmap("se_rail_png"),AnchorUtil.setAnchor(this.rail,.5),this.addChild(this.rail)),this.rail.visible=!0},n.initBullets=function(){if(null==this.shadows){this.shadows=[];for(var t=0;5>t;t++){var e=App.DisplayUtils.createBitmap("se_shadow_png");AnchorUtil.setAnchor(e,.5),this.addChild(e),this.shadows.push(e)}this.bullet=App.DisplayUtils.createBitmap("se_bullet_png"),AnchorUtil.setAnchor(this.bullet,.5),this.addChild(this.bullet)}for(var t=0;t<this.shadows.length;t++)this.shadows[t].x=-t*this.rail.width-this.rail.width/2;this.bullet.x=-this.shadows.length*this.rail.width-this.rail.width/2},n.update=function(e){t.prototype.update.call(this,e);for(var i=e/1e3,s=1800,n=0;n<this.shadows.length;n++)this.shadows[n].x+=s*i;this.bullet.x+=s*i,this.shadows[this.shadows.length-1].x>this.rail.width/2&&(this.rail.visible=!1);var r=this.gameController.CheckHitHeroByRect(this.rect);if(r.length>0)for(var n=0;n<r.length;n++){var a=r[n];this.ignoreHeroes.indexOf(a)<0&&(this.ignoreHeroes.push(a),a.Hurt(10))}this.bullet.x>this.rail.width/2&&this.destory()},i(n,"rect",function(){var t=this.x+this.bullet.x*Math.cos(this.rotation/180*Math.PI),e=this.y+this.bullet.x*Math.sin(this.rotation/180*Math.PI),i=this.bullet.width,s=this.bullet.height;return new Rect(t,e,i,s,this.rotation)}),e}(BaseGameObject);egret.registerClass(SceneEffect,"SceneEffect");var Stone=function(t){function e(e){t.call(this,e)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(e,i,s){t.prototype.init.call(this,i),this.id=e,this.direction=s,this.stoneData=GameManager.GetStoneData(e),0==this.direction?this.speedY=this.stoneData.speed:this.speedY=-this.stoneData.speed,this.speedX=0,this.setImg(this.stoneData.img),this.width=this.stoneData.width,this.height=this.stoneData.height,this.state=0},s.setImg=function(t){null==this.img&&(this.img=new egret.Bitmap,this.addChild(this.img)),this.img.texture=RES.getRes(t),this.img.x=this.stoneData.width/2,this.img.y=this.stoneData.height/2,this.img.anchorOffsetX=this.img.width/2,this.img.anchorOffsetY=this.img.height/2},s.update=function(e){t.prototype.update.call(this,e);var i=e/1e3;switch(this.state){case 0:this.rotation+=this.speedY*i/2;break;case 1:this.speedX-=this.ax*i,this.speedY-=this.ay*i;var s=2;(this.ax>0&&this.speedX<=this.ax/s||this.ax<0&&this.speedX>=this.ax/s)&&(this.speedX=this.ax/s,this.speedY=this.ay/s)}this.y+=this.speedY*i,this.x+=this.speedX*i,this.gameController.CheckOutScreen(this)&&this.remove()},s.Hit=function(t,e){this.speedX+=t*Math.cos(e/180*Math.PI),this.speedY+=t*Math.sin(e/180*Math.PI),this.state=1;var i=this.stoneData.speed,s=Math.atan(this.speedX/this.speedY);this.ax=Math.abs(i*Math.sin(s)),this.ay=Math.abs(i*Math.cos(s)),this.speedX<0&&(this.ax*=-1),this.speedY<0&&(this.ay*=-1)},s.remove=function(){App.ControllerManager.applyFunc(ControllerConst.Game,GameConst.RemoveStone,this)},e}(BaseGameObject);egret.registerClass(Stone,"Stone");var Tail=function(t){function e(){t.call(this),this.mPoints=[],this.mg=this.graphics}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(t,e){this.size=t,this.color=e,this.state=1,App.TimerManager.doFrame(1,0,this.update,this)},s.addPoint=function(t,e){var i={sx:t,sy:e,size:this.size};this.mPoints.push(i)},s.clear=function(){this.state=2},s.update=function(t){if(0!=this.mPoints.length){2==this.state&&(this.mPoints.splice(i,1),0==this.mPoints.length&&this.destory()),this.mg.clear();for(var e=this.mPoints.length,i=0;e>i;i++){var s=this.mPoints[i];s.size-=2,s.size<0&&(this.mPoints.splice(i,1),i--,e=this.mPoints.length)}e=this.mPoints.length;var n=.1;for(i=1;e>i;i++)for(var r=this.mPoints[i],a=5,o=this.mPoints[i-1].sx,h=this.mPoints[i-1].sy,l=r.sx,c=r.sy,u=this.mPoints[i-1].size,g=r.size,d=0;a>d;d++)this.mg.lineStyle(u+(g-u)/a*d,this.color,n),this.mg.moveTo(o+(l-o)/a*d,h+(c-h)/a*d),this.mg.lineTo(o+(l-o)/a*(d+1),h+(c-h)/a*(d+1)),n+=.002}},s.destory=function(){App.TimerManager.remove(this.update,this),App.DisplayUtils.removeFromParent(this),ObjectPool.push(this)},e}(egret.Shape);egret.registerClass(Tail,"Tail");var WaveBullet=function(t){function e(e){t.call(this,e)}__extends(e,t);var i=__define,s=e,n=s.prototype;return n.init=function(e,i,s){t.prototype.init.call(this,e,i,s),t.prototype.setImg.call(this,this.bulletData.img),this.width=this.bulletData.width,this.height=this.bulletData.height,this.img.scaleX=this.img.scaleY=.3},n.update=function(e){t.prototype.update.call(this,e),this.img.scaleX<1&&(this.img.scaleX=this.img.scaleY=Math.min(e/1e3+this.img.scaleX,1))},n.hitHero=function(e){t.prototype.hitHero.call(this,e);for(var i=0;i<e.length;i++)this.ignoreHeroes.push(e[i])},n.hitItems=function(e){t.prototype.hitItems.call(this,e)},n.outScreen=function(){t.prototype.outScreen.call(this)},i(n,"rect",function(){var t=this.width*this.img.scaleX,e=this.height*this.img.scaleY;return new Rect(this.x,this.y,t,e,this.rotation)}),e}(Bullet);egret.registerClass(WaveBullet,"WaveBullet");var LoadingConst;!function(t){t[t.SetProgress=1]="SetProgress"}(LoadingConst||(LoadingConst={}));var LoadingController=function(t){function e(){t.call(this),this.loadingView=new LoadingView(this,LayerManager.UI_Main),App.ViewManager.register(ViewConst.Loading,this.loadingView),this.registerFunc(LoadingConst.SetProgress,this.setProgress,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.setProgress=function(t,e){this.loadingView.setProgress(t,e)},e}(BaseController);egret.registerClass(LoadingController,"LoadingController");var LoadingView=function(t){function e(e,i){t.call(this,e,i),this.skinName=LoadingSceneSkin}__extends(e,t);var i=(__define,e),s=i.prototype;return s.setProgress=function(t,e){this.progress.text="加载中...("+t+"/"+e+")"},e}(BaseEuiView);egret.registerClass(LoadingView,"LoadingView");var GameScene=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onEnter=function(){t.prototype.onEnter.call(this),this.addLayer(LayerManager.Game_Main),this.addLayer(LayerManager.Game_UI),App.ViewManager.open(ViewConst.Game),App.ViewManager.open(ViewConst.GameUI)},s.onExit=function(){t.prototype.onExit.call(this)},e}(BaseScene);egret.registerClass(GameScene,"GameScene");var LayerManager=function(){function t(){}var e=(__define,t);e.prototype;return t.Game_Main=new BaseSpriteLayer,t.Game_UI=new BaseSpriteLayer,t.UI_Main=new BaseEuiLayer,t.UI_Pop=new BaseEuiLayer,t.UI_Message=new BaseEuiLayer,t}();egret.registerClass(LayerManager,"LayerManager");var LoadingScene=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onEnter=function(){t.prototype.onEnter.call(this),this.addLayer(LayerManager.UI_Main),App.ViewManager.open(ViewConst.Loading)},s.onExit=function(){t.prototype.onExit.call(this)},e}(BaseScene);egret.registerClass(LoadingScene,"LoadingScene");