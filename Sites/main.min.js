var EgretExpandManager=function(){function t(){}var e=(__define,t);e.prototype;return t.init=function(){AnchorUtils.init(),TimerManager.init()},t}();egret.registerClass(EgretExpandManager,"EgretExpandManager");var Main=function(t){function e(){t.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.onAddToStage=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),EgretExpandManager.init(),this.stage.removeChildren(),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},n.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},n.onResourceLoadComplete=function(t){if("preload"==t.groupName)this._loadingScene=SceneManager.enterScene(Scene.Loading),RES.loadGroup("loading");else if("loading"==t.groupName)return RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),void RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this)},n.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},n.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},n.onResourceProgress=function(t){"loading"==t.groupName&&this._loadingScene.setProgress(t.itemsLoaded,t.itemsTotal)},n.createGameScene=function(){SceneManager.enterScene(Scene.Game)},e}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var Block=function(t){function e(){t.call(this)}__extends(e,t);var i=__define,n=e,s=n.prototype;return s.init=function(t){this._value=t,this.reset(),this.setBlock()},s.reset=function(){this._sprite&&(this._sprite.scaleX=this._sprite.scaleY=1),this.alpha=1,this._isSelect=!1},s.setBlock=function(){this._sprite||(this._sprite=new egret.Sprite,this._sprite.name="方块",this.addChild(this._sprite),this._sprite.touchEnabled=!0,this._sprite.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this));var t=this._sprite,e=this.size;this.setColor(this.color),t.x=e,t.y=e*Math.sqrt(3)/2,this._text||(this._text=new egret.TextField,this._text.name="数字",this._sprite.addChild(this._text),this._text.size=40,this._text.width=this.width,this._text.height=40,this._text.textAlign="center",AnchorUtils.setAnchor(this._text,.5)),this._value>0?this._text.text=this._value.toString():this._text.text=""},s.onTap=function(){this._callBack&&this._callBack()},s.setOnTap=function(t){this._callBack=t},s.show=function(t){this._sprite.scaleX=this._sprite.scaleY=.2,egret.Tween.get(this._sprite).to({scaleX:1,scaleY:1},t,egret.Ease.elasticOut)},s.hide=function(t){this._sprite.scaleX=this._sprite.scaleY=1,egret.Tween.get(this._sprite).to({scaleX:.2,scaleY:.2},t,egret.Ease.elasticIn)},s.select=function(){var t=this._sprite;egret.Tween.removeTweens(t),this._isSelect=!0,this.play()},s.unSelect=function(){var t=this._sprite;egret.Tween.removeTweens(t),t.scaleX=t.scaleY=1},s.play=function(){if(this._isSelect){var t=this._sprite;if(t.scaleX<1){var e=2e3*(1-t.scaleX);egret.Tween.get(t).to({scaleX:1,scaleY:1},e).call(this.play,this)}else{var e=2e3*(t.scaleX-.9);egret.Tween.get(t).to({scaleX:.85,scaleY:.85},e).call(this.play,this)}}},s.setColor=function(t){DrawUtils.drawRoundHexagon(this._sprite,this.size,this.size/3,t)},i(s,"pos",function(){return this._pos},function(t){this._pos=t}),i(s,"size",function(){return DataManager.BLOCK_SIZE}),i(s,"color",function(){return DataManager.getColor(this._value)}),i(s,"value",function(){return this._value}),e}(egret.DisplayObjectContainer);egret.registerClass(Block,"Block");var Button=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e);i.prototype;return e}(egret.DisplayObjectContainer);egret.registerClass(Button,"Button");var BaseScene=function(t){function e(){t.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.onAddToStage=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.init()},n.init=function(){TimerManager.doFrame(1,0,this.update,this)},n.update=function(t){},n.destroy=function(){TimerManager.remove(this.update,this),DisplayUtils.removeFromParent(this)},e}(egret.DisplayObjectContainer);egret.registerClass(BaseScene,"BaseScene");var GameUI=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=__define,n=e,s=n.prototype;return s.init=function(){t.prototype.init.call(this),this.width=StageUtils.stageW,this.height=StageUtils.stageH,this.reset()},s.reset=function(){this._blocks=[],this._blockCon||(this._blockCon=new egret.DisplayObjectContainer,this._blockCon.name="方块容器",this._blockCon.x=this.width/2,this._blockCon.y=50,this._blockCon.scaleX=this._blockCon.scaleY=.75,AnchorUtils.setAnchorX(this._blockCon,.5),this.addChild(this._blockCon));var t=new egret.BitmapText;if(t.font=RES.getRes("font_fnt"),t.text="32",this.addChild(t),!this._hint){var e=new egret.TextField;e.size=30,e.x=this.width/2,e.y=this.height-170,e.textAlign="center",e.bold=!0,e.textColor=0,e.name="hint",this.addChild(e),this._hint=e,this._hint.visible=!1}},s.restart=function(){this.hideBtns();var t=SceneManager.curScene;t.restart()},s.useItem=function(t){var e=SceneManager.curScene;e.useItem(t)},s.showHint=function(t){var e=this,i=this._hint;egret.Tween.removeTweens(i),i.text=t,AnchorUtils.setAnchor(i,.5),i.visible=!0,i.scaleX=i.scaleY=1,i.alpha=0,egret.Tween.get(i).to({alpha:1},300).call(function(){return e.playHint()})},s.playHint=function(){var t=this,e=this._hint,i=1;e.scaleX<1.1&&(i=1.1),egret.Tween.get(e).to({scaleX:i,scaleY:i},500).call(function(){return t.playHint()})},s.hideHint=function(){var t=this._hint;egret.Tween.removeTweens(t),egret.Tween.get(t).to({alpha:0},300).call(function(){t.visible=!1})},s.end=function(){},s.setBlocks=function(t){var e=this;this._blocks=[];for(var i=100,n=1.7*this.blockSize,s=-t.length*n/2,r=function(r){TimerManager.doTimer(i*r,1,function(){var i=ObjectPool.pop("Block");i.name="方块"+r,e._blockCon.addChild(i),i.init(t[r]),i.x=s+n*r,i.y=0,e._blocks.push(i),i.show(500)},o)},o=this,a=0;a<t.length;a++)r(a);TimerManager.doTimer(i*t.length+100,1,function(){},this)},s.clearBlocks=function(){var t=this,e=100;if(this._blocks&&this._blocks.length>0)for(var i=function(i){var s=n._blocks[i];TimerManager.doTimer(e*(n._blocks.length-i-1),1,function(){egret.Tween.get(s).to({alpha:.3},100).call(function(){t.removeBlock(s)},t)},n)},n=this,s=0;s<this._blocks.length;s++)i(s);TimerManager.doTimer(e*this._blocks.length,1,function(){t._blocks=[]},this)},s.removeBlocks=function(t){var e=this;void 0===t&&(t=1);var i=100;if(this._blocks&&this._blocks.length>0)for(var n=function(n){var r=s._blocks[n];TimerManager.doTimer(i*n,1,function(){egret.Tween.get(r).to({x:r.x,y:r.y+50*t,alpha:.3},100).call(function(){e.removeBlock(r)},e)},s)},s=this,r=0;r<this._blocks.length;r++)n(r);TimerManager.doTimer(i*this._blocks.length,1,function(){e._blocks=[]},this)},s.showBtns=function(){var t=this;this.showBtn(this._restartBtn),TimerManager.doTimer(100,1,function(){return t.showBtn(t._refreshNext)},this),TimerManager.doTimer(200,1,function(){return t.showBtn(t._clearOne)},this),TimerManager.doTimer(300,1,function(){return t.showBtn(t._clearRandomFive)},this),TimerManager.doTimer(400,1,function(){return t.showBtn(t._clearOneColor)},this)},s.hideBtns=function(){var t=this;this.hideBtn(this._restartBtn),TimerManager.doTimer(400,1,function(){return t.hideBtn(t._refreshNext)},this),TimerManager.doTimer(300,1,function(){return t.hideBtn(t._clearOne)},this),TimerManager.doTimer(200,1,function(){return t.hideBtn(t._clearRandomFive)},this),TimerManager.doTimer(100,1,function(){return t.hideBtn(t._clearOneColor)},this)},s.newButton=function(t,e,i,n){var s=new egret.Sprite;s.name=t,DrawUtils.drawCircle(s,50,0),s.x=e,s.y=i,this.addChild(s);var r=new egret.TextField;return s.addChild(r),r.size=35,r.width=s.width,r.height=35,r.textAlign="center",r.bold=!0,AnchorUtils.setAnchor(r,.5),r.text=t,s.touchEnabled=!0,s.addEventListener(egret.TouchEvent.TOUCH_TAP,n,this),s},s.showBtn=function(t){egret.Tween.removeTweens(t),t.visible=!0,t.scaleX=t.scaleY=.1,egret.Tween.get(t).to({scaleX:1,scaleY:1},500,egret.Ease.elasticOut)},s.hideBtn=function(t){egret.Tween.removeTweens(t),egret.Tween.get(t).to({scaleX:.1,scaleY:.1},500,egret.Ease.elasticIn).call(function(){t.visible=!1})},s.removeBlock=function(t){egret.Tween.removeTweens(t),DisplayUtils.removeFromParent(t),ObjectPool.push(t)},i(s,"blockSize",function(){return DataManager.BLOCK_SIZE}),e}(BaseScene);egret.registerClass(GameUI,"GameUI");var DataManager=function(){function t(){}var e=__define,i=t;i.prototype;return e(t,"HOR_SIZE",function(){return 5}),e(t,"VER_SIZE",function(){return 8}),e(t,"BLOCK_SIZE",function(){return 45}),e(t,"BLOCK_GAP",function(){return 5}),t.getColor=function(t){return this.COLOR_DIC[t]},t.COLOR_DIC={0:14145495,1:16761095,2:2201331,4:10233776,8:16007990,16:5025616,32:7951688,64:13491257,128:4149685},t}();egret.registerClass(DataManager,"DataManager");var GameScene=function(t){function e(){t.apply(this,arguments),this._idleTime=200,this._perMoveTime=100}__extends(e,t);var i=__define,n=e,s=n.prototype;return s.init=function(){t.prototype.init.call(this),this.reset(),this.initBlocks()},s.initBlocks=function(){var t=this;this.setState(GameState.Init);for(var e=function(t,e){return 200*e+50*t},i=function(i){n._blocks.push([]);for(var s=function(s){TimerManager.doTimer(e(i,s),1,function(){t.addBlank(i,s)},n)},r=0;r<n.ver;r++)s(r)},n=this,s=0;s<this.hor;s++)i(s);TimerManager.doTimer(e(this.hor,this.ver)+200,1,function(){t._nextBlocks=t.getNextBlocks(),t.addBlocks()},this)},s.reset=function(){this._blocks=[],this._blankList=[],this._removeList=[],this._moveFlag=!1,this._curItem=0;var t=StageUtils.stageW,e=StageUtils.stageH;this._bg||(this.addChild(this._bg=DisplayUtils.createBitmap("bg_png")),this._bg.width=t,this._bg.height=e),this._blankCon||(this._blankCon=new egret.DisplayObjectContainer,this._blankCon.name="空白容器",this._blankCon.x=t/2,this._blankCon.y=e/2,this._blankCon.width=this.b_w*(this.hor-1)+2*this.blockSize,this._blankCon.height=this.b_h*(this.ver-1)+this.b_h/2+this.blockSize*Math.sqrt(3),AnchorUtils.setAnchor(this._blankCon,.5),this.addChild(this._blankCon)),this._blockCon||(this._blockCon=new egret.DisplayObjectContainer,this._blockCon.name="方块容器",this._blockCon.x=t/2,this._blockCon.y=e/2,this._blockCon.width=this.b_w*(this.hor-1)+2*this.blockSize,this._blockCon.height=this.b_h*(this.ver-1)+this.b_h/2+this.blockSize*Math.sqrt(3),AnchorUtils.setAnchor(this._blockCon,.5),this.addChild(this._blockCon)),this._ui||(this._ui=new GameUI,this.addChild(this._ui))},s.restart=function(){var t=this;if(this._state==GameState.Idle||this._state==GameState.End){this._ui.clearBlocks();for(var e=function(e,i){return 200*(t.ver-i)+50*(t.hor-e)+300},i=function(i){for(var s=function(s){TimerManager.doTimer(e(i,s),1,function(){var e=t._blocks[i][s];egret.Tween.get(e).to({alpha:.3},100).call(function(){e.value>0?t.removeBlock(e):t.removeBlank(e)})},n)},r=0;r<n.ver;r++)s(r)},n=this,s=0;s<this.hor;s++)i(s);TimerManager.doTimer(e(0,0)+500,1,this.init,this)}},s.useItem=function(t){this._state==GameState.Idle&&(this.setState(GameState.Item),this._curItem=t,2==t||4==t?this._ui.showHint("选择一个六边形"):this.itemEffect())},s.itemEffect=function(t){var e=this;switch(void 0===t&&(t=null),this._curItem){case 1:this._ui.removeBlocks(-1),TimerManager.doTimer(500,1,function(){e._nextBlocks=e.getNextBlocks(),e._ui.setBlocks(e._nextBlocks)},this),TimerManager.doTimer(1e3,1,function(){e.setState(GameState.Idle)},this);break;case 2:this._ui.hideHint(),this.delBlock(t,600),TimerManager.doTimer(1e3,1,function(){return e.setState(GameState.Idle)},this);break;case 3:var i=[];this._blocks.forEach(function(t){t.forEach(function(t){t.value>0&&i.push(t)})}),i.sort(SortUtils.random);for(var n=600,s=0,r=function(t){if(i.length>0){var r=i.pop();TimerManager.doTimer(s,1,function(){e.delBlock(r,n)},o),s+=o._perMoveTime}},o=this,a=0;5>a;a++)r(a);TimerManager.doTimer(s+n+200,1,function(){e.setState(GameState.Idle)},this);break;case 4:this._ui.hideHint();var n=600,s=0;this._blocks.forEach(function(i){i.forEach(function(i){i.value==t.value&&(TimerManager.doTimer(s,1,function(){e.delBlock(i,n)},e),s+=e._perMoveTime)})}),TimerManager.doTimer(s+n+200,1,function(){e.setState(GameState.Idle)},this)}},s.addBlocks=function(){var t=this;this.setState(GameState.Add),this._ui.removeBlocks(),this._blankList.sort(SortUtils.random);for(var e=this._nextBlocks,i=[],n=function(n){TimerManager.doTimer(n*s._perMoveTime,1,function(){var s=e[n],r=t._blankList.pop();i.push(r),t.addBlock(r.pos.x,r.pos.y,s)},s)},s=this,r=0;r<e.length;r++)n(r);TimerManager.doTimer(e.length*this._perMoveTime,1,function(){for(var e=0;e<i.length;e++)t.removeBlank(i[e]);t._nextBlocks=t.getNextBlocks(),t._ui.setBlocks(t._nextBlocks),TimerManager.doTimer(t._idleTime,1,function(){t.setState(GameState.Idle)},t)},this)},s.addBlock=function(t,e,i){var n=this,s=ObjectPool.pop("Block");s.init(i);var r=this.getPosition(t,e);s.x=r.x,s.y=r.y,this.pushToList(s,t,e),s.show(600),s.setOnTap(function(){return n.tapBlock(s)})},s.removeBlock=function(t){egret.Tween.removeTweens(t),DisplayUtils.removeFromParent(t),ObjectPool.push(t)},s.addBlank=function(t,e){var i=this,n=ObjectPool.pop("Block");n.init(0);var s=this.getPosition(t,e);n.x=s.x,n.y=s.y+this.b_h,egret.Tween.get(n).to({x:s.x,y:s.y},1e3,egret.Ease.elasticOut),this._blankList.push(n),this.pushToList(n,t,e),n.setOnTap(function(){return i.tapBlank(n)})},s.removeBlank=function(t){egret.Tween.removeTweens(t),DisplayUtils.removeFromParent(t),ObjectPool.push(t)},s.delBlock=function(t,e){var i=this;t.hide(e),TimerManager.doTimer(e+100,1,function(){i.removeBlock(t),i.addBlank(t.pos.x,t.pos.y)},this)},s.tapBlock=function(t){return this._state==GameState.Item?void((2==this._curItem||4==this._curItem)&&this.itemEffect(t)):void(this._state==GameState.Idle&&(this._curBlock&&this._curBlock.unSelect(),this._curBlock=t,t.select()))},s.tapBlank=function(t){var e=this;if(this._state==GameState.Idle&&this._curBlock){var i=this._curBlock;this._curBlock=null,i.unSelect();var n=this.getPath(i.pos,t.pos);if(n.length>0){for(var s=this._perMoveTime,r=function(t){var e=o._blocks[n[t].x][n[t].y];TimerManager.doTimer(s*t,1,function(){egret.Tween.get(i).to({x:e.x,y:e.y},s)},o),TimerManager.doTimer(s*t+s/2,1,function(){e.setColor(i.color)},o);var r=e.color;TimerManager.doTimer(s*t+s,1,function(){e.setColor(r)},o)},o=this,a=0;a<n.length;a++)r(a);TimerManager.doTimer(s,1,function(){e.addBlank(i.pos.x,i.pos.y)},this),TimerManager.doTimer(s*n.length,1,function(){e.pushToList(i,t.pos.x,t.pos.y),ArrayUtils.remove(e._blankList,t),e.removeBlank(t),e._moveFlag=!0,TimerManager.doTimer(e._idleTime,1,function(){e.setState(GameState.Idle)},e)},this)}else{var h=t.color;t.setColor(0),TimerManager.doTimer(this._idleTime,1,function(){t.setColor(h),e.setState(GameState.Idle)},this)}}},s.getPath=function(t,e,i){void 0===i&&(i=0);for(var n=this._blocks,s=[],r=0;r<this.hor;r++){var o=[];s.push(o);for(var a=0;a<this.ver;a++)n[r][a].value!=i?o.push(1):o.push(0)}for(var h=MazeUtils.findPath(s,new Point(t.x,t.y),new Point(e.x,e.y)),c=[];null!=h&&null!=h.parent;)c.push(new egret.Point(h.X,h.Y)),h=h.parent;return c.reverse(),c},s.pushToList=function(t,e,i){if(t.pos=new egret.Point(e,i),this._blocks[e][i]=t,t.name="方块（"+e+", "+i+"）",t.value>0){if(this._blockCon.addChild(t),this._checkList=[],this.check(t),this._checkList.length>=4){var n=[];this._checkList.forEach(function(t){n.push(t)});for(var s=0;s<this._removeList.length;s++)for(var r=0;r<n.length;r++)if(this._removeList[s].indexOf(n[r])>=0){ArrayUtils.remove(this._removeList,this._removeList[s]);break}this._removeList.push(n)}}else this._blankCon.addChild(t)},s.remove=function(t){var e=this;this.setState(GameState.Remove);for(var i=0,n=t[0].pos,s=t[0].value,r=0;r<t.length;r++){var o=t[r];if(0==r)this.removeBlock(o);else{var a=this.toRemove(o,n);a>i&&(i=a)}}TimerManager.doTimer(i+200,1,function(){e.addBlock(n.x,n.y,4*s),TimerManager.doTimer(e._idleTime,1,function(){e.setState(GameState.Idle)},e)},this)},s.toRemove=function(t,e){for(var i=this,n=this.getPath(t.pos,e,t.value),s=this._perMoveTime,r=function(e){var i=o.getPosition(n[e].x,n[e].y);TimerManager.doTimer(s*e,1,function(){egret.Tween.get(t).to({x:i.x,y:i.y},s)},o)},o=this,a=0;a<n.length;a++)r(a);return TimerManager.doTimer(s,1,function(){i.addBlank(t.pos.x,t.pos.y)},this),TimerManager.doTimer(s*n.length,1,function(){i.removeBlock(t)},this),s*n.length},s.checkRemove=function(){if(this._state!=GameState.Idle)return!1;if(this._removeList.length>0){var t=this._removeList.shift();return this.remove(t),!0}return!1},s.check=function(t){if(!(this._checkList.indexOf(t)>=0)){this._checkList.push(t);for(var e=this._blocks,i=t.pos.x,n=t.pos.y,s=t.value,r=-1;1>=r;r++)for(var o=-1;1>=o;o++)if(!(0>i+r||i+r>=this.hor||0>n+o||n+o>=this.ver)){var a=e[i+r][n+o];if(a.value==s&&(0!=r||0!=o)){var h=!1;i%2==0?(0==r||o>=0)&&(h=!0):(0==r||0>=o)&&(h=!0),h&&this.check(a)}}}},s.getNextBlocks=function(){var t=[],e=this._blankList.length,i=0;i=e>=this.ver*this.hor?11:e>=20?5:e>5?4:Math.min(e,3),0==i&&(this.setState(GameState.End),this._ui.end());for(var n=0;i>n;n++)t.push(Math.pow(2,RandomUtils.limitInteger(0,3)));return t},s.setState=function(t){this._state=t,t==GameState.Idle&&(this._curItem=0,(!this.checkRemove()&&this._moveFlag||this._blankList.length==this.ver*this.hor)&&this.addBlocks(),this._moveFlag=!1)},s.getPosition=function(t,e){var i=new egret.Point;return i.x=this.b_w*t,i.y=this.b_h/2*(2*e+1-t%2),i},i(s,"hor",function(){return DataManager.HOR_SIZE}),i(s,"ver",function(){return DataManager.VER_SIZE}),i(s,"b_w",function(){return 1.5*this.blockSize+this.blockGap/(Math.sqrt(3)/2)}),i(s,"b_h",function(){return this.blockSize*Math.sqrt(3)+this.blockGap}),i(s,"blockSize",function(){return DataManager.BLOCK_SIZE}),i(s,"blockGap",function(){return DataManager.BLOCK_GAP}),e}(BaseScene);egret.registerClass(GameScene,"GameScene");var GameState;!function(t){t[t.Idle=0]="Idle",t[t.Init=1]="Init",t[t.Add=2]="Add",t[t.Remove=3]="Remove",t[t.Move=4]="Move",t[t.End=5]="End",t[t.Item=6]="Item"}(GameState||(GameState={}));var LoadingScene=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.init=function(){t.prototype.init.call(this);var e=StageUtils.stageW,i=StageUtils.stageH;this.addChild(this._bg=DisplayUtils.createBitmap("bg_png")),this._bg.width=e,this._bg.height=i,this.addChild(this._loadingBg=DisplayUtils.createBitmap("loading3_png")),this._loadingBg.x=e/2-this._loadingBg.width/2,this._loadingBg.y=i/2-this._loadingBg.height/2,this.addChild(this._loadingBar=DisplayUtils.createBitmap("loading2_png")),this._loadingBar.x=this._loadingBg.x,this._loadingBar.y=this._loadingBg.y,this._loadingBar.width=0,this.addChild(this._loadingFrame=DisplayUtils.createBitmap("loading1_png")),this._loadingFrame.x=e/2-this._loadingFrame.width/2,this._loadingFrame.y=i/2-this._loadingFrame.height/2,this.addChild(this._label=new egret.TextField),this._label.width=200,this._label.x=e/2-100,this._label.y=i/2+35,this._label.textAlign="center",this._label.size=40,this._label.textColor=8361629,this._label.fontFamily="Cookies",console.log(this._label.fontFamily)},n.setProgress=function(t,e){var i=t/e;this._loadingBar.width=this._loadingBg.width*i,this._label.text=Math.ceil(100*i)+"%"},e}(BaseScene);egret.registerClass(LoadingScene,"LoadingScene");var SceneManager=function(){function t(){}var e=__define,i=t;i.prototype;return t.enterScene=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];switch(this._curScene&&(ObjectPool.push(this._curScene),DisplayUtils.removeFromParent(this._curScene)),t){case Scene.Loading:this._curScene=ObjectPool.pop("LoadingScene");break;case Scene.Game:this._curScene=ObjectPool.pop("GameScene");break;case Scene.Menu:this._curScene=ObjectPool.pop("MenuScene")}return this.stage.addChild(this._curScene),this._curScene},e(t,"stage",function(){return StageUtils.stage}),e(t,"curScene",function(){return this._curScene}),t}();egret.registerClass(SceneManager,"SceneManager");var Scene;!function(t){t[t.Loading=0]="Loading",t[t.Menu=1]="Menu",t[t.Game=2]="Game"}(Scene||(Scene={}));var AnchorUtils=function(){function t(){}var e=(__define,t);e.prototype;return t.init=function(){this._propertyChange=Object.create(null),this._anchorChange=Object.create(null),this.injectAnchor()},t.setAnchorX=function(t,e){t.anchorX=e},t.setAnchorY=function(t,e){t.anchorY=e},t.setAnchor=function(t,e){t.anchorX=t.anchorY=e},t.getAnchor=function(t){return t.anchorX!=t.anchorY&&console.log("target's anchorX != anchorY"),t.anchorX||0},t.getAnchorY=function(t){return t.anchorY||0},t.getAnchorX=function(t){return t.anchorX||0},t.injectAnchor=function(){Object.defineProperty(egret.DisplayObject.prototype,"width",{get:function(){return this.$getWidth()},set:function(e){var i=this;this.$setWidth(e),t._propertyChange[this.hashCode]=!0,egret.callLater(function(){t.changeAnchor(i)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"height",{get:function(){return this.$getHeight()},set:function(e){var i=this;this.$setHeight(e),t._propertyChange[this.hashCode]=!0,egret.callLater(function(){t.changeAnchor(i)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"anchorX",{get:function(){return this._anchorX},set:function(e){var i=this;this._anchorX=e,t._propertyChange[this.hashCode]=!0,t._anchorChange[this.hashCode]=!0,egret.callLater(function(){t.changeAnchor(i)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"anchorY",{get:function(){return this._anchorY},set:function(e){var i=this;this._anchorY=e,t._propertyChange[this.hashCode]=!0,t._anchorChange[this.hashCode]=!0,egret.callLater(function(){t.changeAnchor(i)},this)},enumerable:!0,configurable:!0})},t.changeAnchor=function(t){this._propertyChange[t.hashCode]&&this._anchorChange[t.hashCode]&&(t.anchorOffsetX=t._anchorX*t.width,t.anchorOffsetY=t._anchorY*t.height,delete this._propertyChange[t.hashCode])},t}();egret.registerClass(AnchorUtils,"AnchorUtils");var ArrayUtils=function(){function t(){}var e=(__define,t);e.prototype;return t.forEach=function(t,e,i){for(var n=0,s=t.length;s>n;n++)e.apply(i,[t[n]])},t.remove=function(t,e){var i=t.indexOf(e);t.splice(i,1)},t}();egret.registerClass(ArrayUtils,"ArrayUtils");var DateUtils=function(){function t(){}var e=(__define,t),i=e.prototype;return i.getFormatBySecond=function(t,e){void 0===e&&(e=1);var i="";switch(e){case 1:i=this.getFormatBySecond1(t);break;case 2:i=this.getFormatBySecond2(t);break;case 3:i=this.getFormatBySecond3(t);break;case 4:i=this.getFormatBySecond4(t);break;case 5:i=this.getFormatBySecond5(t)}return i},i.getFormatBySecond1=function(t){void 0===t&&(t=0);var e,i=Math.floor(t/3600);e=0==i?"00":10>i?"0"+i:""+i;var n,s,r=Math.floor((t-3600*i)/60),o=Math.floor((t-3600*i)%60);return n=0==r?"00":10>r?"0"+r:""+r,s=0==o?"00":10>o?"0"+o:""+o,e+":"+n+":"+s},i.getFormatBySecond3=function(t){void 0===t&&(t=0);var e,i,n=Math.floor(t/3600),s=Math.floor((t-3600*n)/60),r=Math.floor((t-3600*n)%60);return e=0==s?"00":10>s?"0"+s:""+s,i=0==r?"00":10>r?"0"+r:""+r,e+":"+i},i.getFormatBySecond2=function(t){var e=new Date(t),i=e.getFullYear(),n=e.getMonth()+1,s=e.getDate(),r=e.getHours(),o=e.getMinutes(),a=e.getSeconds();return i+"-"+n+"-"+s+" "+r+":"+o+":"+a},i.getFormatBySecond4=function(t){var e=Math.floor(t/3600);return e>0?e>24?Math.floor(e/24)+"天前":e+"小时前":Math.floor(t/60)+"分钟前"},i.getFormatBySecond5=function(t){var e=86400,i=3600,n=60,s=Math.floor(t/e),r=Math.floor(t%e/i),o=Math.floor((t-r*i)/n),a=Math.floor((t-r*i)%n),h="",c="",l="",u="";return t>0?0==s?(h="",0==r?(c="",0==o?(l="",u=0==a?"":10>a?"0"+a+"秒":""+a+"秒"):(l=""+o+"分",u=0==a?"":10>a?"0"+a+"秒":""+a+"秒",l+u)):(c=r+"小时",0==o?(l="",u=0==a?"":10>a?"0"+a+"秒":""+a+"秒"):(l=10>o?"0"+o+"分":""+o+"分",c+l))):(h=s+"天",c=0==r?"":10>r?"0"+r+"小时":""+r+"小时",h+c):""},t}();egret.registerClass(DateUtils,"DateUtils");var DebugUtils=function(){function t(){}var e=__define,i=t;i.prototype;return t.isOpen=function(t){this._isOpen=t},e(t,"isDebug",function(){return this._isOpen}),t.start=function(t){this._isOpen&&(this._startTimes[t]=egret.getTimer())},t.stop=function(t){if(!this._isOpen)return 0;if(!this._startTimes[t])return 0;var e=egret.getTimer()-this._startTimes[t];return e>this._threshold&&this.log(t+": "+e),e},t.setThreshold=function(t){this._threshold=t},t.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];this._isOpen&&(t[0]="[DebugLog]"+t[0],console.log.apply(console,t))},t._isOpen=!1,t._startTimes={},t._threshold=3,t}();egret.registerClass(DebugUtils,"DebugUtils");var DeviceUtils=function(){function t(){}var e=__define,i=t;i.prototype;return e(t,"IsHtml5",function(){return egret.Capabilities.runtimeType==egret.RuntimeType.WEB}),e(t,"IsNative",function(){return egret.Capabilities.runtimeType==egret.RuntimeType.NATIVE}),e(t,"IsMobile",function(){return egret.Capabilities.isMobile}),e(t,"IsPC",function(){return!egret.Capabilities.isMobile}),e(t,"IsQQBrowser",function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("MQQBrowser")}),e(t,"IsIEBrowser",function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("MSIE")}),e(t,"IsFirefoxBrowser",function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Firefox")}),e(t,"IsChromeBrowser",function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Chrome")}),e(t,"IsSafariBrowser",function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Safari")}),e(t,"IsOperaBrowser",function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Opera")}),t}();egret.registerClass(DeviceUtils,"DeviceUtils");var DisplayUtils=function(){function t(){}var e=(__define,t);e.prototype;return t.createBitmap=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},t.removeFromParent=function(t){null!=t.parent&&t.parent.removeChild(t)},t}();egret.registerClass(DisplayUtils,"DisplayUtils");var DrawUtils=function(){function t(){}var e=(__define,t);e.prototype;return t.drawRoundHexagon=function(t,e,i,n){var s=t.graphics;s.clear(),s.lineStyle(i,n),s.beginFill(n),e-=Math.ceil(i/2),s.moveTo(-e/2,-e*Math.sqrt(3)/2),s.lineTo(e/2,-e*Math.sqrt(3)/2),s.lineTo(e,0),s.lineTo(e/2,e*Math.sqrt(3)/2),s.lineTo(-e/2,e*Math.sqrt(3)/2),s.lineTo(-e,0),s.lineTo(-e/2,-e*Math.sqrt(3)/2),s.endFill()},t.drawRect=function(t,e,i,n){var s=t.graphics;s.clear(),s.beginFill(n),s.drawRect(0,0,e,i),s.endFill()},t.drawCircle=function(t,e,i){var n=t.graphics;n.clear(),n.beginFill(i),n.drawCircle(0,0,e),n.endFill()},t}();egret.registerClass(DrawUtils,"DrawUtils");var Utils=function(){function t(){}var e=(__define,t);e.prototype;return t.macIconShake=function(t,e){for(var i=[[20,300],[15,300],[10,300],[5,300]],n="egret.Tween.get("+t+")",s=0,r=i.length;r>s;s++)n+=".to({'y':"+e+"-"+i[s][0]+"}, "+i[s][1]+")",n+=".to({'y':"+e+"}, "+i[s][1]+")";return n+=";"},t.startFlicker=function(t,e){t.alpha=1,egret.Tween.get(t).to({alpha:0},e).to({alpha:1},e).call(this.startFlicker,this,[t])},t.stopFlicker=function(t){egret.Tween.removeTweens(t)},t}();egret.registerClass(Utils,"Utils");var FrameExecutor=function(){function t(t){this.delayFrame=t,this.frameDelay=new FrameDelay,this.functions=new Array}var e=(__define,t),i=e.prototype;return i.regist=function(t,e){this.functions.push([t,e])},i.execute=function(){if(this.functions.length){var t=this.functions.shift();t[0].call(t[1]),this.frameDelay.delayCall(this.delayFrame,this.execute,this)}},t}();egret.registerClass(FrameExecutor,"FrameExecutor");var FrameDelay=function(){function t(){}var e=(__define,t),i=e.prototype;return i.delayCall=function(t,e,i){this.func=e,this.thisObj=i,TimerManager.doFrame(t,1,this.listener_enterFrame,this)},i.listener_enterFrame=function(){this.func.call(this.thisObj)},t}();egret.registerClass(FrameDelay,"FrameDelay");var KeyboardUtils=function(){function t(){}var e=(__define,t);e.prototype;return t.init=function(){if(this.key_ups=new Array,this.key_downs=new Array,DeviceUtils.IsHtml5){var t=this;document.addEventListener("keyup",function(e){for(var i=0,n=t.key_ups.length;n>i;i++){var s=t.key_ups[i][0],r=t.key_ups[i][1];r?s.call(r,e.keyCode):s(e.keyCode)}}),document.addEventListener("keydown",function(e){for(var i=0,n=t.key_downs.length;n>i;i++){var s=t.key_downs[i][0],r=t.key_downs[i][1];r?s.call(r,e.keyCode):s(e.keyCode)}})}},t.addKeyUp=function(t,e){this.key_ups.push([t,e])},t.addKeyDown=function(t,e){this.key_downs.push([t,e])},t.removeKeyUp=function(t,e){for(var i=0;i<this.key_ups.length;i++)this.key_ups[i][0]==t&&this.key_ups[i][1]==e&&(this.key_ups.splice(i,1),i--)},t.removeKeyDown=function(t,e){for(var i=0;i<this.key_downs.length;i++)this.key_downs[i][0]==t&&this.key_downs[i][1]==e&&(this.key_downs.splice(i,1),i--)},t}();egret.registerClass(KeyboardUtils,"KeyboardUtils");var Keyboard=function(){function t(){}var e=(__define,t);e.prototype;return t.LEFT=37,t.RIGHT=39,t.UP=38,t.DOWN=40,t.W=87,t.A=65,t.S=83,t.D=68,t.J=74,t.K=75,t.L=76,t.U=85,t.I=73,t.O=79,t.P=80,t.SPACE=32,t}();egret.registerClass(Keyboard,"Keyboard");var MathUtils=function(){function t(){}var e=(__define,t);e.prototype;return t.getAngle=function(t){return 180*t/Math.PI},t.getRadian=function(t){return Math.PI=t/180*Math.PI},t.getRadian2=function(t,e,i,n){var s=i-t,r=n-e;return Math.atan2(r,s)},t.getDistance=function(t,e,i,n){var s=i-t,r=n-e,o=s*s+r*r;return Math.sqrt(o)},t}();egret.registerClass(MathUtils,"MathUtils");var MazeUtils=function(){function t(){}var e=(__define,t);e.prototype;return t.findPath=function(t,e,i){for(this._openList=[],this._closeList=[],this._mazeList=t,this._openList.push(e);this._openList.length>0;){this._openList.sort(this.sortF);var n=this._openList.shift();this._closeList.push(n);for(var s=this.getAroundPoint(n),r=0;r<s.length;r++){var o=s[r];this.getInOpenList(o)?this.recalcPoint(n,o):this.addPoint(n,i,o)}if(this.getInOpenList(i))return this.getInOpenList(i)}return this.getInOpenList(i)?this.getInOpenList(i):void 0},t.sortF=function(t,e){return t.F-e.F},t.getInOpenList=function(t){for(var e=this._openList,i=0;i<e.length;i++){var n=e[i];if(n.X==t.X&&n.Y==t.Y)return n}},t.getInCloseList=function(t){for(var e=this._closeList,i=0;i<e.length;i++){var n=e[i];if(n.X==t.X&&n.Y==t.Y)return n}},t.getAroundPoint=function(t){for(var e=[],i=-1;1>=i;i++)for(var n=-1;1>=n;n++)if(0!=i||0!=n){var s=!1;if(t.X%2==0?(0==i||n>=0)&&(s=!0):(0==i||0>=n)&&(s=!0),s){var r=new Point(t.X+i,t.Y+n);this.canReach(r)&&e.push(r)}}return e},t.addPoint=function(t,e,i){i.parent=t,i.G=this.calcG(t,i),i.H=this.calcH(e,i),this._openList.push(i)},t.recalcPoint=function(t,e){var i=this.calcG(t,e);i<e.G&&(e.parent=t,e.G=i)},t.calcG=function(t,e){var i=e.parent?e.parent.G:0;return i+1},t.calcH=function(t,e){return Math.abs(t.X-e.X)+Math.abs(t.Y-e.Y)},t.canReach=function(t){var e=t.X,i=t.Y,n=this._mazeList;return!this.getInCloseList(t)&&e>=0&&n.length>e&&i>=0&&n[e].length>i&&0==n[e][i]},t}();egret.registerClass(MazeUtils,"MazeUtils");var Point=function(){function t(t,e){this.G=0,this.H=0,this.X=t,this.Y=e}var e=__define,i=t,n=i.prototype;return e(n,"F",function(){return this.G+this.H
}),t}();egret.registerClass(Point,"Point");var ObjectPool=function(){function t(){}var e=(__define,t);e.prototype;return t.pop=function(e){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];t._content[e]||(t._content[e]=[]);var s=t._content[e];if(s.length)return s.pop();var r,o=egret.getDefinitionByName(e),a=i.length;return 0==a?r=new o:1==a?r=new o(i[0]):2==a?r=new o(i[0],i[1]):3==a?r=new o(i[0],i[1],i[2]):4==a?r=new o(i[0],i[1],i[2],i[3]):5==a&&(r=new o(i[0],i[1],i[2],i[3],i[4])),r.ObjectPoolKey=e,r},t.popWithExtraKey=function(e,i){t._content[e]||(t._content[e]=[]);var n,s=t._content[e];if(s.length)for(var r=0;r<s.length;r++)if(s[r].extraKey==i){n=s[r],s.splice(r,1);break}if(!n){var o=egret.getDefinitionByName(e);n=new o(i),n.extraKey=i,n.ObjectPoolKey=e}return n},t.push=function(e){if(null==e)return!1;var i=e.ObjectPoolKey,n=t._content[i];return!n||n.indexOf(e)>=0?!1:(t._content[i].push(e),!0)},t.clear=function(){t._content={}},t.clearClass=function(e,i){void 0===i&&(i=null);for(var n=t._content[e];n&&n.length;){var s=n.pop();i&&s[i](),s=null}t._content[e]=null,delete t._content[e]},t.dealFunc=function(e,i){var n=t._content[e];if(null!=n){var s=0,r=n.length;for(s;r>s;s++)n[s][i]()}},t._content={},t}();egret.registerClass(ObjectPool,"ObjectPool");var RandomUtils=function(){function t(){}var e=(__define,t);e.prototype;return t.limit=function(t,e){t=Math.min(t,e),e=Math.max(t,e);var i=e-t;return t+Math.random()*i},t.limitInteger=function(t,e){return Math.round(this.limit(t,e))},t.randomArray=function(t){var e=Math.floor(Math.random()*t.length);return t[e]},t}();egret.registerClass(RandomUtils,"RandomUtils");var Rocker=function(){function t(){}var e=(__define,t),i=e.prototype;return i.init=function(t,e,i,n){this.keys=[0,0],this.mouseX=-1,this.mouseY=-1,this.moveFlag=e,this.moveFlagX=e.x,this.moveFlagY=e.y,this.moveFlagGoX=this.moveFlagX,this.moveFlagGoY=this.moveFlagY,this.moveFlagWidthHelf=.5*t.width,this.moveFlagRec=new egret.Rectangle(this.moveFlagX-.5*t.width,this.moveFlagY-.5*t.height,t.width,t.height),this.moveFlagCheckRec=new egret.Rectangle(0,0,.5*StageUtils.stageW,StageUtils.stageH),this.dealKeyFunc=i,this.dealKeyTarget=n,this.moveFlag.touchEnabled=!0,this.moveFlag.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.startMove,this),this.moveFlag.addEventListener(egret.TouchEvent.TOUCH_END,this.stopMove,this),this.moveFlag.addEventListener(egret.TouchEvent.TOUCH_TAP,this.stopEvent,this),StageUtils.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.leaveStateEvent,this),StageUtils.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.heroMoveEvent,this),KeyboardUtils.addKeyDown(this.onKeyDown,this),KeyboardUtils.addKeyUp(this.onKeyUp,this)},i.onKeyDown=function(t){switch(t){case Keyboard.A:this.keys[0]=-1,this.startCheckKey();break;case Keyboard.D:this.keys[0]=1,this.startCheckKey();break;case Keyboard.W:this.keys[1]=-1,this.startCheckKey();break;case Keyboard.S:this.keys[1]=1,this.startCheckKey()}},i.onKeyUp=function(t){switch(t){case Keyboard.A:-1==this.keys[0]&&(this.keys[0]=0);break;case Keyboard.D:1==this.keys[0]&&(this.keys[0]=0);break;case Keyboard.W:-1==this.keys[1]&&(this.keys[1]=0);break;case Keyboard.S:1==this.keys[1]&&(this.keys[1]=0)}},i.stopEvent=function(t){t.stopPropagation()},i.leaveStateEvent=function(t){t.stageX==this.mouseX&&t.stageY==this.mouseY&&this.stopMove()},i.startMove=function(t){this.isMoveing=!0,this.moveFlagGoX=this.moveFlagX,this.moveFlagGoY=this.moveFlagY,this.mouseX=t.stageX,this.mouseY=t.stageY},i.stopMove=function(){this.isMoveing=!1,this.keys[0]=0,this.keys[1]=0,this.moveFlagGoX=this.moveFlagX,this.moveFlagGoY=this.moveFlagY,this.mouseX=-1,this.mouseY=-1},i.resetRockerPos=function(){this.moveFlag.x=this.moveFlagX,this.moveFlag.y=this.moveFlagY},i.heroMoveEvent=function(t){this.runMove(t.stageX,t.stageY)},i.runMove=function(t,e){if(this.isMoveing&&(this.moveFlagCheckRec.contains(t,e)||!(Math.abs(this.mouseX-t)>50||Math.abs(this.mouseY-e)>50))){if(this.mouseX=t,this.mouseY=e,this.moveFlagRec.contains(this.mouseX,this.mouseY))this.moveFlagGoX=this.mouseX,this.moveFlagGoY=this.mouseY;else{var i=MathUtils.getRadian2(this.moveFlagX,this.moveFlagY,this.mouseX,this.mouseY);this.moveFlagGoX=this.moveFlagX+Math.cos(i)*this.moveFlagWidthHelf,this.moveFlagGoY=this.moveFlagY+Math.sin(i)*this.moveFlagWidthHelf}this.moveFlagGoX>this.moveFlagX&&Math.abs(this.moveFlagGoX-this.moveFlagX)>10?this.keys[0]=1:this.moveFlagGoX<this.moveFlagX&&Math.abs(this.moveFlagGoX-this.moveFlagX)>10?this.keys[0]=-1:this.keys[0]=0,this.moveFlagGoY>this.moveFlagY&&Math.abs(this.moveFlagGoY-this.moveFlagY)>10?this.keys[1]=1:this.moveFlagGoY<this.moveFlagY&&Math.abs(this.moveFlagGoY-this.moveFlagY)>10?this.keys[1]=-1:this.keys[1]=0,this.startCheckKey()}},i.startCheckKey=function(){this.checkKeying||(this.checkKeying=!0,TimerManager.doFrame(1,0,this.delKeys,this))},i.stopCheckKey=function(){this.keys[0]=0,this.keys[1]=0,this.checkKeying&&(TimerManager.remove(this.delKeys,this),this.checkKeying=!1)},i.delKeys=function(){-1==this.mouseX||this.moveFlagCheckRec.contains(this.mouseX,this.mouseY)||this.stopMove(),this.moveFlag.x!=this.moveFlagGoX&&(this.moveFlag.x=this.moveFlagGoX),this.moveFlag.y!=this.moveFlagGoY&&(this.moveFlag.y=this.moveFlagGoY),this.keys[0]||this.keys[1]||this.stopCheckKey(),this.dealKeyFunc.call(this.dealKeyTarget,this.keys[0],this.keys[1])||this.resetRockerPos()},i.stop=function(){this.stopCheckKey(),this.stopMove()},t}();egret.registerClass(Rocker,"Rocker");var ShockUtils=function(){function t(){}var e=__define,i=t;i.prototype;return t.destroy=function(){this.stop()},t.shock=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=null),void 0===i&&(i=3),this._target||(this._type=t,this._target=e,this._type==this.MAP?(this._shockPoss=this.mapPoss.concat(),this._shockLength=this._shockPoss.length):this._type==this.SPRITE&&(this._shockPoss=this.spritePoss.concat(),this._shockLength=this._shockPoss.length),this.start(i))},t.start=function(t){void 0===t&&(t=1),this.repeatCount=t,this._shockCount=0,this._target&&(this._type!=this.MAP&&(this._rx=this._target.x),this._ry=this._target.y,TimerManager.doFrame(1,0,this.onShockEnter,this))},t.stop=function(){this._target&&(this._type!=this.MAP&&(this._target.x=this._rx),this._target.y=this._ry,TimerManager.remove(this.onShockEnter,this)),this._target=null},t.onShockEnter=function(t){var e=this._shockLength*this._repeatCount;if(this._shockCount>=e)return void this.stop();var i=this._shockCount%this._shockLength,n=this._shockPoss[i];this._target&&(this._type!=this.MAP&&(this._target.x=this._rx+n.x),this._target.y=this._ry+n.y),this._shockCount++},e(t,"repeatCount",function(){return this._repeatCount},function(t){this._repeatCount=t}),t.MAP=0,t.SPRITE=1,t.mapPoss=[new egret.Point(0,3),new egret.Point(0,0),new egret.Point(0,-2)],t.spritePoss=[new egret.Point(5,0),new egret.Point(-5,0),new egret.Point(5,0)],t._shockLength=0,t._shockCount=0,t._rx=0,t._ry=0,t._type=0,t._repeatCount=0,t}();egret.registerClass(ShockUtils,"ShockUtils");var SortUtils=function(){function t(){}var e=(__define,t);e.prototype;return t.sortNum=function(t,e){return t-e},t.random=function(t,e){return Math.random()-.5},t}();egret.registerClass(SortUtils,"SortUtils");var StageUtils=function(){function t(){}var e=__define,i=t;i.prototype;return e(t,"stage",function(){return egret.MainContext.instance.stage}),e(t,"stageW",function(){return egret.MainContext.instance.stage.stageWidth}),e(t,"stageH",function(){return egret.MainContext.instance.stage.stageHeight}),t}();egret.registerClass(StageUtils,"StageUtils");var StringUtils=function(){function t(){}var e=(__define,t);e.prototype;return t.trimSpace=function(t){return t.replace(/^\s*(.*?)[\s\n]*$/g,"$1")},t.getStringLength=function(t){for(var e=t.split(""),i=0,n=0;n<e.length;n++){var s=e[n];i+=this.isChinese(s)?2:1}return i},t.isChinese=function(t){var e=/^.*[\u4E00-\u9FA5]+.*$/;return e.test(t)},t}();egret.registerClass(StringUtils,"StringUtils");var TextFlowMaker=function(){function t(){}var e=(__define,t);e.prototype;return t.generateTextFlow=function(t){for(var e=t.split("|"),i=[],n=0,s=e.length;s>n;n++)i.push(this.getSingleTextFlow(e[n]));return i},t.getSingleTextFlow=function(t){for(var e,i=t.split("&"),n={style:{}},s=0,r=i.length;r>s;s++)e=i[s].split(":"),e[0]==this.PROP_TEXT?n.text=e[1]:e[0]==this.STYLE_SIZE?n.style.size=parseInt(e[1]):e[0]==this.STYLE_COLOR?n.style.textColor=parseInt(e[1]):n.text=e[0];return n},t.STYLE_COLOR="C",t.STYLE_SIZE="S",t.PROP_TEXT="T",t}();egret.registerClass(TextFlowMaker,"TextFlowMaker");var TimerManager=function(){function t(){}var e=__define,i=t;i.prototype;return t.init=function(){this._handlers=new Array,this._delHandlers=new Array,this._currTime=egret.getTimer(),this._currFrame=0,this._count=0,this._timeScale=1,egret.Ticker.getInstance().register(this.onEnterFrame,this)},t.setTimeScale=function(t){this._timeScale=t},t.onEnterFrame=function(){this._currFrame++,this._currTime=egret.getTimer(),DebugUtils.start("TimerManager:");for(var t=0;t<this._count;t++){var e=this._handlers[t],i=e.userFrame?this._currFrame:this._currTime;i>=e.exeTime&&(DebugUtils.start(e.method.toString()),e.method.call(e.methodObj,(this._currTime-e.dealTime)*this._timeScale),DebugUtils.stop(e.method.toString()),e.dealTime=this._currTime,e.exeTime+=e.delay,e.repeat||(e.repeatCount>1?e.repeatCount--:(e.complateMethod&&e.complateMethod.apply(e.complateMethodObj),this._delHandlers.push(e))))}for(;this._delHandlers.length;){var e=this._delHandlers.pop();this.remove(e.method,e.methodObj)}DebugUtils.stop("TimerManager:")},t.create=function(t,e,i,n,s,r,o){if(!(0>e||0>i||null==n)){this.remove(n,s);var a=ObjectPool.pop("TimerHandler");a.userFrame=t,a.repeat=0==i,a.repeatCount=i,a.delay=e,a.method=n,a.methodObj=s,a.complateMethod=r,a.complateMethodObj=o,a.exeTime=e+(t?this._currFrame:this._currTime),a.dealTime=this._currTime,this._handlers.push(a),this._count++}},t.doTimer=function(t,e,i,n,s,r){void 0===s&&(s=null),void 0===r&&(r=null),this.create(!1,t,e,i,n,s,r)},t.doFrame=function(t,e,i,n,s,r){void 0===s&&(s=null),void 0===r&&(r=null),this.create(!0,t,e,i,n,s,r)},e(t,"count",function(){return this._count}),t.remove=function(t,e){for(var i=0;i<this._count;i++){var n=this._handlers[i];if(n.method==t&&n.methodObj==e){this._handlers.splice(i,1),ObjectPool.push(n),this._count--;break}}},t.removeAll=function(t){for(var e=0;e<this._count;e++){var i=this._handlers[e];i.methodObj==t&&(this._handlers.splice(e,1),ObjectPool.push(i),this._count--,e--)}},t.isExists=function(t,e){for(var i=0;i<this._count;i++){var n=this._handlers[i];if(n.method==t&&n.methodObj==e)return!0}return!1},t}();egret.registerClass(TimerManager,"TimerManager");var TimerHandler=function(){function t(){this.delay=0,this.repeatCount=0,this.exeTime=0,this.dealTime=0}var e=(__define,t),i=e.prototype;return i.clear=function(){this.method=null,this.methodObj=null,this.complateMethod=null,this.complateMethodObj=null},t}();egret.registerClass(TimerHandler,"TimerHandler");